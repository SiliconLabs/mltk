{

 "cells": [

  {

   "cell_type": "markdown",

   "metadata": {},

   "source": [

    "# Audio Feature Generator Example\n",

    "\n",

    "This demonstrates how to:\n",

    "1. Load a quantized keyword spotting model \n",

    "2. Manually invoke the [Audio Feature Generator](../../docs/python_api/data_preprocessing/audio_feature_generator.md) APIs to generate a spectrogram from an audio file\n",

    "3. Run inference with the manually processed audio sample using Tensorflow-Lite and Tensorflow-Lite Micro\n",

    "\n",

    "In this example, we use the [keyword_spotting_numbers](../../docs/python_api/models/siliconlabs/keyword_spotting_numbers.md) ML model.\n",

    "\n",

    "__NOTES:__  \n",

    "- Click here: [![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/siliconlabs/mltk/blob/master/mltk/examples/audio_feature_generator.ipynb) to run this example interactively in your browser  \n",

    "- Refer to the [Notebook Examples Guide](../../docs/guides/notebook_examples_guide.md) for how to run this example locally in VSCode  "

   ]

  },

  {

   "cell_type": "markdown",

   "metadata": {},

   "source": [

    "## Install the MLTK python package"

   ]

  },

  {

   "cell_type": "code",

   "execution_count": null,

   "metadata": {},

   "outputs": [],

   "source": [

    "# Install the MLTK Python package (if necessary)\n",

    "!pip install --upgrade silabs-mltk"

   ]

  },

  {

   "cell_type": "markdown",

   "metadata": {},

   "source": [

    "## Import the Python packages"

   ]

  },

  {

   "cell_type": "code",

   "execution_count": 9,

   "metadata": {},

   "outputs": [],

   "source": [

    "import os\n",

    "import pprint\n",

    "import numpy as np\n",

    "from mltk.datasets import audio as audio_datasets\n",

    "from mltk.core.preprocess.utils import audio as audio_utils\n",

    "from mltk.core.preprocess.audio.audio_feature_generator import AudioFeatureGeneratorSettings\n",

    "from mltk.core import load_mltk_model, TfliteModel, TfliteModelParameters\n",

    "from mltk.core.tflite_micro import TfliteMicro\n",

    "from mltk.utils.archive_downloader import download_url"

   ]

  },

  {

   "cell_type": "markdown",

   "metadata": {},

   "source": [

    "## Load Audio Sample\n",

    "\n",

    "First we need to obtain an audio sample. In this example, we load a random sample from the [ten_digits](../../docs/python_api/datasets/audio/ten_digits.md) dataset which was used to train the [keyword_spotting_numbers](../../docs/python_api/models/siliconlabs/keyword_spotting_numbers.md) ML model."

   ]

  },

  {

   "cell_type": "code",

   "execution_count": 10,

   "metadata": {},

   "outputs": [

    {

     "name": "stdout",

     "output_type": "stream",

     "text": [

      "Using audio sample: C:/Users/dried/.mltk/datasets/ten_digits/seven/aws_ar-AE+Hala+seven+medium+medium+1209d48a.wav\n",

      "Sample length: 0.7s, rate: 16.0kHz\n"

     ]

    }

   ],

   "source": [

    "# Download the \"ten digits\" dataset (if necessary)\n",

    "dataset_dir = audio_datasets.ten_digits.download()\n",

    "\n",

    "# And grab the first sample in the 'seven' directory\n",

    "audio_sample_dir = f'{dataset_dir}/seven'\n",

    "audio_sample_fn = list(os.listdir(audio_sample_dir))[0]\n",

    "\n",

    "audio_sample_path = f'{audio_sample_dir}/{audio_sample_fn}'\n",

    "print(f'Using audio sample: {audio_sample_path}')\n",

    "\n",

    "# Load the audio file into memory\n",

    "audio_sample_data, audio_sample_rate_hz = audio_utils.read_audio_file(audio_sample_path, return_numpy=True, return_sample_rate=True)\n",

    "\n",

    "audio_sample_length = len(audio_sample_data)\n",

    "audio_sample_length_seconds = audio_sample_length/audio_sample_rate_hz\n",

    "print(f'Sample length: {audio_sample_length_seconds:.1f}s, rate: {audio_sample_rate_hz/1000:.1f}kHz')"

   ]

  },

  {

   "cell_type": "markdown",

   "metadata": {},

   "source": [

    "## Load the MLTK Model\n",

    "\n",

    "Next, we load the MLTK model. We also print a list of the \"classes\" supported by the model with their corresponding list indices."

   ]

  },

  {

   "cell_type": "code",

   "execution_count": 11,

   "metadata": {},

   "outputs": [

    {

     "name": "stdout",

     "output_type": "stream",

     "text": [

      "Downloading https://github.com/SiliconLabs/mltk/raw/master/mltk/models/siliconlabs/keyword_spotting_numbers.mltk.zip\n",

      "to c:/Users/dried/silabs/github_siliconlabs/mltk/mltk/examples/keyword_spotting_numbers.mltk.zip\n",

      "(This may take awhile, please be patient ...)\n",

      "Extracting keyword_spotting_numbers.py from C:/Users/dried/silabs/github_siliconlabs/mltk/mltk/examples/keyword_spotting_numbers.mltk.zip                     \n",

      "Model: keyword_spotting_numbers classifies 11 classes with the following mapping:\n",

      " 0 -> zero\n",

      " 1 -> one\n",

      " 2 -> two\n",

      " 3 -> three\n",

      " 4 -> four\n",

      " 5 -> five\n",

      " 6 -> six\n",

      " 7 -> seven\n",

      " 8 -> eight\n",

      " 9 -> nine\n",

      "10 -> _unknown_\n"

     ]

    }

   ],

   "source": [

    "# Download the \"keyword_spotting_numbers\" model archive from github\n",

    "mltk_model_archive_path = download_url(\n",

    "    url='https://github.com/SiliconLabs/mltk/raw/master/mltk/models/siliconlabs/keyword_spotting_numbers.mltk.zip', \n",

    "    dst_path='keyword_spotting_numbers.mltk.zip', \n",

    "    show_progress=True\n",

    ")\n",

    "\n",

    "# Load the MLTK model\n",

    "mltk_model = load_mltk_model(mltk_model_archive_path)\n",

    "\n",

    "# Retrieve the classes used by the model\n",

    "classes = mltk_model.classes\n",

    "\n",

    "# Print classes and their corresponding indices\n",

    "print(f'Model: {mltk_model.name} classifies {mltk_model.n_classes} classes with the following mapping:')\n",

    "for class_index, class_label in enumerate(classes):\n",

    "    print(f'{class_index:2d} -> {class_label}')"

   ]

  },

  {

   "cell_type": "markdown",

   "metadata": {},

   "source": [

    "## Load the .tflite model\n",

    "\n",

    "Next, we load the trained and quantized [keyword_spotting_numbers](../../docs/python_api/models/siliconlabs/keyword_spotting_numbers.md) `.tflite` model. We do this by extracting the `.tflite` from the `keyword_spotting_numbers.mltk.zip` model archive and loading it into a [TfliteModel](../../docs/python_api/tflite_model/index.md) instance."

   ]

  },

  {

   "cell_type": "code",

   "execution_count": 12,

   "metadata": {},

   "outputs": [

    {

     "name": "stdout",

     "output_type": "stream",

     "text": [

      ".tflite path: E:/dried/mltk/models/keyword_spotting_numbers/extracted_archive/keyword_spotting_numbers.tflite\n",

      "+-------+------------------------------+-------------------+-----------------+------------------------------------------------------+\n",

      "| Index | OpCode                       | Input(s)          | Output(s)       | Config                                               |\n",

      "+-------+------------------------------+-------------------+-----------------+------------------------------------------------------+\n",

      "| 0     | quantize                     | 98x1x40 (float32) | 98x1x40 (int8)  | Type=none                                            |\n",

      "| 1     | conv_2d                      | 98x1x40 (int8)    | 98x1x40 (int8)  | Padding:Same stride:1x1 activation:None              |\n",

      "|       |                              | 3x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 2     | conv_2d                      | 98x1x40 (int8)    | 98x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 3     | depthwise_conv_2d            | 98x1x120 (int8)   | 49x1x120 (int8) | Multiplier:1 padding:Same stride:2x2 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 4     | conv_2d                      | 49x1x120 (int8)   | 49x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 5     | conv_2d                      | 98x1x40 (int8)    | 49x1x40 (int8)  | Padding:Same stride:2x2 activation:Relu              |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 6     | add                          | 49x1x40 (int8)    | 49x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 49x1x40 (int8)    |                 |                                                      |\n",

      "| 7     | conv_2d                      | 49x1x40 (int8)    | 49x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 8     | depthwise_conv_2d            | 49x1x120 (int8)   | 49x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 9     | conv_2d                      | 49x1x120 (int8)   | 49x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 10    | add                          | 49x1x40 (int8)    | 49x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 49x1x40 (int8)    |                 |                                                      |\n",

      "| 11    | conv_2d                      | 49x1x40 (int8)    | 49x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 12    | depthwise_conv_2d            | 49x1x120 (int8)   | 49x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 13    | conv_2d                      | 49x1x120 (int8)   | 49x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 14    | add                          | 49x1x40 (int8)    | 49x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 49x1x40 (int8)    |                 |                                                      |\n",

      "| 15    | conv_2d                      | 49x1x40 (int8)    | 49x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 16    | depthwise_conv_2d            | 49x1x120 (int8)   | 49x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 17    | conv_2d                      | 49x1x120 (int8)   | 49x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 18    | add                          | 49x1x40 (int8)    | 49x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 49x1x40 (int8)    |                 |                                                      |\n",

      "| 19    | conv_2d                      | 49x1x40 (int8)    | 49x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 20    | depthwise_conv_2d            | 49x1x120 (int8)   | 25x1x120 (int8) | Multiplier:1 padding:Same stride:2x2 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 21    | conv_2d                      | 25x1x120 (int8)   | 25x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 22    | conv_2d                      | 49x1x40 (int8)    | 25x1x40 (int8)  | Padding:Same stride:2x2 activation:Relu              |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 23    | add                          | 25x1x40 (int8)    | 25x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 25x1x40 (int8)    |                 |                                                      |\n",

      "| 24    | conv_2d                      | 25x1x40 (int8)    | 25x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 25    | depthwise_conv_2d            | 25x1x120 (int8)   | 25x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 26    | conv_2d                      | 25x1x120 (int8)   | 25x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 27    | add                          | 25x1x40 (int8)    | 25x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 25x1x40 (int8)    |                 |                                                      |\n",

      "| 28    | conv_2d                      | 25x1x40 (int8)    | 25x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 29    | depthwise_conv_2d            | 25x1x120 (int8)   | 25x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 30    | conv_2d                      | 25x1x120 (int8)   | 25x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 31    | add                          | 25x1x40 (int8)    | 25x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 25x1x40 (int8)    |                 |                                                      |\n",

      "| 32    | conv_2d                      | 25x1x40 (int8)    | 25x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 33    | depthwise_conv_2d            | 25x1x120 (int8)   | 25x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 34    | conv_2d                      | 25x1x120 (int8)   | 25x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 35    | add                          | 25x1x40 (int8)    | 25x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 25x1x40 (int8)    |                 |                                                      |\n",

      "| 36    | conv_2d                      | 25x1x40 (int8)    | 25x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 37    | depthwise_conv_2d            | 25x1x120 (int8)   | 13x1x120 (int8) | Multiplier:1 padding:Same stride:2x2 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 38    | conv_2d                      | 13x1x120 (int8)   | 13x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 39    | conv_2d                      | 25x1x40 (int8)    | 13x1x40 (int8)  | Padding:Same stride:2x2 activation:Relu              |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 40    | add                          | 13x1x40 (int8)    | 13x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 13x1x40 (int8)    |                 |                                                      |\n",

      "| 41    | conv_2d                      | 13x1x40 (int8)    | 13x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 42    | depthwise_conv_2d            | 13x1x120 (int8)   | 13x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 43    | conv_2d                      | 13x1x120 (int8)   | 13x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 44    | add                          | 13x1x40 (int8)    | 13x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 13x1x40 (int8)    |                 |                                                      |\n",

      "| 45    | conv_2d                      | 13x1x40 (int8)    | 13x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 46    | depthwise_conv_2d            | 13x1x120 (int8)   | 13x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 47    | conv_2d                      | 13x1x120 (int8)   | 13x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 48    | add                          | 13x1x40 (int8)    | 13x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 13x1x40 (int8)    |                 |                                                      |\n",

      "| 49    | conv_2d                      | 13x1x40 (int8)    | 13x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 50    | depthwise_conv_2d            | 13x1x120 (int8)   | 13x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 51    | conv_2d                      | 13x1x120 (int8)   | 13x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 52    | add                          | 13x1x40 (int8)    | 13x1x40 (int8)  | Activation:Relu                                      |\n",

      "|       |                              | 13x1x40 (int8)    |                 |                                                      |\n",

      "| 53    | conv_2d                      | 13x1x40 (int8)    | 13x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 54    | depthwise_conv_2d            | 13x1x120 (int8)   | 7x1x120 (int8)  | Multiplier:1 padding:Same stride:2x2 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 55    | conv_2d                      | 7x1x120 (int8)    | 7x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 56    | conv_2d                      | 13x1x40 (int8)    | 7x1x40 (int8)   | Padding:Same stride:2x2 activation:Relu              |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 57    | add                          | 7x1x40 (int8)     | 7x1x40 (int8)   | Activation:Relu                                      |\n",

      "|       |                              | 7x1x40 (int8)     |                 |                                                      |\n",

      "| 58    | conv_2d                      | 7x1x40 (int8)     | 7x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 59    | depthwise_conv_2d            | 7x1x120 (int8)    | 7x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 60    | conv_2d                      | 7x1x120 (int8)    | 7x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 61    | add                          | 7x1x40 (int8)     | 7x1x40 (int8)   | Activation:Relu                                      |\n",

      "|       |                              | 7x1x40 (int8)     |                 |                                                      |\n",

      "| 62    | conv_2d                      | 7x1x40 (int8)     | 7x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 63    | depthwise_conv_2d            | 7x1x120 (int8)    | 7x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 64    | conv_2d                      | 7x1x120 (int8)    | 7x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 65    | add                          | 7x1x40 (int8)     | 7x1x40 (int8)   | Activation:Relu                                      |\n",

      "|       |                              | 7x1x40 (int8)     |                 |                                                      |\n",

      "| 66    | conv_2d                      | 7x1x40 (int8)     | 7x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |\n",

      "|       |                              | 1x1x40 (int8)     |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 67    | depthwise_conv_2d            | 7x1x120 (int8)    | 7x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |\n",

      "|       |                              | 9x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 120 (int32)       |                 |                                                      |\n",

      "| 68    | conv_2d                      | 7x1x120 (int8)    | 7x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |\n",

      "|       |                              | 1x1x120 (int8)    |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "| 69    | add                          | 7x1x40 (int8)     | 7x1x40 (int8)   | Activation:Relu                                      |\n",

      "|       |                              | 7x1x40 (int8)     |                 |                                                      |\n",

      "| 70    | reshape                      | 7x1x40 (int8)     | 7x40x1 (int8)   | Type=none                                            |\n",

      "|       |                              | 4 (int32)         |                 |                                                      |\n",

      "| 71    | transpose                    | 7x40x1 (int8)     | 40x1x7 (int8)   | Type=none                                            |\n",

      "|       |                              | 4 (int32)         |                 |                                                      |\n",

      "| 72    | mean                         | 40x1x7 (int8)     | 7 (int8)        | Type=reduceroptions                                  |\n",

      "|       |                              | 3 (int32)         |                 |                                                      |\n",

      "| 73    | squared_difference           | 40x1x7 (int8)     | 40x1x7 (int8)   | Type=none                                            |\n",

      "|       |                              | 7 (int8)          |                 |                                                      |\n",

      "| 74    | mean                         | 40x1x7 (int8)     | 7 (int8)        | Type=reduceroptions                                  |\n",

      "|       |                              | 3 (int32)         |                 |                                                      |\n",

      "| 75    | add                          | 7 (int8)          | 7 (int8)        | Activation:None                                      |\n",

      "|       |                              |  (int8)           |                 |                                                      |\n",

      "| 76    | rsqrt                        | 7 (int8)          | 7 (int8)        | Type=none                                            |\n",

      "| 77    | mul                          | 40x1x7 (int8)     | 40x1x7 (int8)   | Activation:None                                      |\n",

      "|       |                              | 7 (int8)          |                 |                                                      |\n",

      "| 78    | mul                          | 7 (int8)          | 7 (int8)        | Activation:None                                      |\n",

      "|       |                              | 7 (int8)          |                 |                                                      |\n",

      "| 79    | sub                          | 7 (int8)          | 7 (int8)        | Type=suboptions                                      |\n",

      "|       |                              | 7 (int8)          |                 |                                                      |\n",

      "| 80    | add                          | 40x1x7 (int8)     | 40x1x7 (int8)   | Activation:None                                      |\n",

      "|       |                              | 7 (int8)          |                 |                                                      |\n",

      "| 81    | transpose                    | 40x1x7 (int8)     | 7x40x1 (int8)   | Type=none                                            |\n",

      "|       |                              | 4 (int32)         |                 |                                                      |\n",

      "| 82    | reshape                      | 7x40x1 (int8)     | 7x40 (int8)     | Type=none                                            |\n",

      "|       |                              | 3 (int32)         |                 |                                                      |\n",

      "| 83    | mul                          | 7x40 (int8)       | 7x40 (int8)     | Activation:None                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "| 84    | add                          | 7x40 (int8)       | 7x40 (int8)     | Activation:None                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "| 85    | unidirectional_sequence_lstm | 7x40 (int8)       | 7x40 (int8)     | Time major:False, Activation:Tanh, Cell clip:10.0    |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "|       |                              | 40 (int32)        |                 |                                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "|       |                              | 40 (int16)        |                 |                                                      |\n",

      "| 86    | reshape                      | 7x40 (int8)       | 7x40x1 (int8)   | Type=none                                            |\n",

      "|       |                              | 4 (int32)         |                 |                                                      |\n",

      "| 87    | transpose                    | 7x40x1 (int8)     | 40x1x7 (int8)   | Type=none                                            |\n",

      "|       |                              | 4 (int32)         |                 |                                                      |\n",

      "| 88    | mean                         | 40x1x7 (int8)     | 7 (int8)        | Type=reduceroptions                                  |\n",

      "|       |                              | 3 (int32)         |                 |                                                      |\n",

      "| 89    | squared_difference           | 40x1x7 (int8)     | 40x1x7 (int8)   | Type=none                                            |\n",

      "|       |                              | 7 (int8)          |                 |                                                      |\n",

      "| 90    | mean                         | 40x1x7 (int8)     | 7 (int8)        | Type=reduceroptions                                  |\n",

      "|       |                              | 3 (int32)         |                 |                                                      |\n",

      "| 91    | add                          | 7 (int8)          | 7 (int8)        | Activation:None                                      |\n",

      "|       |                              |  (int8)           |                 |                                                      |\n",

      "| 92    | rsqrt                        | 7 (int8)          | 7 (int8)        | Type=none                                            |\n",

      "| 93    | mul                          | 40x1x7 (int8)     | 40x1x7 (int8)   | Activation:None                                      |\n",

      "|       |                              | 7 (int8)          |                 |                                                      |\n",

      "| 94    | mul                          | 7 (int8)          | 7 (int8)        | Activation:None                                      |\n",

      "|       |                              | 7 (int8)          |                 |                                                      |\n",

      "| 95    | sub                          | 7 (int8)          | 7 (int8)        | Type=suboptions                                      |\n",

      "|       |                              | 7 (int8)          |                 |                                                      |\n",

      "| 96    | add                          | 40x1x7 (int8)     | 40x1x7 (int8)   | Activation:None                                      |\n",

      "|       |                              | 7 (int8)          |                 |                                                      |\n",

      "| 97    | transpose                    | 40x1x7 (int8)     | 7x40x1 (int8)   | Type=none                                            |\n",

      "|       |                              | 4 (int32)         |                 |                                                      |\n",

      "| 98    | reshape                      | 7x40x1 (int8)     | 7x40 (int8)     | Type=none                                            |\n",

      "|       |                              | 3 (int32)         |                 |                                                      |\n",

      "| 99    | mul                          | 7x40 (int8)       | 7x40 (int8)     | Activation:None                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "| 100   | add                          | 7x40 (int8)       | 7x40 (int8)     | Activation:None                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "| 101   | strided_slice                | 7x40 (int8)       | 40 (int8)       | Type=stridedsliceoptions                             |\n",

      "|       |                              | 3 (int32)         |                 |                                                      |\n",

      "|       |                              | 3 (int32)         |                 |                                                      |\n",

      "|       |                              | 3 (int32)         |                 |                                                      |\n",

      "| 102   | fully_connected              | 40 (int8)         | 11 (int8)       | Activation:None                                      |\n",

      "|       |                              | 40 (int8)         |                 |                                                      |\n",

      "|       |                              | 11 (int32)        |                 |                                                      |\n",

      "| 103   | reshape                      | 11 (int8)         | 11x1x1 (int8)   | Type=none                                            |\n",

      "|       |                              | 4 (int32)         |                 |                                                      |\n",

      "| 104   | mean                         | 11x1x1 (int8)     | 1 (int8)        | Type=reduceroptions                                  |\n",

      "|       |                              | 3 (int32)         |                 |                                                      |\n",

      "| 105   | squared_difference           | 11x1x1 (int8)     | 11x1x1 (int8)   | Type=none                                            |\n",

      "|       |                              | 1 (int8)          |                 |                                                      |\n",

      "| 106   | mean                         | 11x1x1 (int8)     | 1 (int8)        | Type=reduceroptions                                  |\n",

      "|       |                              | 3 (int32)         |                 |                                                      |\n",

      "| 107   | add                          | 1 (int8)          | 1 (int8)        | Activation:None                                      |\n",

      "|       |                              |  (int8)           |                 |                                                      |\n",

      "| 108   | rsqrt                        | 1 (int8)          | 1 (int8)        | Type=none                                            |\n",

      "| 109   | mul                          | 11x1x1 (int8)     | 11x1x1 (int8)   | Activation:None                                      |\n",

      "|       |                              | 1 (int8)          |                 |                                                      |\n",

      "| 110   | mul                          | 1 (int8)          | 1 (int8)        | Activation:None                                      |\n",

      "|       |                              | 1 (int8)          |                 |                                                      |\n",

      "| 111   | sub                          | 1 (int8)          | 1 (int8)        | Type=suboptions                                      |\n",

      "|       |                              | 1 (int8)          |                 |                                                      |\n",

      "| 112   | add                          | 11x1x1 (int8)     | 11x1x1 (int8)   | Activation:None                                      |\n",

      "|       |                              | 1 (int8)          |                 |                                                      |\n",

      "| 113   | reshape                      | 11x1x1 (int8)     | 11 (int8)       | Type=none                                            |\n",

      "|       |                              | 2 (int32)         |                 |                                                      |\n",

      "| 114   | mul                          | 11 (int8)         | 11 (int8)       | Activation:None                                      |\n",

      "|       |                              | 11 (int8)         |                 |                                                      |\n",

      "| 115   | add                          | 11 (int8)         | 11 (int8)       | Activation:None                                      |\n",

      "|       |                              | 11 (int8)         |                 |                                                      |\n",

      "| 116   | softmax                      | 11 (int8)         | 11 (int8)       | Type=softmaxoptions                                  |\n",

      "| 117   | dequantize                   | 11 (int8)         | 11 (float32)    | Type=none                                            |\n",

      "+-------+------------------------------+-------------------+-----------------+------------------------------------------------------+\n"

     ]

    }

   ],

   "source": [

    "# Get the file path to the .tflite in the keyword_spotting_numbers.mltk.zip model archive\n",

    "tflite_path = mltk_model.tflite_archive_path\n",

    "print(f'.tflite path: {tflite_path}')\n",

    "\n",

    "# Load the .tflite file into a TfliteModel instance\n",

    "tflite_model = TfliteModel.load_flatbuffer_file(tflite_path)\n",

    "\n",

    "# Generate a summary of the model\n",

    "print(tflite_model.summary())"

   ]

  },

  {

   "cell_type": "markdown",

   "metadata": {},

   "source": [

    "## Process the audio sample in the AudioFeatureGenerator\n",

    "\n",

    "Next, we process the audio sample in the [Audio Feature Generator](../../docs/python_api/data_preprocessing/audio_feature_generator.md). This will convert the raw audio into a spectrogram image which can be given to the `.tflite` model for classification.\n",

    "\n",

    "To process the audio sample, we must use the AudioFeatureGenerator [settings](../../docs/guides/model_parameters.md#audiodatasetmixin) embedded into the `.tflite`. These are the settings that were used to train the model and also the settings used by the embedded device at runtime."

   ]

  },

  {

   "cell_type": "code",

   "execution_count": 13,

   "metadata": {},

   "outputs": [

    {

     "name": "stdout",

     "output_type": "stream",

     "text": [

      "Audio frontend settings:\n",

      "{'average_window_duration_ms': 450,\n",

      " 'classes': ['zero',\n",

      "             'one',\n",

      "             'two',\n",

      "             'three',\n",

      "             'four',\n",

      "             'five',\n",

      "             'six',\n",

      "             'seven',\n",

      "             'eight',\n",

      "             'nine',\n",

      "             '_unknown_'],\n",

      " 'date': '2023-08-03T01:11:43.378Z',\n",

      " 'detection_threshold': 242,\n",

      " 'fe.activity_detection_alpha_a': 0.5,\n",

      " 'fe.activity_detection_alpha_b': 0.800000011920929,\n",

      " 'fe.activity_detection_arm_threshold': 0.75,\n",

      " 'fe.activity_detection_enable': False,\n",

      " 'fe.activity_detection_trip_threshold': 0.800000011920929,\n",

      " 'fe.dc_notch_filter_coefficient': 0.949999988079071,\n",

      " 'fe.dc_notch_filter_enable': True,\n",

      " 'fe.fft_length': 512,\n",

      " 'fe.filterbank_lower_band_limit': 125.0,\n",

      " 'fe.filterbank_n_channels': 40,\n",

      " 'fe.filterbank_upper_band_limit': 7500.0,\n",

      " 'fe.log_scale_enable': True,\n",

      " 'fe.log_scale_shift': 6,\n",

      " 'fe.noise_reduction_enable': True,\n",

      " 'fe.noise_reduction_even_smoothing': 0.02500000037252903,\n",

      " 'fe.noise_reduction_min_signal_remaining': 0.4000000059604645,\n",

      " 'fe.noise_reduction_odd_smoothing': 0.05999999865889549,\n",

      " 'fe.noise_reduction_smoothing_bits': 10,\n",

      " 'fe.pcan_enable': False,\n",

      " 'fe.pcan_gain_bits': 21,\n",

      " 'fe.pcan_offset': 80.0,\n",

      " 'fe.pcan_strength': 0.949999988079071,\n",

      " 'fe.quantize_dynamic_scale_enable': False,\n",

      " 'fe.quantize_dynamic_scale_range_db': 40.0,\n",

      " 'fe.sample_length_ms': 1000,\n",

      " 'fe.sample_rate_hz': 16000,\n",

      " 'fe.window_size_ms': 30,\n",

      " 'fe.window_step_ms': 10,\n",

      " 'hash': '4b22adb625a3300fdcf06fa61105782f',\n",

      " 'latency_ms': 10,\n",

      " 'minimum_count': 2,\n",

      " 'name': 'keyword_spotting_numbers',\n",

      " 'runtime_memory_size': 80500,\n",

      " 'samplewise_norm.mean_and_std': True,\n",

      " 'suppression_ms': 700,\n",

      " 'verbose_model_output_logs': False,\n",

      " 'version': 1,\n",

      " 'volume_gain': 0.0}\n",

      "Generated spectrogram shape: 98x40 (uint16)\n",

      "Normalized spectrogram shape: 98x40 (float32)\n",

      ".tflite input spectrogram shape: 98x1x40 (float32)\n"

     ]

    }

   ],

   "source": [

    "# Retrieve the AudioFeatureGenerator settings from the .tflite\n",

    "tflite_params = TfliteModelParameters.load_from_tflite_file(tflite_path)\n",

    "\n",

    "# Load the .tflite parameters into a AudioFeatureGeneratorSettings instance \n",

    "tflite_frontend_settings = AudioFeatureGeneratorSettings(**tflite_params)\n",

    "\n",

    "print(f'Audio frontend settings:\\n{pprint.pformat(tflite_frontend_settings)}')\n",

    "\n",

    "# Adjust the audio sample so that it is the correct length expected by the audio frontend settings\n",

    "frontend_sample_length = int((audio_sample_rate_hz * tflite_frontend_settings.sample_length_ms) / 1000)\n",

    "adjusted_audio_sample_data = audio_utils.adjust_length(\n",

    "    audio_sample_data,\n",

    "    out_length=frontend_sample_length,\n",

    "    trim_threshold_db=30,\n",

    "    offset=0\n",

    ")\n",

    "\n",

    "# Process the length-adjusted audio in the audio frontend (aka AudioFeatureGenerator).\n",

    "# This will generate a spectrogram from the raw audio using the settings embedded into the .tflite\n",

    "spectrogram = audio_utils.apply_frontend(\n",

    "    sample=adjusted_audio_sample_data,\n",

    "    settings=tflite_frontend_settings,\n",

    "    dtype=np.uint16 # We just want the raw, uint16 output of the generated spectrogram\n",

    ")\n",

    "print(f'Generated spectrogram shape: {\"x\".join(map(str, spectrogram.shape))} ({spectrogram.dtype})')\n",

    "\n",

    "# The generated spectrogram is uint16.\n",

    "# However, the keyword_spotting_numbers model expects a normalized, float32 input.\n",

    "# So, we use numpy to normalize the input sample\n",

    "# norm_spectrogram = (spectrogram - mean(spectrogram)) / std(spectrogram)\n",

    "norm_spectrogram = spectrogram.astype(np.float32)\n",

    "norm_spectrogram -= np.mean(norm_spectrogram, dtype=np.float32, keepdims=False)\n",

    "norm_spectrogram /= (np.std(norm_spectrogram, dtype=np.float32, keepdims=False) + 1e-6)\n",

    "print(f'Normalized spectrogram shape: {\"x\".join(map(str, norm_spectrogram.shape))} ({norm_spectrogram.dtype})')\n",

    "\n",

    "# The keyword_spotting_numbers model also expects the input shape to be:\n",

    "# <time, 1, features>\n",

    "# So, we insert an extra dimension:\n",

    "tflite_input_spectrogram = np.expand_dims(norm_spectrogram, axis=-2)\n",

    "print(f'.tflite input spectrogram shape: {\"x\".join(map(str, tflite_input_spectrogram.shape))} ({tflite_input_spectrogram.dtype})')"

   ]

  },

  {

   "cell_type": "markdown",

   "metadata": {},

   "source": [

    "## Classify the audio sample using TF-Lite\n",

    "\n",

    "Next, we give the processed audio sample to the `.tflite` model instance which will classify the audio.\n",

    "The model output is a list of probabilities. The list entry with the largest probability is the \"class\" to which the model thinks the audio sample belongs.\n",

    "\n",

    "__NOTE:__ This uses the default `int8` \"kernels\" that come with [TF-Lite](https://www.tensorflow.org/lite/performance/quantization_spec)"

   ]

  },

  {

   "cell_type": "code",

   "execution_count": 14,

   "metadata": {},

   "outputs": [

    {

     "name": "stdout",

     "output_type": "stream",

     "text": [

      "Raw classification results: [0.         0.         0.         0.         0.         0.\n",

      " 0.         0.99609375 0.         0.         0.        ]\n",

      "The model \"keyword_spotting_numbers\" using the reference int8 Tensorflow-Lite kernels predict that the audio sample file:\n",

      "C:/Users/dried/.mltk/datasets/ten_digits/seven/aws_ar-AE+Hala+seven+medium+medium+1209d48a.wav\n",

      "belongs to the class: \"seven\" with a confidence of 99.6%\n"

     ]

    }

   ],

   "source": [

    "# Give the processed audio sample (which is now a normalized spectrogram)\n",

    "# to the trained and quantized keyword_spotting_numbers.tflite model,\n",

    "# which will classify the sample and return the classification results\n",

    "classification_results = tflite_model.predict(tflite_input_spectrogram)\n",

    "print(f'Raw classification results: {classification_results}')\n",

    "\n",

    "# Find the index of the largest entry in the list\n",

    "predicted_class_index = np.argmax(classification_results)\n",

    "prediction_confidence = classification_results[predicted_class_index]\n",

    "\n",

    "print(f'The model \"{mltk_model.name}\" using the reference int8 Tensorflow-Lite kernels predict that the audio sample file:\\n{audio_sample_path}\\nbelongs to the class: \"{classes[predicted_class_index]}\" with a confidence of {prediction_confidence*100:.1f}%')"

   ]

  },

  {

   "cell_type": "markdown",

   "metadata": {},

   "source": [

    "## Classify the audio using TF-Lite Micro\n",

    "\n",

    "Before, we used the `int8` Tensorflow-Lite kernels that come with the [Tensorflow](https://pypi.org/project/tensorflow/) Python package.\n",

    "\n",

    "Now, let's use the `int8` kernels that come with [Tensorflow-Lite Micro](https://github.com/tensorflow/tflite-micro). We do this by using the [Tensorflow-Lite Micro Python Wrapper](../../docs/cpp_development/wrappers/tflite_micro_wrapper.md) that comes with the MLTK. We use the [TfliteMicro API](../../docs/python_api/tflite_micro_model/index.md) to do this."

   ]

  },

  {

   "cell_type": "code",

   "execution_count": 15,

   "metadata": {},

   "outputs": [

    {

     "name": "stdout",

     "output_type": "stream",

     "text": [

      "Tensorflow-Lite Micro model details:\n",

      "Name: keyword_spotting_numbers\n",

      "Version: 1\n",

      "Date: 2023-08-03T01:11:43.378Z\n",

      "Description: \n",

      "Hash: 4b22adb625a3300fdcf06fa61105782f\n",

      "Accelerator: none\n",

      "Classes: zero, one, two, three, four, five, six, seven, eight, nine, _unknown_\n",

      "Total runtime memory: 73.192 kBytes\n",

      "\n",

      "Raw classification results: [0.         0.         0.         0.         0.         0.\n",

      " 0.         0.99609375 0.         0.         0.        ]\n",

      "The model \"keyword_spotting_numbers\" using the reference int8 Tensorflow-Lite Micro kernels predict that the audio sample file:\n",

      "C:/Users/dried/.mltk/datasets/ten_digits/seven/aws_ar-AE+Hala+seven+medium+medium+1209d48a.wav\n",

      "belongs to the class: \"seven\" with a confidence of 99.6%\n"

     ]

    }

   ],

   "source": [

    "# Load the TfliteMicroModel instance\n",

    "tflm_model = TfliteMicro.load_tflite_model(tflite_path)\n",

    "print(f'Tensorflow-Lite Micro model details:\\n{tflm_model.details}')\n",

    "\n",

    "try:\n",

    "    # Load the audio sample into the TFLM model instance's input tensor\n",

    "    tflm_model.input(value=tflite_input_spectrogram)\n",

    "\n",

    "    # Run inference (which will use the TFLM int8 SW reference kernels)\n",

    "    tflm_model.invoke()\n",

    "\n",

    "    # Retrieve the classification results:\n",

    "    # NOTE: The results has the shape 1x11, hence the [0]\n",

    "    classification_results = tflm_model.output()[0]\n",

    "    print(f'Raw classification results: {classification_results}')\n",

    "\n",

    "    # Find the index of the largest entry in the list\n",

    "    predicted_class_index = np.argmax(classification_results)\n",

    "    prediction_confidence = classification_results[predicted_class_index]\n",

    "\n",

    "    print(f'The model \"{mltk_model.name}\" using the reference int8 Tensorflow-Lite Micro kernels predict that the audio sample file:\\n{audio_sample_path}\\nbelongs to the class: \"{classes[predicted_class_index]}\" with a confidence of {prediction_confidence*100:.1f}%')\n",

    "finally:\n",

    "    # We MUST unload the model after we're done with it\n",

    "    TfliteMicro.unload_model(tflm_model)"

   ]

  }

 ],

 "metadata": {

  "kernelspec": {

   "display_name": ".venv",

   "language": "python",

   "name": "python3"

  },

  "language_info": {

   "codemirror_mode": {

    "name": "ipython",

    "version": 3

   },

   "file_extension": ".py",

   "mimetype": "text/x-python",

   "name": "python",

   "nbconvert_exporter": "python",

   "pygments_lexer": "ipython3",

   "version": "3.8.10"

  },

  "orig_nbformat": 4

 },

 "nbformat": 4,

 "nbformat_minor": 2

}

