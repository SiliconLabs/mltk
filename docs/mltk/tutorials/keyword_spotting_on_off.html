
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="title" content="Machine Learning Toolkit">
<meta name="description" content="A Python package with command-line utilities and scripts to aid the development of machine learning models for Silicon Lab's embedded platforms">
<meta name="keywords" content="machine learning, machine-learning, machinelearning, ml, ai, iot, Internet of things, aiot, tinyml, tensorflow, tensorflow-lite, tensorflow-lite-micro, keras-tensorflow, keras, tflite, embedded, embedded-systems, mcu, Microcontrollers, hardware, python, c++, cmake, keras, numpy, silabs, silicon labs">
<meta name="robots" content="index, follow">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="language" content="English">
<meta name="author" content="Silicon Labs">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HZ5MW943WF"></script>
<script>
    window.gTrackingId = 'G-HZ5MW943WF';
</script>
<meta name="google-site-verification" content="dsSsmnE2twOnfSAQk5zBBTrjMArsTJj809Bp-8mVlIw" />
  
  
    <title>Keyword Spotting - On/Off &#8212; MLTK 0.19.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="../../_static/js/custom.js"></script>
    <script src="../../_static/js/apitoc.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Keyword Spotting - Pac-Man" href="keyword_spotting_pacman.html" />
    <link rel="prev" title="Tutorials" href="../../docs/tutorials.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=red data-md-color-accent=light-blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#mltk/tutorials/keyword_spotting_on_off" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../index.html" title="MLTK 0.19.0 documentation"
           class="md-header-nav__button md-logo">
          
              <img src="../../_static/logo.png"
                   alt="MLTK 0.19.0 documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Machine Learning Toolkit</span>
          <span class="md-header-nav__topic"> Keyword Spotting - On/Off </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/siliconlabs/mltk" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    MLTK Github Repository
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="https://docs.silabs.com/gecko-platform/latest/machine-learning/tensorflow/overview" class="md-tabs__link">Gecko SDK Documentation</a></li>
            
            <li class="md-tabs__item"><a href="https://github.com/tensorflow/tflite-micro" class="md-tabs__link">Tensorflow-Lite Micro Repository</a></li>
            
            <li class="md-tabs__item"><a href="https://www.tensorflow.org/learn" class="md-tabs__link">Tensorflow Documentation</a></li>
          <li class="md-tabs__item"><a href="../../docs/tutorials.html" class="md-tabs__link">Tutorials</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../index.html" title="MLTK 0.19.0 documentation" class="md-nav__button md-logo">
      
        <img src="../../_static/logo.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../index.html"
       title="MLTK 0.19.0 documentation">Machine Learning Toolkit</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/siliconlabs/mltk" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    MLTK Github Repository
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Basics</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/why_mltk.html" class="md-nav__link">Why MLTK?</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/command_line/index.html" class="md-nav__link">Command-Line</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/guides/index.html" class="md-nav__link">Modeling Guides</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Usage</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/tutorials.html" class="md-nav__link">Tutorials</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Keyword Spotting - On/Off </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Keyword Spotting - On/Off</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="" id="localtoc">
        <li class="md-nav__item"><a href="#mltk-tutorials-keyword-spotting-on-off--page-root" class="md-nav__link">Keyword Spotting - On/Off</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#quick-links" class="md-nav__link">Quick Links</a>
        </li>
        <li class="md-nav__item"><a href="#overview" class="md-nav__link">Overview</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#objectives" class="md-nav__link">Objectives</a>
        </li>
        <li class="md-nav__item"><a href="#content" class="md-nav__link">Content</a>
        </li>
        <li class="md-nav__item"><a href="#running-this-tutorial-from-the-command-line" class="md-nav__link">Running this tutorial from the command-line</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#install-mltk-python-package" class="md-nav__link">Install MLTK Python Package</a>
        </li>
        <li class="md-nav__item"><a href="#machine-learning-and-keyword-spotting-overview" class="md-nav__link">Machine Learning and Keyword-Spotting Overview</a>
        </li>
        <li class="md-nav__item"><a href="#dataset-selection-and-preprocessing-parameters" class="md-nav__link">Dataset Selection and Preprocessing Parameters</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#tl-dr" class="md-nav__link">TL;DR</a>
        </li>
        <li class="md-nav__item"><a href="#acquire-a-representative-dataset" class="md-nav__link">Acquire a Representative Dataset</a>
        </li>
        <li class="md-nav__item"><a href="#synthetically-generated-dataset" class="md-nav__link">Synthetically Generated Dataset</a>
        </li>
        <li class="md-nav__item"><a href="#creating-an-unknown-class" class="md-nav__link">Creating an “Unknown” Class</a>
        </li>
        <li class="md-nav__item"><a href="#dataset-summary" class="md-nav__link">Dataset Summary</a>
        </li>
        <li class="md-nav__item"><a href="#final-note-about-the-dataset" class="md-nav__link">Final note about the dataset</a>
        </li>
        <li class="md-nav__item"><a href="#feature-engineering" class="md-nav__link">Feature Engineering</a>
        </li>
        <li class="md-nav__item"><a href="#featuring-engineering-on-the-edge" class="md-nav__link">Featuring Engineering on the Edge</a>
        </li>
        <li class="md-nav__item"><a href="#data-augmentation" class="md-nav__link">Data Augmentation</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#random-impulse-response" class="md-nav__link">Random Impulse Response</a>
        </li>
        <li class="md-nav__item"><a href="#random-unknown-samples-by-cropping-known-samples" class="md-nav__link">Random “unknown” samples by cropping “known” samples</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#model-specification" class="md-nav__link">Model Specification</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#define-model-object" class="md-nav__link">Define Model Object</a>
        </li>
        <li class="md-nav__item"><a href="#configure-the-general-model-settings" class="md-nav__link">Configure the general model settings</a>
        </li>
        <li class="md-nav__item"><a href="#configure-the-basic-training-settings" class="md-nav__link">Configure the basic training settings</a>
        </li>
        <li class="md-nav__item"><a href="#configure-the-training-callbacks" class="md-nav__link">Configure the training callbacks</a>
        </li>
        <li class="md-nav__item"><a href="#configure-the-tf-lite-converter-settings" class="md-nav__link">Configure the TF-Lite Converter settings</a>
        </li>
        <li class="md-nav__item"><a href="#define-the-model-architecture" class="md-nav__link">Define the model architecture</a>
        </li>
        <li class="md-nav__item"><a href="#audio-feature-generator-settings" class="md-nav__link">Audio Feature Generator Settings</a>
        </li>
        <li class="md-nav__item"><a href="#configure-the-keywords-to-detect" class="md-nav__link">Configure the keywords to detect</a>
        </li>
        <li class="md-nav__item"><a href="#data-pipeline" class="md-nav__link">Data Pipeline</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#audio-visualization" class="md-nav__link">Audio Visualization</a>
        </li>
        <li class="md-nav__item"><a href="#model-parameters" class="md-nav__link">Model Parameters</a>
        </li>
        <li class="md-nav__item"><a href="#model-summary" class="md-nav__link">Model Summary</a>
        </li>
        <li class="md-nav__item"><a href="#model-visualization" class="md-nav__link">Model Visualization</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#visualize-keras-model" class="md-nav__link">Visualize Keras model</a>
        </li>
        <li class="md-nav__item"><a href="#visualize-tf-lite-model" class="md-nav__link">Visualize TF-Lite model</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#model-profiler" class="md-nav__link">Model Profiler</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#profile-in-simulator" class="md-nav__link">Profile in simulator</a>
        </li>
        <li class="md-nav__item"><a href="#profile-on-physical-device" class="md-nav__link">Profile on physical device</a>
        </li>
        <li class="md-nav__item"><a href="#note-about-cpu-utilization" class="md-nav__link">Note about CPU utilization</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#model-training" class="md-nav__link">Model Training</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#train-as-a-dry-run" class="md-nav__link">Train as a “dry run”</a>
        </li>
        <li class="md-nav__item"><a href="#training-locally" class="md-nav__link">Training locally</a>
        </li>
        <li class="md-nav__item"><a href="#train-in-cloud" class="md-nav__link">Train in cloud</a>
        </li>
        <li class="md-nav__item"><a href="#note-about-training-time" class="md-nav__link">Note about training time</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#model-evaluation" class="md-nav__link">Model Evaluation</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#command" class="md-nav__link">Command</a>
        </li>
        <li class="md-nav__item"><a href="#note-about-model-accuracy" class="md-nav__link">Note about model accuracy</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#model-testing" class="md-nav__link">Model Testing</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#classify-audio-on-pc" class="md-nav__link">Classify audio on PC</a>
        </li>
        <li class="md-nav__item"><a href="#classify-audio-on-device" class="md-nav__link">Classify audio on device</a>
        </li>
        <li class="md-nav__item"><a href="#record-audio-and-spectrograms-from-device" class="md-nav__link">Record audio and spectrograms from device</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#deploying-the-model" class="md-nav__link">Deploying the Model</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#using-simplicity-studio" class="md-nav__link">Using Simplicity Studio</a>
        </li>
        <li class="md-nav__item"><a href="#using-the-mltk" class="md-nav__link">Using the MLTK</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
      <script type="text/javascript" src=../../_static/js/apitoc.js></script>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="keyword_spotting_pacman.html" class="md-nav__link">Keyword Spotting - Pac-Man</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="keyword_spotting_alexa.html" class="md-nav__link">Keyword Spotting - Alexa</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="image_classification.html" class="md-nav__link">Image Classification - Rock, Paper, Scissors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cloud_training_with_vast_ai.html" class="md-nav__link">Cloud Training with vast.ai</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cloud_logging_with_wandb.html" class="md-nav__link">Cloud Logging with Weights & Biases</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="model_optimization.html" class="md-nav__link">Model Optimization for MVP Hardware Accelerator</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="keyword_spotting_with_transfer_learning.html" class="md-nav__link">Keyword Spotting with Transfer Learning</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="fingerprint_authentication.html" class="md-nav__link">Fingerprint Authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="onnx_to_tflite.html" class="md-nav__link">ONNX to TF-Lite Model Conversion</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="model_debugging.html" class="md-nav__link">Model Debugging</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="add_existing_script_to_mltk.html" class="md-nav__link">Add an Existing Script to the MLTK</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="synthetic_audio_dataset_generation.html" class="md-nav__link">Synthetic Audio Dataset Generation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="model_quantization_tips.html" class="md-nav__link">Model Quantization Tips</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="quantized_lstm.html" class="md-nav__link">Quantized LSTM</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/examples.html" class="md-nav__link">API Examples</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/python_api/index.html" class="md-nav__link">API Reference</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/python_api/models/index.html" class="md-nav__link">Reference Models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/python_api/datasets/index.html" class="md-nav__link">Reference Datasets</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/cpp_development/index.html" class="md-nav__link">C++ Development</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/cpp_development/examples/index.html" class="md-nav__link">C++ Examples</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Audio Related</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/audio/keyword_spotting_overview.html" class="md-nav__link">Keyword Spotting Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/audio/audio_feature_generator.html" class="md-nav__link">Audio Feature Generator</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/audio/audio_utilities.html" class="md-nav__link">Audio Utilities</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Other Information</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/faq/index.html" class="md-nav__link">Frequently Asked Questions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/other/quick_reference.html" class="md-nav__link">Quick Reference</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/other/supported_hardware.html" class="md-nav__link">Supported Hardware</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/guides/notebook_examples_guide.html" class="md-nav__link">Notebook Examples Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/other/settings_file.html" class="md-nav__link">Settings File</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../docs/other/environment_variables.html" class="md-nav__link">Environment Variables</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="" id="localtoc">
        <li class="md-nav__item"><a href="#mltk-tutorials-keyword-spotting-on-off--page-root" class="md-nav__link">Keyword Spotting - On/Off</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#quick-links" class="md-nav__link">Quick Links</a>
        </li>
        <li class="md-nav__item"><a href="#overview" class="md-nav__link">Overview</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#objectives" class="md-nav__link">Objectives</a>
        </li>
        <li class="md-nav__item"><a href="#content" class="md-nav__link">Content</a>
        </li>
        <li class="md-nav__item"><a href="#running-this-tutorial-from-the-command-line" class="md-nav__link">Running this tutorial from the command-line</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#install-mltk-python-package" class="md-nav__link">Install MLTK Python Package</a>
        </li>
        <li class="md-nav__item"><a href="#machine-learning-and-keyword-spotting-overview" class="md-nav__link">Machine Learning and Keyword-Spotting Overview</a>
        </li>
        <li class="md-nav__item"><a href="#dataset-selection-and-preprocessing-parameters" class="md-nav__link">Dataset Selection and Preprocessing Parameters</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#tl-dr" class="md-nav__link">TL;DR</a>
        </li>
        <li class="md-nav__item"><a href="#acquire-a-representative-dataset" class="md-nav__link">Acquire a Representative Dataset</a>
        </li>
        <li class="md-nav__item"><a href="#synthetically-generated-dataset" class="md-nav__link">Synthetically Generated Dataset</a>
        </li>
        <li class="md-nav__item"><a href="#creating-an-unknown-class" class="md-nav__link">Creating an “Unknown” Class</a>
        </li>
        <li class="md-nav__item"><a href="#dataset-summary" class="md-nav__link">Dataset Summary</a>
        </li>
        <li class="md-nav__item"><a href="#final-note-about-the-dataset" class="md-nav__link">Final note about the dataset</a>
        </li>
        <li class="md-nav__item"><a href="#feature-engineering" class="md-nav__link">Feature Engineering</a>
        </li>
        <li class="md-nav__item"><a href="#featuring-engineering-on-the-edge" class="md-nav__link">Featuring Engineering on the Edge</a>
        </li>
        <li class="md-nav__item"><a href="#data-augmentation" class="md-nav__link">Data Augmentation</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#random-impulse-response" class="md-nav__link">Random Impulse Response</a>
        </li>
        <li class="md-nav__item"><a href="#random-unknown-samples-by-cropping-known-samples" class="md-nav__link">Random “unknown” samples by cropping “known” samples</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#model-specification" class="md-nav__link">Model Specification</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#define-model-object" class="md-nav__link">Define Model Object</a>
        </li>
        <li class="md-nav__item"><a href="#configure-the-general-model-settings" class="md-nav__link">Configure the general model settings</a>
        </li>
        <li class="md-nav__item"><a href="#configure-the-basic-training-settings" class="md-nav__link">Configure the basic training settings</a>
        </li>
        <li class="md-nav__item"><a href="#configure-the-training-callbacks" class="md-nav__link">Configure the training callbacks</a>
        </li>
        <li class="md-nav__item"><a href="#configure-the-tf-lite-converter-settings" class="md-nav__link">Configure the TF-Lite Converter settings</a>
        </li>
        <li class="md-nav__item"><a href="#define-the-model-architecture" class="md-nav__link">Define the model architecture</a>
        </li>
        <li class="md-nav__item"><a href="#audio-feature-generator-settings" class="md-nav__link">Audio Feature Generator Settings</a>
        </li>
        <li class="md-nav__item"><a href="#configure-the-keywords-to-detect" class="md-nav__link">Configure the keywords to detect</a>
        </li>
        <li class="md-nav__item"><a href="#data-pipeline" class="md-nav__link">Data Pipeline</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#audio-visualization" class="md-nav__link">Audio Visualization</a>
        </li>
        <li class="md-nav__item"><a href="#model-parameters" class="md-nav__link">Model Parameters</a>
        </li>
        <li class="md-nav__item"><a href="#model-summary" class="md-nav__link">Model Summary</a>
        </li>
        <li class="md-nav__item"><a href="#model-visualization" class="md-nav__link">Model Visualization</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#visualize-keras-model" class="md-nav__link">Visualize Keras model</a>
        </li>
        <li class="md-nav__item"><a href="#visualize-tf-lite-model" class="md-nav__link">Visualize TF-Lite model</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#model-profiler" class="md-nav__link">Model Profiler</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#profile-in-simulator" class="md-nav__link">Profile in simulator</a>
        </li>
        <li class="md-nav__item"><a href="#profile-on-physical-device" class="md-nav__link">Profile on physical device</a>
        </li>
        <li class="md-nav__item"><a href="#note-about-cpu-utilization" class="md-nav__link">Note about CPU utilization</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#model-training" class="md-nav__link">Model Training</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#train-as-a-dry-run" class="md-nav__link">Train as a “dry run”</a>
        </li>
        <li class="md-nav__item"><a href="#training-locally" class="md-nav__link">Training locally</a>
        </li>
        <li class="md-nav__item"><a href="#train-in-cloud" class="md-nav__link">Train in cloud</a>
        </li>
        <li class="md-nav__item"><a href="#note-about-training-time" class="md-nav__link">Note about training time</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#model-evaluation" class="md-nav__link">Model Evaluation</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#command" class="md-nav__link">Command</a>
        </li>
        <li class="md-nav__item"><a href="#note-about-model-accuracy" class="md-nav__link">Note about model accuracy</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#model-testing" class="md-nav__link">Model Testing</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#classify-audio-on-pc" class="md-nav__link">Classify audio on PC</a>
        </li>
        <li class="md-nav__item"><a href="#classify-audio-on-device" class="md-nav__link">Classify audio on device</a>
        </li>
        <li class="md-nav__item"><a href="#record-audio-and-spectrograms-from-device" class="md-nav__link">Record audio and spectrograms from device</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#deploying-the-model" class="md-nav__link">Deploying the Model</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#using-simplicity-studio" class="md-nav__link">Using Simplicity Studio</a>
        </li>
        <li class="md-nav__item"><a href="#using-the-mltk" class="md-nav__link">Using the MLTK</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
      <script type="text/javascript" src=../../_static/js/apitoc.js></script>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">

          
          <div class="breadcrumbs md-typeset">
            <ul class="breadcrumb">
              <li></li>
              <li><a href="../../index.html"><i class="md-icon">home</i></a></li>
                <li><a href="../../docs/tutorials.html" accesskey="U">Tutorials</a></li>

              <li class="activate"><a>Keyword Spotting - On/Off</a></li>
            </ul>
          </div>
          

          <article class="md-content__inner md-typeset" role="main">
            
  <section id="keyword-spotting-on-off">
<h1 id="mltk-tutorials-keyword-spotting-on-off--page-root">Keyword Spotting - On/Off<a class="headerlink" href="#mltk-tutorials-keyword-spotting-on-off--page-root" title="Permalink to this heading">¶</a></h1>
<p>This tutorial describes how to use the MLTK to develop a machine learning model to detect the keywords:</p>
<ul class="simple">
<li><p><strong>On</strong></p></li>
<li><p><strong>Off</strong></p></li>
</ul>
<section id="quick-links">
<h2 id="quick-links">Quick Links<a class="headerlink" href="#quick-links" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/SiliconLabs/mltk/blob/master/mltk/tutorials/keyword_spotting_on_off.ipynb">GitHub Source</a> - View this tutorial on Github</p></li>
<li><p><a class="reference internal" href="cloud_training_with_vast_ai.html"><span class="doc std std-doc">Train in the “Cloud”</span></a> - <em>Vastly</em> improve training times by training this model in the “cloud”</p></li>
<li><p><a class="reference internal" href="../../docs/cpp_development/examples/audio_classifier.html"><span class="doc std std-doc">C++ Example Application</span></a> - View this tutorial’s associated C++ example application</p></li>
<li><p><a class="reference internal" href="../../docs/python_api/models/siliconlabs/keyword_spotting_on_off_v3.html"><span class="doc std std-doc">Machine Learning Model</span></a> - View this tutorial’s associated machine learning model</p></li>
</ul>
</section>
<section id="overview">
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<section id="objectives">
<h3 id="objectives">Objectives<a class="headerlink" href="#objectives" title="Permalink to this heading">¶</a></h3>
<p>After completing this tutorial, you will have:</p>
<ol class="arabic simple">
<li><p>A better understanding of how keyword-spotting (KWS) machine learning models work</p></li>
<li><p>All of the tools needed to develop your own KWS machine learning model</p></li>
<li><p>A working demo to turn an LED on/off based on the voice commands of your choice</p></li>
</ol>
</section>
<section id="content">
<h3 id="content">Content<a class="headerlink" href="#content" title="Permalink to this heading">¶</a></h3>
<p>This tutorial is divided into the following sections:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#machine-learning-and-keyword-spotting-overview"><span class="std std-doc">Overview of machine learning and keyword-spotting</span></a></p></li>
<li><p><a class="reference internal" href="#dataset-selection-and-preprocessing-parameters"><span class="std std-doc">Dataset selection and preprocessing parameters</span></a></p></li>
<li><p><a class="reference internal" href="#model-specification"><span class="std std-doc">Creating the model specification</span></a></p></li>
<li><p><a class="reference internal" href="#audio-visualization"><span class="std std-doc">Visualizing the audio dataset</span></a></p></li>
<li><p><a class="reference internal" href="#model-parameters"><span class="std std-doc">Note about model parameters</span></a></p></li>
<li><p><a class="reference internal" href="#model-visualization"><span class="std std-doc">Summarizing the model</span></a></p></li>
<li><p><a class="reference internal" href="#model-visualization"><span class="std std-doc">Visualizing the model graph</span></a></p></li>
<li><p><a class="reference internal" href="#model-profiler"><span class="std std-doc">Profiling the model</span></a></p></li>
<li><p><a class="reference internal" href="#model-training"><span class="std std-doc">Training the model</span></a></p></li>
<li><p><a class="reference internal" href="#model-evaluation"><span class="std std-doc">Evaluating the model</span></a></p></li>
<li><p><a class="reference internal" href="#model-testing"><span class="std std-doc">Testing the model</span></a></p></li>
<li><p><a class="reference internal" href="#deploying-the-model"><span class="std std-doc">Deploying the model to an embedded device</span></a></p></li>
</ol>
</section>
<section id="running-this-tutorial-from-the-command-line">
<h3 id="running-this-tutorial-from-the-command-line">Running this tutorial from the command-line<a class="headerlink" href="#running-this-tutorial-from-the-command-line" title="Permalink to this heading">¶</a></h3>
<p>While this tutorial uses a <a class="reference external" href="https://jupyter.org">Jupyter Notebook</a>,
the recommended approach is to use your favorite text editor and standard command terminal, no Jupyter Notebook required.</p>
<p>See the <a class="reference external" href="../../docs/installation.html#standard-python-package">Standard Python Package Installation</a> guide for more details on how to enable the <code class="docutils literal notranslate"><span class="pre">mltk</span></code> command in your local terminal.</p>
<p>In this mode, when you encounter a <code class="docutils literal notranslate"><span class="pre">!mltk</span></code> command in this tutorial, the command should actually run in your local terminal (excluding the <code class="docutils literal notranslate"><span class="pre">!</span></code>)</p>
</section>
</section>
<section id="install-mltk-python-package">
<h2 id="install-mltk-python-package">Install MLTK Python Package<a class="headerlink" href="#install-mltk-python-package" title="Permalink to this heading">¶</a></h2>
<p>Before using the MLTK, it must first be installed.<br/>
See the <a class="reference internal" href="../../docs/installation.html"><span class="doc std std-doc">Installation Guide</span></a> for more details.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>silabs-mltk
</pre></div>
</div>
</div>
</div>
<p>All MLTK modeling operations are accessible via the <code class="docutils literal notranslate"><span class="pre">mltk</span></code> command.<br/>
Run the command <code class="docutils literal notranslate"><span class="pre">mltk</span> <span class="pre">--help</span></code> to ensure it is working.<br/>
<strong>NOTE:</strong> The exclamation point <code class="docutils literal notranslate"><span class="pre">!</span></code> tells the Notebook to run a shell command, it is not required in a <a class="reference external" href="../../docs/installation.html#standard-python-package">standard terminal</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mltk<span class="w"> </span>--help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Usage: mltk [OPTIONS] COMMAND [ARGS]...

  Silicon Labs Machine Learning Toolkit

  This is a Python package with command-line utilities and scripts to aid the
  development of machine learning models for Silicon Lab's embedded platforms.

Options:
  --version  Display the version of this mltk package and exit
  --help     Show this message and exit.

Commands:
  build           MLTK build commands
  classify_audio  Classify keywords/events detected in a microphone's...
  commander       Silab's Commander Utility
  custom          Custom Model Operations
  evaluate        Evaluate a trained ML model
  profile         Profile a model
  quantize        Quantize a model into a .tflite file
  summarize       Generate a summary of a model
  train           Train an ML model
  update_params   Update the parameters of a previously trained model
  utest           Run the all unit tests
  view            View an interactive graph of the given model in a...
  view_audio      View the spectrograms generated by the...
</pre></div>
</div>
</div>
</div>
</section>
<section id="machine-learning-and-keyword-spotting-overview">
<h2 id="machine-learning-and-keyword-spotting-overview">Machine Learning and Keyword-Spotting Overview<a class="headerlink" href="#machine-learning-and-keyword-spotting-overview" title="Permalink to this heading">¶</a></h2>
<p>Before continuing with this tutorial, it is recommended to review the following presentations:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../docs/overview.html"><span class="doc std std-doc">MLTK Overview</span></a> - An overview of the core concepts used by the this tutorial</p></li>
<li><p><a class="reference internal" href="../../docs/audio/keyword_spotting_overview.html"><span class="doc std std-doc">Keyword Spotting Overview</span></a> - An overview of how keyword spotting works</p></li>
</ul>
</section>
<section id="dataset-selection-and-preprocessing-parameters">
<h2 id="dataset-selection-and-preprocessing-parameters">Dataset Selection and Preprocessing Parameters<a class="headerlink" href="#dataset-selection-and-preprocessing-parameters" title="Permalink to this heading">¶</a></h2>
<p>Before starting the actual tutorial, let’s first discuss datasets.</p>
<section id="tl-dr">
<h3 id="tl-dr">TL;DR<a class="headerlink" href="#tl-dr" title="Permalink to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>A <em>representative</em> dataset must be acquired for the trained model to perform well in the real-world</p>
<ul class="simple">
<li><p>Having a representative “unknown” class is critical; detecting the “known” classes is easy; rejecting everything else is hard.</p></li>
</ul>
</li>
<li><p>The dataset should (typically) be transformed so that the model can efficiently learn the features of the dataset</p></li>
<li><p>Whatever transformations are used must be identical at training-time on the PC and run-time on the embedded device</p></li>
<li><p>The size of the dataset can be effectively increased by randomly augmenting it during training (changing the pitch, speed, adding background noise, etc.)</p></li>
</ol>
</section>
<section id="acquire-a-representative-dataset">
<h3 id="acquire-a-representative-dataset">Acquire a Representative Dataset<a class="headerlink" href="#acquire-a-representative-dataset" title="Permalink to this heading">¶</a></h3>
<p>The most critical aspect of any machine learning model is the dataset. A <em>representative</em> dataset is necessary to train a robust model.
A model that is trained on a dataset that is too small and/or not representative of what would be seen in the real-world will likely not perform well.</p>
<p>In this tutorial, we want to create a keyword spotting classification machine learning model. This implies the following about the dataset:</p>
<ul class="simple">
<li><p>The dataset must contain audio samples of the keywords we want to detect</p></li>
<li><p>The dataset must be labelled, i.e. each sample in the dataset must have an associated “class”, e.g. “on”, “off”</p></li>
<li><p>The dataset must be relatively large and representative to account for the variance in spoken language (accents, background noise, etc.)</p></li>
</ul>
<p>For this tutorial, we’ll use the <a class="reference external" href="https://www.tensorflow.org/datasets/catalog/speech_commands">Google Speech Commands v2</a> dataset
(<strong>NOTE:</strong> This dataset is automatically downloaded in a later step in this tutorial).<br/>
This dataset is effectively a directory of sub-directories, and each sub-directory contains thousands of 1s audio clips.
The name of each sub-directory corresponds to the word being spoken in the audio clip, e.g:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/dataset</span>
<span class="go">/dataset/on</span>
<span class="go">/dataset/on/sample1.wav</span>
<span class="go">/dataset/on/sample2.wav</span>
<span class="go">...</span>
<span class="go">/dataset/off</span>
<span class="go">/dataset/off/sample1.wav</span>
<span class="go">/dataset/off/sample2.wav</span>
<span class="go">...</span>
</pre></div>
</div>
</section>
<section id="synthetically-generated-dataset">
<h3 id="synthetically-generated-dataset">Synthetically Generated Dataset<a class="headerlink" href="#synthetically-generated-dataset" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference external" href="https://www.tensorflow.org/datasets/catalog/speech_commands">Google Speech Commands v2</a> is relatively small. The “on” and “off” classes only have about 3k samples.
To create a robust model that works in the real-world, the dataset should have 10k+ samples (or even 100k+).</p>
<p>However, creating a large dataset can be expensive. To help overcome this, we use the <a class="reference internal" href="../../docs/python_api/utils/audio_dataset_generator/index.html"><span class="doc std std-doc">AudioDatasetGenerator</span></a>
utility that comes with the MLTK. This is a utility that automatically generates audio samples using the Google, Amazon, and Microsoft clouds.
Refer to the <a class="reference internal" href="synthetic_audio_dataset_generation.html"><span class="doc std std-doc">Synthetic Audio Dataset Generation</span></a> tutorial for more details.</p>
<p>With this utility, we generate the <a class="reference internal" href="../../docs/python_api/datasets/audio/on_off.html"><span class="doc std std-doc">Synthetic On/off Dataset</span></a> which adds about 15k more samples to our training dataset.</p>
</section>
<section id="creating-an-unknown-class">
<h3 id="creating-an-unknown-class">Creating an “Unknown” Class<a class="headerlink" href="#creating-an-unknown-class" title="Permalink to this heading">¶</a></h3>
<p>Creating a model that can detect the “known” classes (i.e. “on” and “off”) is relatively easy.
Creating a model that can also reliably reject everything else is typically a much harder problem.
For instance, consider that we are making a voice-controlled light switch that turns the lights on and off. In this case, the lights must only change with the keywords “on” and “off”.
The switch must ignore all other sounds. (It would make for a poor user experience if the lights changed while having a conversation next to the switch.) This is why the “unknown” class is critical.
The model should predict the “unknown” class for every other sound that is not a “known” class.</p>
<p>So to summarize:</p>
<ul class="simple">
<li><p><strong>Known classes</strong> - The keywords we want to detection (i.e. “on” and “off”)</p></li>
<li><p><strong>Unknown class</strong> - Every other possible sound that might be heard in the field (silence, other words, random household noises, etc.)</p></li>
</ul>
<p>To help create a <em>representative</em> “unknown” class, we use several datasets:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../docs/python_api/datasets/audio/ml_commons/keywords.html"><span class="doc std std-doc">ML Commons Keywords</span></a> - Multilingual Spoken Words Corpus is a large and growing audio dataset of spoken words in 50 languages</p></li>
<li><p><a class="reference internal" href="../../docs/python_api/datasets/audio/background_noise/esc50.html"><span class="doc std std-doc">Environmental Sound Classification</span></a> - Collection of 2k short clips comprising 50 classes of various common sound events</p></li>
</ul>
</section>
<section id="dataset-summary">
<h3 id="dataset-summary">Dataset Summary<a class="headerlink" href="#dataset-summary" title="Permalink to this heading">¶</a></h3>
<p>This model was trained using several different datasets:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../docs/python_api/datasets/audio/on_off.html"><span class="doc std std-doc">mltk.datasets.audio.on_off</span></a> - Synthetically generated keywords: on, off</p></li>
<li><p><a class="reference internal" href="../../docs/python_api/datasets/audio/speech_commands_v2.html"><span class="doc std std-doc">mltk.datasets.audio.speech_commands_v2</span></a> - Human generated keywords: on, off</p></li>
<li><p><a class="reference internal" href="../../docs/python_api/datasets/audio/ml_commons/keywords.html"><span class="doc std std-doc">mltk.datasets.audio.mlcommons.ml_commons_keyword</span></a> - Large collection of keywords, random subset used for <em>unknown</em> class</p></li>
<li><p><a class="reference internal" href="../../docs/python_api/datasets/audio/background_noise/esc50.html"><span class="doc std std-doc">mltk.datasets.audio.background_noise.esc50</span></a> - Collection of various noises, random subset used for <em>unknown</em> class</p></li>
<li><p><a class="reference internal" href="../../docs/python_api/datasets/audio/background_noise/ambient.html"><span class="doc std std-doc">mltk.datasets.audio.background_noise.ambient</span></a> - Collection of various background noises, mixed into other samples for augmentation</p></li>
<li><p><a class="reference internal" href="../../docs/python_api/datasets/audio/background_noise/brd2601.html"><span class="doc std std-doc">mltk.datasets.audio.background_noise.brd2601</span></a> - “Silence” recorded by BRD2601 microphone, mixed into other samples to make them “sound” like they</p></li>
<li><p><a class="reference internal" href="../../docs/python_api/datasets/audio/mit_ir_survey.html"><span class="doc std std-doc">mltk.datasets.audio.mit_ir_survey</span></a> - Impulse responses that are randomly convolved with the samples. This makes the samples sound if they were recorded in different environments</p></li>
</ul>
</section>
<section id="final-note-about-the-dataset">
<h3 id="final-note-about-the-dataset">Final note about the dataset<a class="headerlink" href="#final-note-about-the-dataset" title="Permalink to this heading">¶</a></h3>
<p>The combined datasets meet our requirements:</p>
<ul class="simple">
<li><p>They contain audio samples of the keywords we want to detect (“on”, “off”)</p></li>
<li><p>The samples are labelled (all “on” samples are in the “on” sub-directory etc.)</p></li>
<li><p>The dataset is representative (the audio clips are taken from many different people saying the same words, <em>as well as</em> randomly audio samples for the “unknown” or “negative” class)</p></li>
</ul>
<p><strong>NOTE:</strong> For many machine learning applications acquiring a dataset will not be so easy.
Many times the dataset will suffer from one or more of the following:</p>
<ul class="simple">
<li><p>The dataset does not exist - Need to manually collect samples</p></li>
<li><p>The raw samples exist but are not “labeled” - Need to manually group the samples</p></li>
<li><p>The dataset is “dirty” - Bad/corrupt samples, mislabeled samples</p></li>
<li><p>The dataset is not representative - Duplicate/similar samples, not diverse enough to cover the possible range seen in the real-world</p></li>
</ul>
<p><strong>NOTE:</strong> A clean, representative dataset is one of the best ways to train a robust model.
It is <em>highly</em> recommended to invest the time/energy to create a good dataset!</p>
</section>
<section id="feature-engineering">
<h3 id="feature-engineering">Feature Engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this heading">¶</a></h3>
<p>Along with a representative dataset, we (usually) need to transform the individual samples of the dataset
so that the machine learning model can efficiently learn the “features” of the dataset, and thus make accurate predictions.
This process is frequently called “feature engineering”. One way of describing feature engineering is:
Use human insight to amplify the signals of the dataset so that a machine can more efficiently learn the patterns in it.</p>
<p>The transform(s) used for feature engineering are highly application-specific.</p>
<p>For this tutorial, we use the common technique of converting the raw audio into a spectrogram (i.e. gray-scale image).
The machine learning model then learns the patterns in the spectrogram images that correspond to the keywords in the audio samples.</p>
</section>
<section id="featuring-engineering-on-the-edge">
<h3 id="featuring-engineering-on-the-edge">Featuring Engineering on the Edge<a class="headerlink" href="#featuring-engineering-on-the-edge" title="Permalink to this heading">¶</a></h3>
<p>An important aspect to keep in mind about the transform(s) chosen for featuring engineering
is that whatever is done to the dataset samples during training must also be
done on the embedded device at run-time. i.e. The <em>exact</em> algorithms used to generate the
spectrogram on the PC during training <em>must</em> be used on the embedded device at run-time.
Any divergence will cause the embedded model to “see” different samples and likely not perform well (if at all).</p>
<p>For this purpose, the MLTK offers an <a class="reference internal" href="../../docs/audio/audio_feature_generator.html"><span class="doc std std-doc">Audio Feature Generator</span></a> component.
This component generates spectrograms from raw audio. The algorithms used in this component are accessible via:</p>
<ul class="simple">
<li><p>MLTK <a class="reference internal" href="../../docs/python_api/data_preprocessing/audio_feature_generator.html"><span class="doc std std-doc">Python API</span></a></p></li>
<li><p>Gecko SDK <a class="reference external" href="../../docs/audio/audio_feature_generator.html#gecko-sdk-component">firmware component</a></p></li>
</ul>
<p>In this way, the <em>exact</em> spectrogram generation algorithms used during training may also be used at
run-time on the embedded device.</p>
<p>Refer to the  <a class="reference internal" href="../../docs/audio/audio_feature_generator.html"><span class="doc std std-doc">Audio Feature Generator</span></a> documentation
and <a class="reference internal" href="#audio-visualization"><span class="std std-doc">Audio Visualization</span></a> section for more details on how the various parameters used to generate the spectrogram may be determined.</p>
</section>
<section id="data-augmentation">
<h3 id="data-augmentation">Data Augmentation<a class="headerlink" href="#data-augmentation" title="Permalink to this heading">¶</a></h3>
<p>A useful technique for expanding the size of a dataset (and hopefully making it more representative) is to apply random augmentations to the training samples.
For instance, audio dataset augmentations might include:</p>
<ul class="simple">
<li><p>Increase/decrease speed</p></li>
<li><p>Increase/decrease pitch</p></li>
<li><p>Add random background noises</p></li>
<li><p>Applying an impulse response</p></li>
<li><p>Cropping “known” samples and adding to the “unknown” class</p></li>
</ul>
<p>In this way, the model never “sees” the same sample during training which should hopefully make it robust
as it has learned from a larger collection of samples.</p>
<section id="random-impulse-response">
<h4 id="random-impulse-response">Random Impulse Response<a class="headerlink" href="#random-impulse-response" title="Permalink to this heading">¶</a></h4>
<p>Another way of making an audio sample sound different is to apply an “impulse response” to it. The impulse response can make the audio sound as if it was captured in a different environment (e.g. in a church, in a field, etc.).</p>
<p>To do this, we randomly apply impulse responses from the <a class="reference external" href="https://mcdermottlab.mit.edu/Reverb/IR_Survey.html">MIT Impulse Response Survey</a></p>
</section>
<section id="random-unknown-samples-by-cropping-known-samples">
<h4 id="random-unknown-samples-by-cropping-known-samples">Random “unknown” samples by cropping “known” samples<a class="headerlink" href="#random-unknown-samples-by-cropping-known-samples" title="Permalink to this heading">¶</a></h4>
<p>On the device, audio is constantly streaming from the microphone. As such, there may be cases where the audio sample is only partially buffered when it is classified by the model. To account for this, the “known” samples are randomly cropped and applied to the “unknown” classes. This way, the model considers partially buffered “known” samples to be “unknown”.</p>
</section>
</section>
</section>
<section id="model-specification">
<h2 id="model-specification">Model Specification<a class="headerlink" href="#model-specification" title="Permalink to this heading">¶</a></h2>
<p>The model specification is a standard Python script containing everything needed to build, train, and evaluate a machine learning model in the MLTK.</p>
<p>Refer to the <a class="reference internal" href="../../docs/guides/model_specification.html"><span class="doc std std-doc">Model Specification Guide</span></a> for more details about this file.</p>
<p>The completed model specification used for this tutorial may be found on Github: <a class="reference external" href="https://github.com/siliconlabs/mltk/blob/master/mltk/models/siliconlabs/keyword_spotting_on_off_v3.py">keyword_spotting_on_off_v3.py</a>.</p>
<p>It is recommended to copy &amp; paste <a class="reference external" href="https://github.com/siliconlabs/mltk/blob/master/mltk/models/siliconlabs/keyword_spotting_on_off_v3.py">keyword_spotting_on_off_v3.py</a> into your local <a class="reference external" href="../../docs/installation.html#standard-python-package">MLTK Python environment</a></p>
<p>The following sub-sections provide <em>code snippets</em> from the <a class="reference external" href="https://github.com/siliconlabs/mltk/blob/master/mltk/models/siliconlabs/keyword_spotting_on_off_v3.py">keyword_spotting_on_off_v3.py</a> model specification script:</p>
<section id="define-model-object">
<h3 id="define-model-object">Define Model Object<a class="headerlink" href="#define-model-object" title="Permalink to this heading">¶</a></h3>
<p>Near the top of the model specification script, are the lines:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @mltk_model</span>
<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span>
    <span class="n">mltk_core</span><span class="o">.</span><span class="n">MltkModel</span><span class="p">,</span>    <span class="c1"># We must inherit the MltkModel class</span>
    <span class="n">mltk_core</span><span class="o">.</span><span class="n">TrainMixin</span><span class="p">,</span>   <span class="c1"># We also inherit the TrainMixin since we want to train this model</span>
    <span class="n">mltk_core</span><span class="o">.</span><span class="n">DatasetMixin</span><span class="p">,</span> <span class="c1"># We also need the DatasetMixin mixin to provide the relevant dataset properties</span>
    <span class="n">mltk_core</span><span class="o">.</span><span class="n">EvaluateClassifierMixin</span><span class="p">,</span>  <span class="c1"># While not required, also inherit EvaluateClassifierMixin to help will generating evaluation stats for our classification model</span>
<span class="p">):</span>
    <span class="k">pass</span>
<span class="c1"># Instantiate our custom model object</span>
<span class="c1"># The rest of this script simply configures the properties</span>
<span class="c1"># of our custom model object</span>
<span class="n">my_model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This defines and instantiates a custom MltkModel object with several model “mixins”.</p>
<p>The custom model object must inherit the <a class="reference internal" href="../../docs/python_api/mltk_model/index.html"><span class="doc std std-doc">MltkModel</span></a> object.<br/>
Additionally, it inherits:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../docs/python_api/mltk_model/train_mixin.html"><span class="doc std std-doc">TrainMixin</span></a> so that we can train the model</p></li>
<li><p><a class="reference internal" href="../../docs/python_api/mltk_model/dataset_mixin.html"><span class="doc std std-doc">DatasetMixin</span></a> so that we get additional dataset properties</p></li>
<li><p><a class="reference internal" href="../../docs/python_api/mltk_model/evaluate_classifier_mixin.html"><span class="doc std std-doc">EvaluateClassifierMixin</span></a> so that we can evaluate the trained model</p></li>
</ul>
<p>The rest of the model specification script configures the various properties of our custom model object.</p>
</section>
<section id="configure-the-general-model-settings">
<h3 id="configure-the-general-model-settings">Configure the general model settings<a class="headerlink" href="#configure-the-general-model-settings" title="Permalink to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For better tracking, the version should be incremented any time a non-trivial change is made</span>
<span class="c1"># NOTE: The version is optional and not used directly used by the MLTK</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="mi">1</span> 
<span class="c1"># Provide a brief description about what this model models</span>
<span class="c1"># This description goes in the "description" field of the .tflite model file</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">'Keyword spotting classifier to detect: "on" and "off"'</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="configure-the-basic-training-settings">
<h3 id="configure-the-basic-training-settings">Configure the basic training settings<a class="headerlink" href="#configure-the-basic-training-settings" title="Permalink to this heading">¶</a></h3>
<p>Refer to the <a class="reference internal" href="../../docs/python_api/mltk_model/train_mixin.html"><span class="doc std std-doc">TrainMixin</span></a> for more details about each property.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This specifies the number of times we run the training.</span>
<span class="c1"># We just set this to a large value since we're using SteppedLearnRateScheduler</span>
<span class="c1"># to control when training completes</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">9999</span>
<span class="c1"># Specify how many samples to pass through the model</span>
<span class="c1"># before updating the training gradients.</span>
<span class="c1"># Typical values are 10-64</span>
<span class="c1"># NOTE: Larger values require more memory and may not fit on your GPU</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="configure-the-training-callbacks">
<h3 id="configure-the-training-callbacks">Configure the training callbacks<a class="headerlink" href="#configure-the-training-callbacks" title="Permalink to this heading">¶</a></h3>
<p>Refer to the <a class="reference internal" href="../../docs/python_api/mltk_model/train_mixin.html"><span class="doc std std-doc">TrainMixin</span></a> for more details about each property.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The MLTK enables the tf.keras.callbacks.ModelCheckpoint by default.</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">'monitor'</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">'val_accuracy'</span>


<span class="c1"># We use a custom learn rate schedule that is defined in:</span>
<span class="c1"># https://github.com/google-research/google-research/tree/master/kws_streaming</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">train_callbacks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">TerminateOnNaN</span><span class="p">(),</span>
    <span class="n">SteppedLearnRateScheduler</span><span class="p">([</span>
        <span class="p">(</span><span class="mi">100</span><span class="p">,</span>   <span class="mf">.001</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">100</span><span class="p">,</span>   <span class="mf">.002</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">100</span><span class="p">,</span>   <span class="mf">.003</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">100</span><span class="p">,</span>   <span class="mf">.004</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mf">.005</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mf">.002</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mf">.0005</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">5000</span><span class="p">,</span>  <span class="mf">1e-6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">5000</span><span class="p">,</span>  <span class="mf">1e-7</span><span class="p">),</span>
    <span class="p">]</span> <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="configure-the-tf-lite-converter-settings">
<h3 id="configure-the-tf-lite-converter-settings">Configure the TF-Lite Converter settings<a class="headerlink" href="#configure-the-tf-lite-converter-settings" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference external" href="https://www.tensorflow.org/lite/convert">Tensorflow-Lite Converter</a> is used to “quantize” the model.<br/>
The quantized model is what is eventually programmed to the embedded device.</p>
<p>Refer to the <a class="reference internal" href="../../docs/guides/model_quantization.html"><span class="doc std std-doc">Model Quantization Guide</span></a> for more details.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># These are the settings used to quantize the model</span>
<span class="c1"># We want all the internal ops as well as</span>
<span class="c1"># model input/output to be int8</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">tflite_converter</span><span class="p">[</span><span class="s1">'optimizations'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">lite</span><span class="o">.</span><span class="n">Optimize</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">tflite_converter</span><span class="p">[</span><span class="s1">'supported_ops'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">lite</span><span class="o">.</span><span class="n">OpsSet</span><span class="o">.</span><span class="n">TFLITE_BUILTINS_INT8</span><span class="p">]</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">tflite_converter</span><span class="p">[</span><span class="s1">'inference_input_type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">tflite_converter</span><span class="p">[</span><span class="s1">'inference_output_type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span>
<span class="c1"># Automatically generate a representative dataset from the validation data</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">tflite_converter</span><span class="p">[</span><span class="s1">'representative_dataset'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'generate'</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-the-model-architecture">
<h3 id="define-the-model-architecture">Define the model architecture<a class="headerlink" href="#define-the-model-architecture" title="Permalink to this heading">¶</a></h3>
<p>The model is based on the <a class="reference external" href="https://arxiv.org/pdf/2010.09960.pdf">Temporal efficient neural network (TENet)</a> model architecture.</p>
<blockquote>
<div><p>A network for processing spectrogram data using temporal and depthwise convolutions. The network treats the [T, F] spectrogram as a timeseries shaped [T, 1, F].</p>
</div></blockquote>
<p>This model was chosen because it has good accuracy for audio datasets and executes efficiently on the EFR32xG24 MCU.</p>
<p>More details at <a class="reference internal" href="../../docs/python_api/models/common_models.html#tenet"><span class="std std-doc">mltk.models.shared.tenet.TENet</span></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_model_builder</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">MyModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Build the Keras model</span>
<span class="sd">    """</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">input_shape</span>
    <span class="c1"># NOTE: This model requires the input shape: &lt;time, 1, features&gt;</span>
    <span class="c1">#       while the embedded device expects: &lt;time, features, 1&gt;</span>
    <span class="c1">#       Since the &lt;time&gt; axis is still row-major, we can swap the &lt;features&gt; with 1 without issue</span>
    <span class="n">time_size</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">input_shape</span>
    <span class="n">input_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">)</span>

    <span class="n">keras_model</span> <span class="o">=</span> <span class="n">tenet</span><span class="o">.</span><span class="n">TENet12</span><span class="p">(</span>
        <span class="n">input_shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">,</span>
        <span class="n">classes</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">n_classes</span><span class="p">,</span>
        <span class="n">channels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">blocks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">keras_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="n">loss</span><span class="o">=</span><span class="s1">'categorical_crossentropy'</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">),</span>
        <span class="n">metrics</span><span class="o">=</span> <span class="p">[</span><span class="s1">'accuracy'</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">keras_model</span>

<span class="n">my_model</span><span class="o">.</span><span class="n">build_model_function</span> <span class="o">=</span> <span class="n">my_model_builder</span>
<span class="c1"># TENet uses a custom layer, be sure to add it to the keras_custom_objects</span>
<span class="c1"># so that we can load the corresponding .h5 model file</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">keras_custom_objects</span><span class="p">[</span><span class="s1">'MultiScaleTemporalConvolution'</span><span class="p">]</span> <span class="o">=</span> <span class="n">tenet</span><span class="o">.</span><span class="n">MultiScaleTemporalConvolution</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="audio-feature-generator-settings">
<h3 id="audio-feature-generator-settings">Audio Feature Generator Settings<a class="headerlink" href="#audio-feature-generator-settings" title="Permalink to this heading">¶</a></h3>
<p>This model uses the following <a class="reference internal" href="../../docs/audio/audio_feature_generator.html"><span class="doc std std-doc">Audio Feature Generator</span></a> settings:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mltk.core.preprocess.audio.audio_feature_generator</span> <span class="kn">import</span> <span class="n">AudioFeatureGeneratorSettings</span>

<span class="n">frontend_settings</span> <span class="o">=</span> <span class="n">AudioFeatureGeneratorSettings</span><span class="p">()</span>

<span class="n">frontend_settings</span><span class="o">.</span><span class="n">sample_rate_hz</span> <span class="o">=</span> <span class="mi">16000</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">sample_length_ms</span> <span class="o">=</span> <span class="mi">1000</span>                       <span class="c1"># A 1s buffer should be enough to capture the keywords</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">window_size_ms</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">window_step_ms</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">filterbank_n_channels</span> <span class="o">=</span> <span class="mi">104</span>                   <span class="c1"># We want this value to be as large as possible</span>
                                                                <span class="c1"># while still allowing for the ML model to execute efficiently on the hardware</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">filterbank_upper_band_limit</span> <span class="o">=</span> <span class="mf">7500.0</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">filterbank_lower_band_limit</span> <span class="o">=</span> <span class="mf">125.0</span>           <span class="c1"># The dev board mic seems to have a lot of noise at lower frequencies</span>

<span class="n">frontend_settings</span><span class="o">.</span><span class="n">noise_reduction_enable</span> <span class="o">=</span> <span class="kc">True</span>                 <span class="c1"># Enable the noise reduction block to help ignore background noise in the field</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">noise_reduction_smoothing_bits</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">noise_reduction_even_smoothing</span> <span class="o">=</span>  <span class="mf">0.025</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">noise_reduction_odd_smoothing</span> <span class="o">=</span> <span class="mf">0.06</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">noise_reduction_min_signal_remaining</span> <span class="o">=</span> <span class="mf">0.40</span>   <span class="c1"># This value is fairly large (which makes the background noise reduction small)</span>
                                                                <span class="c1"># But it has been found to still give good results</span>
                                                                <span class="c1"># i.e. There is still some background noise reduction,</span>
                                                                <span class="c1"># but the actual signal is still (mostly) untouched</span>

<span class="n">frontend_settings</span><span class="o">.</span><span class="n">dc_notch_filter_enable</span> <span class="o">=</span> <span class="kc">True</span>                 <span class="c1"># Enable the DC notch filter, to help remove the DC signal from the dev board's mic</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">dc_notch_filter_coefficient</span> <span class="o">=</span> <span class="mf">0.95</span>

<span class="n">frontend_settings</span><span class="o">.</span><span class="n">quantize_dynamic_scale_enable</span> <span class="o">=</span> <span class="kc">True</span>          <span class="c1"># Enable dynamic quantization, this dynamically converts the uint16 spectrogram to int8</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">quantize_dynamic_scale_range_db</span> <span class="o">=</span> <span class="mf">40.0</span>

<span class="c1"># Add the Audio Feature generator settings to the model parameters</span>
<span class="c1"># This way, they are included in the generated .tflite model file</span>
<span class="c1"># See https://siliconlabs.github.io/mltk/docs/guides/model_parameters.html</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">frontend_settings</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This uses a 16kHz sample rate which was found to give better performance at the expense of more RAM.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frontend_settings</span><span class="o">.</span><span class="n">sample_rate_hz</span> <span class="o">=</span> <span class="mi">16000</span>
</pre></div>
</div>
<p>To help reduce the model computational complexity, only a 1000ms sample length is used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frontend_settings</span><span class="o">.</span><span class="n">sample_length_ms</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
<p>The idea here is that it only takes at most ~1000ms to say any of the keywords (i.e. the audio buffer needs to be large enough to hold the entire keyword but no larger).</p>
<p>This model uses a window size of 30ms and a step of 10ms.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frontend_settings</span><span class="o">.</span><span class="n">window_size_ms</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">window_step_ms</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p>These values were found experimentally using the <a class="reference external" href="../../docs/audio/audio_feature_generator.html#audio-visualizer-utility">Audio Visualizer Utility</a>.</p>
<p>104 frequency bins are used to generate the spectrogram:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frontend_settings</span><span class="o">.</span><span class="n">filterbank_n_channels</span> <span class="o">=</span> <span class="mi">104</span>
</pre></div>
</div>
<p>Increasing this value improves the resolution of spectrogram at the cost of model computational complexity (i.e. inference latency).</p>
<p>The noise reduction block is enabled but uses a fairly large <code class="docutils literal notranslate"><span class="pre">min_signal_remaining</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frontend_settings</span><span class="o">.</span><span class="n">noise_reduction_enable</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">noise_reduction_smoothing_bits</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">noise_reduction_even_smoothing</span> <span class="o">=</span>  <span class="mf">0.025</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">noise_reduction_odd_smoothing</span> <span class="o">=</span> <span class="mf">0.06</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">noise_reduction_min_signal_remaining</span> <span class="o">=</span> <span class="mf">0.40</span>
</pre></div>
</div>
<p>This helps to reduce background noise in the field.<br/>
<strong>NOTE:</strong> We also add padding to the audio samples during training to “warm up” the noise reduction block when generating the spectrogram using the
<a class="reference internal" href="../../docs/audio/audio_feature_generator.html"><span class="doc std std-doc">Audio Feature Generator</span></a>. See the <code class="docutils literal notranslate"><span class="pre">audio_pipeline_with_augmentations()</span></code>
function in <a class="reference external" href="../../docs/python_api/models/siliconlabs/keyword_spotting_on_off_v3.html#model-specification">keyword_spotting_on_off_v3.py</a> for more details.</p>
<p>The DC notch filter was enabled to help remove the DC component from the development board’s microphone:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frontend_settings</span><span class="o">.</span><span class="n">dc_notch_filter_enable</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Enable the DC notch filter</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">dc_notch_filter_coefficient</span> <span class="o">=</span> <span class="mf">0.95</span>
</pre></div>
</div>
<p>Dynamic quantization was enabled to convert the generated spectrogram from uint16 to int8</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frontend_settings</span><span class="o">.</span><span class="n">quantize_dynamic_scale_enable</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Enable dynamic quantization</span>
<span class="n">frontend_settings</span><span class="o">.</span><span class="n">quantize_dynamic_scale_range_db</span> <span class="o">=</span> <span class="mf">40.0</span>
</pre></div>
</div>
</section>
<section id="configure-the-keywords-to-detect">
<h3 id="configure-the-keywords-to-detect">Configure the keywords to detect<a class="headerlink" href="#configure-the-keywords-to-detect" title="Permalink to this heading">¶</a></h3>
<p>This is likely the most interesting part of the model specification script. Here, we define which keywords we want our model to detect.<br/>
For this tutorial, we want to detect <code class="docutils literal notranslate"><span class="pre">on</span></code> and <code class="docutils literal notranslate"><span class="pre">off</span></code>, however,
you may modify this as necessary for your application. Be sure to generate a new <a class="reference internal" href="synthetic_audio_dataset_generation.html"><span class="doc std std-doc">Synthetic Dataset</span></a> with the desired keywords.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the keywords plus a _unknown_ meta class</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'on'</span><span class="p">,</span> <span class="s1">'off'</span><span class="p">,</span> <span class="s1">'_unknown_'</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-pipeline">
<h3 id="data-pipeline">Data Pipeline<a class="headerlink" href="#data-pipeline" title="Permalink to this heading">¶</a></h3>
<p>Refer to the <code class="docutils literal notranslate"><span class="pre">audio_pipeline_with_augmentations()</span></code>
function in <a class="reference external" href="../../docs/python_api/models/siliconlabs/keyword_spotting_on_off_v3.html#model-specification">keyword_spotting_on_off_v3.py</a> for the full data pipeline used by this model.</p>
<p>This pipeline is illustrated as follows:<br/>
<img alt="" src="../../_images/keyword_spotting_on_off_v3_data_pipeline.png"/></p>
</section>
</section>
<section id="audio-visualization">
<h2 id="audio-visualization">Audio Visualization<a class="headerlink" href="#audio-visualization" title="Permalink to this heading">¶</a></h2>
<p><strong>NOTE:</strong> This section is <strong>experimental</strong> and is optional for the rest of this tutorial.
You may safely skip to the next section.</p>
<p>Before training the model, it is important that the generated spectrogram has enough detail from which the ML model can learn (i.e. “feature engineering”).
The <a class="reference internal" href="../../docs/python_api/data_preprocessing/audio_feature_generator.html"><span class="doc std std-doc">AudioFeatureGenerator</span></a> has numerous <a class="reference internal" href="../../docs/python_api/data_preprocessing/audio_feature_generator_settings.html"><span class="doc std std-doc">settings</span></a> to control how the spectrogram is generated.</p>
<p>For this purpose, the MLTK features an experimental command: <code class="docutils literal notranslate"><span class="pre">view_audio</span></code> which allows for visualizing a generated spectrogram in real-time as the various parameters are adjusted via GUI.
It also allows for adjusting the various augmentation parameters and listening to the audio playback.</p>
<p>See the <a class="reference internal" href="../../docs/audio/audio_feature_generator.html"><span class="doc std std-doc">Audio Feature Generator</span></a> guide for more details.</p>
<p><strong>NOTE:</strong> Internally, this command uses <a class="reference external" href="https://www.wxpython.org">wxPython</a> and <em>must</em> run locally. It will not work on a remote server (e.g. Colab).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Invoke the view_audio command from a LOCAL terminal</span>
<span class="c1"># NOTE: Change this command to use</span>
<span class="c1">#      "my_keyword_spotting_on_off" or whatever you called your model</span>
<span class="o">!</span>mltk<span class="w"> </span>view_audio<span class="w"> </span>keyword_spotting_on_off_v3
</pre></div>
</div>
</div>
</div>
<p>After running this command and playing with the GUI, you should have a better idea of what settings to use for the AudioFeatureGenerator and data augmentation parameters.</p>
<p><strong>NOTE:</strong> Care should be given when selecting the spectrogram size. e.g. The dimensions given in the upper-left:</p>
<p><img alt="Visualizer Dimensions" src="../../_images/visualizer_dimensions.png"/></p>
<p>A larger spectrogram means a larger model input which ultimately means more processing that is required by the embedded device at run-time.</p>
<p>See the <a class="reference internal" href="model_optimization.html"><span class="doc std std-doc">Model Optimization Tutorial</span></a> for more details.</p>
</section>
<section id="model-parameters">
<h2 id="model-parameters">Model Parameters<a class="headerlink" href="#model-parameters" title="Permalink to this heading">¶</a></h2>
<p>As stated in the <a class="reference internal" href="#featuring-engineering-on-the-edge"><span class="std std-doc">Feature Engineering on the Edge</span></a> section, it is extremely important that whatever transforms are done to the dataset during training are also done at run-time on the embedded device.</p>
<p>To help with this, the MLTK allows for embedding parameters into the generated <code class="docutils literal notranslate"><span class="pre">.tflite</span></code> model file.</p>
<p>Refer to the <a class="reference internal" href="../../docs/guides/model_parameters.html"><span class="doc std std-doc">Model Parameters Guide</span></a> for more details about how this works.</p>
<p>This is useful for this tutorial as the MLTK will automatically embed all of the <a class="reference external" href="../../docs/python_api/data_preprocessing/audio_feature_generator.html#audiofeaturegenerator-settings">AudioFeatureGeneratorSettings</a> into the generated <code class="docutils literal notranslate"><span class="pre">.tflite</span></code> model file.
Later, the Gecko SDK will read the settings from the <code class="docutils literal notranslate"><span class="pre">.tflite</span></code> model file when generating the project.
In this way, the <a class="reference internal" href="../../docs/audio/audio_feature_generator.html"><span class="doc std std-doc">AudioFeatureGenerator</span></a> that runs on the embedded device will use the <em>exact</em> same settings.</p>
<p><strong>NOTE:</strong> The <code class="docutils literal notranslate"><span class="pre">mltk</span> <span class="pre">summarize</span> <span class="pre">--tflite</span></code> command prints all the parameters that are embedded into the <code class="docutils literal notranslate"><span class="pre">.tflite</span></code> model file, including the AudioFeatureGenerator settings.</p>
</section>
<section id="model-summary">
<h2 id="model-summary">Model Summary<a class="headerlink" href="#model-summary" title="Permalink to this heading">¶</a></h2>
<p>With the model specification complete, it is sometimes useful to generate a summary of the model before we spend the time to train it.<br/>
This can be done using the <code class="docutils literal notranslate"><span class="pre">summarize</span></code> command.</p>
<p>If you’re using a local terminal, navigate to the same directory are your model specification script, e.g. <code class="docutils literal notranslate"><span class="pre">my_keyword_spotting_on_off_v3.py</span></code> and modify the commands to use <code class="docutils literal notranslate"><span class="pre">my_keyword_spotting_on_off_v3</span></code> or whatever you called your model.</p>
<p><strong>NOTE:</strong> Since we have not trained our model yet, we must add the <code class="docutils literal notranslate"><span class="pre">--build</span></code> option to the command.<br/>
Once the model is trained, this option is not required.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Summarize the Keras Model</span>
<span class="c1"># This is the non-quantized model used for training</span>
<span class="c1"># NOTE: Running this the first time may take awhile since the audio dataset needs to be downloaded</span>
<span class="o">!</span>mltk<span class="w"> </span>summarize<span class="w"> </span>keyword_spotting_on_off_v3<span class="w"> </span>--build
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: "TENet"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 input_1 (InputLayer)           [(None, 98, 1, 104)  0           []                               
                                ]                                                                 
                                                                                                  
 conv2d (Conv2D)                (None, 98, 1, 50)    15650       ['input_1[0][0]']                
                                                                                                  
 pointwise_expand_conv-0 (Conv2  (None, 98, 1, 150)  7500        ['conv2d[0][0]']                 
 D)                                                                                               
                                                                                                  
 batch_normalization (BatchNorm  (None, 98, 1, 150)  600         ['pointwise_expand_conv-0[0][0]']
 alization)                                                                                       
                                                                                                  
 re_lu (ReLU)                   (None, 98, 1, 150)   0           ['batch_normalization[0][0]']    
                                                                                                  
 mtconv-0 (MultiScaleTemporalCo  (None, 49, 1, 150)  1350        ['re_lu[0][0]']                  
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_1 (BatchNo  (None, 49, 1, 150)  600         ['mtconv-0[0][0]']               
 rmalization)                                                                                     
                                                                                                  
 re_lu_1 (ReLU)                 (None, 49, 1, 150)   0           ['batch_normalization_1[0][0]']  
                                                                                                  
 strided_residual-0 (Conv2D)    (None, 49, 1, 50)    2500        ['conv2d[0][0]']                 
                                                                                                  
 pointwise_contract_conv-0 (Con  (None, 49, 1, 50)   7500        ['re_lu_1[0][0]']                
 v2D)                                                                                             
                                                                                                  
 batch_normalization_3 (BatchNo  (None, 49, 1, 50)   200         ['strided_residual-0[0][0]']     
 rmalization)                                                                                     
                                                                                                  
 batch_normalization_2 (BatchNo  (None, 49, 1, 50)   200         ['pointwise_contract_conv-0[0][0]
 rmalization)                                                    ']                               
                                                                                                  
 re_lu_2 (ReLU)                 (None, 49, 1, 50)    0           ['batch_normalization_3[0][0]']  
                                                                                                  
 add (Add)                      (None, 49, 1, 50)    0           ['batch_normalization_2[0][0]',  
                                                                  're_lu_2[0][0]']                
                                                                                                  
 re_lu_3 (ReLU)                 (None, 49, 1, 50)    0           ['add[0][0]']                    
                                                                                                  
 pointwise_expand_conv-1 (Conv2  (None, 49, 1, 150)  7500        ['re_lu_3[0][0]']                
 D)                                                                                               
                                                                                                  
 batch_normalization_4 (BatchNo  (None, 49, 1, 150)  600         ['pointwise_expand_conv-1[0][0]']
 rmalization)                                                                                     
                                                                                                  
 re_lu_4 (ReLU)                 (None, 49, 1, 150)   0           ['batch_normalization_4[0][0]']  
                                                                                                  
 mtconv-1 (MultiScaleTemporalCo  (None, 49, 1, 150)  1350        ['re_lu_4[0][0]']                
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_5 (BatchNo  (None, 49, 1, 150)  600         ['mtconv-1[0][0]']               
 rmalization)                                                                                     
                                                                                                  
 re_lu_5 (ReLU)                 (None, 49, 1, 150)   0           ['batch_normalization_5[0][0]']  
                                                                                                  
 pointwise_contract_conv-1 (Con  (None, 49, 1, 50)   7500        ['re_lu_5[0][0]']                
 v2D)                                                                                             
                                                                                                  
 batch_normalization_6 (BatchNo  (None, 49, 1, 50)   200         ['pointwise_contract_conv-1[0][0]
 rmalization)                                                    ']                               
                                                                                                  
 add_1 (Add)                    (None, 49, 1, 50)    0           ['batch_normalization_6[0][0]',  
                                                                  're_lu_3[0][0]']                
                                                                                                  
 re_lu_6 (ReLU)                 (None, 49, 1, 50)    0           ['add_1[0][0]']                  
                                                                                                  
 pointwise_expand_conv-2 (Conv2  (None, 49, 1, 150)  7500        ['re_lu_6[0][0]']                
 D)                                                                                               
                                                                                                  
 batch_normalization_7 (BatchNo  (None, 49, 1, 150)  600         ['pointwise_expand_conv-2[0][0]']
 rmalization)                                                                                     
                                                                                                  
 re_lu_7 (ReLU)                 (None, 49, 1, 150)   0           ['batch_normalization_7[0][0]']  
                                                                                                  
 mtconv-2 (MultiScaleTemporalCo  (None, 49, 1, 150)  1350        ['re_lu_7[0][0]']                
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_8 (BatchNo  (None, 49, 1, 150)  600         ['mtconv-2[0][0]']               
 rmalization)                                                                                     
                                                                                                  
 re_lu_8 (ReLU)                 (None, 49, 1, 150)   0           ['batch_normalization_8[0][0]']  
                                                                                                  
 pointwise_contract_conv-2 (Con  (None, 49, 1, 50)   7500        ['re_lu_8[0][0]']                
 v2D)                                                                                             
                                                                                                  
 batch_normalization_9 (BatchNo  (None, 49, 1, 50)   200         ['pointwise_contract_conv-2[0][0]
 rmalization)                                                    ']                               
                                                                                                  
 add_2 (Add)                    (None, 49, 1, 50)    0           ['batch_normalization_9[0][0]',  
                                                                  're_lu_6[0][0]']                
                                                                                                  
 re_lu_9 (ReLU)                 (None, 49, 1, 50)    0           ['add_2[0][0]']                  
                                                                                                  
 pointwise_expand_conv-3 (Conv2  (None, 49, 1, 150)  7500        ['re_lu_9[0][0]']                
 D)                                                                                               
                                                                                                  
 batch_normalization_10 (BatchN  (None, 49, 1, 150)  600         ['pointwise_expand_conv-3[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_10 (ReLU)                (None, 49, 1, 150)   0           ['batch_normalization_10[0][0]'] 
                                                                                                  
 mtconv-3 (MultiScaleTemporalCo  (None, 49, 1, 150)  1350        ['re_lu_10[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_11 (BatchN  (None, 49, 1, 150)  600         ['mtconv-3[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_11 (ReLU)                (None, 49, 1, 150)   0           ['batch_normalization_11[0][0]'] 
                                                                                                  
 pointwise_contract_conv-3 (Con  (None, 49, 1, 50)   7500        ['re_lu_11[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_12 (BatchN  (None, 49, 1, 50)   200         ['pointwise_contract_conv-3[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 add_3 (Add)                    (None, 49, 1, 50)    0           ['batch_normalization_12[0][0]', 
                                                                  're_lu_9[0][0]']                
                                                                                                  
 re_lu_12 (ReLU)                (None, 49, 1, 50)    0           ['add_3[0][0]']                  
                                                                                                  
 pointwise_expand_conv-4 (Conv2  (None, 49, 1, 150)  7500        ['re_lu_12[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_13 (BatchN  (None, 49, 1, 150)  600         ['pointwise_expand_conv-4[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_13 (ReLU)                (None, 49, 1, 150)   0           ['batch_normalization_13[0][0]'] 
                                                                                                  
 mtconv-4 (MultiScaleTemporalCo  (None, 25, 1, 150)  1350        ['re_lu_13[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_14 (BatchN  (None, 25, 1, 150)  600         ['mtconv-4[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_14 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_14[0][0]'] 
                                                                                                  
 strided_residual-4 (Conv2D)    (None, 25, 1, 50)    2500        ['re_lu_12[0][0]']               
                                                                                                  
 pointwise_contract_conv-4 (Con  (None, 25, 1, 50)   7500        ['re_lu_14[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_16 (BatchN  (None, 25, 1, 50)   200         ['strided_residual-4[0][0]']     
 ormalization)                                                                                    
                                                                                                  
 batch_normalization_15 (BatchN  (None, 25, 1, 50)   200         ['pointwise_contract_conv-4[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 re_lu_15 (ReLU)                (None, 25, 1, 50)    0           ['batch_normalization_16[0][0]'] 
                                                                                                  
 add_4 (Add)                    (None, 25, 1, 50)    0           ['batch_normalization_15[0][0]', 
                                                                  're_lu_15[0][0]']               
                                                                                                  
 re_lu_16 (ReLU)                (None, 25, 1, 50)    0           ['add_4[0][0]']                  
                                                                                                  
 pointwise_expand_conv-5 (Conv2  (None, 25, 1, 150)  7500        ['re_lu_16[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_17 (BatchN  (None, 25, 1, 150)  600         ['pointwise_expand_conv-5[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_17 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_17[0][0]'] 
                                                                                                  
 mtconv-5 (MultiScaleTemporalCo  (None, 25, 1, 150)  1350        ['re_lu_17[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_18 (BatchN  (None, 25, 1, 150)  600         ['mtconv-5[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_18 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_18[0][0]'] 
                                                                                                  
 pointwise_contract_conv-5 (Con  (None, 25, 1, 50)   7500        ['re_lu_18[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_19 (BatchN  (None, 25, 1, 50)   200         ['pointwise_contract_conv-5[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 add_5 (Add)                    (None, 25, 1, 50)    0           ['batch_normalization_19[0][0]', 
                                                                  're_lu_16[0][0]']               
                                                                                                  
 re_lu_19 (ReLU)                (None, 25, 1, 50)    0           ['add_5[0][0]']                  
                                                                                                  
 pointwise_expand_conv-6 (Conv2  (None, 25, 1, 150)  7500        ['re_lu_19[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_20 (BatchN  (None, 25, 1, 150)  600         ['pointwise_expand_conv-6[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_20 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_20[0][0]'] 
                                                                                                  
 mtconv-6 (MultiScaleTemporalCo  (None, 25, 1, 150)  1350        ['re_lu_20[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_21 (BatchN  (None, 25, 1, 150)  600         ['mtconv-6[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_21 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_21[0][0]'] 
                                                                                                  
 pointwise_contract_conv-6 (Con  (None, 25, 1, 50)   7500        ['re_lu_21[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_22 (BatchN  (None, 25, 1, 50)   200         ['pointwise_contract_conv-6[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 add_6 (Add)                    (None, 25, 1, 50)    0           ['batch_normalization_22[0][0]', 
                                                                  're_lu_19[0][0]']               
                                                                                                  
 re_lu_22 (ReLU)                (None, 25, 1, 50)    0           ['add_6[0][0]']                  
                                                                                                  
 pointwise_expand_conv-7 (Conv2  (None, 25, 1, 150)  7500        ['re_lu_22[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_23 (BatchN  (None, 25, 1, 150)  600         ['pointwise_expand_conv-7[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_23 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_23[0][0]'] 
                                                                                                  
 mtconv-7 (MultiScaleTemporalCo  (None, 25, 1, 150)  1350        ['re_lu_23[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_24 (BatchN  (None, 25, 1, 150)  600         ['mtconv-7[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_24 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_24[0][0]'] 
                                                                                                  
 pointwise_contract_conv-7 (Con  (None, 25, 1, 50)   7500        ['re_lu_24[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_25 (BatchN  (None, 25, 1, 50)   200         ['pointwise_contract_conv-7[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 add_7 (Add)                    (None, 25, 1, 50)    0           ['batch_normalization_25[0][0]', 
                                                                  're_lu_22[0][0]']               
                                                                                                  
 re_lu_25 (ReLU)                (None, 25, 1, 50)    0           ['add_7[0][0]']                  
                                                                                                  
 pointwise_expand_conv-8 (Conv2  (None, 25, 1, 150)  7500        ['re_lu_25[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_26 (BatchN  (None, 25, 1, 150)  600         ['pointwise_expand_conv-8[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_26 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_26[0][0]'] 
                                                                                                  
 mtconv-8 (MultiScaleTemporalCo  (None, 13, 1, 150)  1350        ['re_lu_26[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_27 (BatchN  (None, 13, 1, 150)  600         ['mtconv-8[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_27 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_27[0][0]'] 
                                                                                                  
 strided_residual-8 (Conv2D)    (None, 13, 1, 50)    2500        ['re_lu_25[0][0]']               
                                                                                                  
 pointwise_contract_conv-8 (Con  (None, 13, 1, 50)   7500        ['re_lu_27[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_29 (BatchN  (None, 13, 1, 50)   200         ['strided_residual-8[0][0]']     
 ormalization)                                                                                    
                                                                                                  
 batch_normalization_28 (BatchN  (None, 13, 1, 50)   200         ['pointwise_contract_conv-8[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 re_lu_28 (ReLU)                (None, 13, 1, 50)    0           ['batch_normalization_29[0][0]'] 
                                                                                                  
 add_8 (Add)                    (None, 13, 1, 50)    0           ['batch_normalization_28[0][0]', 
                                                                  're_lu_28[0][0]']               
                                                                                                  
 re_lu_29 (ReLU)                (None, 13, 1, 50)    0           ['add_8[0][0]']                  
                                                                                                  
 pointwise_expand_conv-9 (Conv2  (None, 13, 1, 150)  7500        ['re_lu_29[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_30 (BatchN  (None, 13, 1, 150)  600         ['pointwise_expand_conv-9[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_30 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_30[0][0]'] 
                                                                                                  
 mtconv-9 (MultiScaleTemporalCo  (None, 13, 1, 150)  1350        ['re_lu_30[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_31 (BatchN  (None, 13, 1, 150)  600         ['mtconv-9[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_31 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_31[0][0]'] 
                                                                                                  
 pointwise_contract_conv-9 (Con  (None, 13, 1, 50)   7500        ['re_lu_31[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_32 (BatchN  (None, 13, 1, 50)   200         ['pointwise_contract_conv-9[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 add_9 (Add)                    (None, 13, 1, 50)    0           ['batch_normalization_32[0][0]', 
                                                                  're_lu_29[0][0]']               
                                                                                                  
 re_lu_32 (ReLU)                (None, 13, 1, 50)    0           ['add_9[0][0]']                  
                                                                                                  
 pointwise_expand_conv-10 (Conv  (None, 13, 1, 150)  7500        ['re_lu_32[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_33 (BatchN  (None, 13, 1, 150)  600         ['pointwise_expand_conv-10[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_33 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_33[0][0]'] 
                                                                                                  
 mtconv-10 (MultiScaleTemporalC  (None, 13, 1, 150)  1350        ['re_lu_33[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_34 (BatchN  (None, 13, 1, 150)  600         ['mtconv-10[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_34 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_34[0][0]'] 
                                                                                                  
 pointwise_contract_conv-10 (Co  (None, 13, 1, 50)   7500        ['re_lu_34[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_35 (BatchN  (None, 13, 1, 50)   200         ['pointwise_contract_conv-10[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_10 (Add)                   (None, 13, 1, 50)    0           ['batch_normalization_35[0][0]', 
                                                                  're_lu_32[0][0]']               
                                                                                                  
 re_lu_35 (ReLU)                (None, 13, 1, 50)    0           ['add_10[0][0]']                 
                                                                                                  
 pointwise_expand_conv-11 (Conv  (None, 13, 1, 150)  7500        ['re_lu_35[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_36 (BatchN  (None, 13, 1, 150)  600         ['pointwise_expand_conv-11[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_36 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_36[0][0]'] 
                                                                                                  
 mtconv-11 (MultiScaleTemporalC  (None, 13, 1, 150)  1350        ['re_lu_36[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_37 (BatchN  (None, 13, 1, 150)  600         ['mtconv-11[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_37 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_37[0][0]'] 
                                                                                                  
 pointwise_contract_conv-11 (Co  (None, 13, 1, 50)   7500        ['re_lu_37[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_38 (BatchN  (None, 13, 1, 50)   200         ['pointwise_contract_conv-11[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_11 (Add)                   (None, 13, 1, 50)    0           ['batch_normalization_38[0][0]', 
                                                                  're_lu_35[0][0]']               
                                                                                                  
 re_lu_38 (ReLU)                (None, 13, 1, 50)    0           ['add_11[0][0]']                 
                                                                                                  
 pointwise_expand_conv-12 (Conv  (None, 13, 1, 150)  7500        ['re_lu_38[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_39 (BatchN  (None, 13, 1, 150)  600         ['pointwise_expand_conv-12[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_39 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_39[0][0]'] 
                                                                                                  
 mtconv-12 (MultiScaleTemporalC  (None, 7, 1, 150)   1350        ['re_lu_39[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_40 (BatchN  (None, 7, 1, 150)   600         ['mtconv-12[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_40 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_40[0][0]'] 
                                                                                                  
 strided_residual-12 (Conv2D)   (None, 7, 1, 50)     2500        ['re_lu_38[0][0]']               
                                                                                                  
 pointwise_contract_conv-12 (Co  (None, 7, 1, 50)    7500        ['re_lu_40[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_42 (BatchN  (None, 7, 1, 50)    200         ['strided_residual-12[0][0]']    
 ormalization)                                                                                    
                                                                                                  
 batch_normalization_41 (BatchN  (None, 7, 1, 50)    200         ['pointwise_contract_conv-12[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 re_lu_41 (ReLU)                (None, 7, 1, 50)     0           ['batch_normalization_42[0][0]'] 
                                                                                                  
 add_12 (Add)                   (None, 7, 1, 50)     0           ['batch_normalization_41[0][0]', 
                                                                  're_lu_41[0][0]']               
                                                                                                  
 re_lu_42 (ReLU)                (None, 7, 1, 50)     0           ['add_12[0][0]']                 
                                                                                                  
 pointwise_expand_conv-13 (Conv  (None, 7, 1, 150)   7500        ['re_lu_42[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_43 (BatchN  (None, 7, 1, 150)   600         ['pointwise_expand_conv-13[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_43 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_43[0][0]'] 
                                                                                                  
 mtconv-13 (MultiScaleTemporalC  (None, 7, 1, 150)   1350        ['re_lu_43[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_44 (BatchN  (None, 7, 1, 150)   600         ['mtconv-13[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_44 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_44[0][0]'] 
                                                                                                  
 pointwise_contract_conv-13 (Co  (None, 7, 1, 50)    7500        ['re_lu_44[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_45 (BatchN  (None, 7, 1, 50)    200         ['pointwise_contract_conv-13[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_13 (Add)                   (None, 7, 1, 50)     0           ['batch_normalization_45[0][0]', 
                                                                  're_lu_42[0][0]']               
                                                                                                  
 re_lu_45 (ReLU)                (None, 7, 1, 50)     0           ['add_13[0][0]']                 
                                                                                                  
 pointwise_expand_conv-14 (Conv  (None, 7, 1, 150)   7500        ['re_lu_45[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_46 (BatchN  (None, 7, 1, 150)   600         ['pointwise_expand_conv-14[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_46 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_46[0][0]'] 
                                                                                                  
 mtconv-14 (MultiScaleTemporalC  (None, 7, 1, 150)   1350        ['re_lu_46[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_47 (BatchN  (None, 7, 1, 150)   600         ['mtconv-14[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_47 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_47[0][0]'] 
                                                                                                  
 pointwise_contract_conv-14 (Co  (None, 7, 1, 50)    7500        ['re_lu_47[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_48 (BatchN  (None, 7, 1, 50)    200         ['pointwise_contract_conv-14[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_14 (Add)                   (None, 7, 1, 50)     0           ['batch_normalization_48[0][0]', 
                                                                  're_lu_45[0][0]']               
                                                                                                  
 re_lu_48 (ReLU)                (None, 7, 1, 50)     0           ['add_14[0][0]']                 
                                                                                                  
 pointwise_expand_conv-15 (Conv  (None, 7, 1, 150)   7500        ['re_lu_48[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_49 (BatchN  (None, 7, 1, 150)   600         ['pointwise_expand_conv-15[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_49 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_49[0][0]'] 
                                                                                                  
 mtconv-15 (MultiScaleTemporalC  (None, 7, 1, 150)   1350        ['re_lu_49[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_50 (BatchN  (None, 7, 1, 150)   600         ['mtconv-15[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_50 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_50[0][0]'] 
                                                                                                  
 pointwise_contract_conv-15 (Co  (None, 7, 1, 50)    7500        ['re_lu_50[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_51 (BatchN  (None, 7, 1, 50)    200         ['pointwise_contract_conv-15[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_15 (Add)                   (None, 7, 1, 50)     0           ['batch_normalization_51[0][0]', 
                                                                  're_lu_48[0][0]']               
                                                                                                  
 re_lu_51 (ReLU)                (None, 7, 1, 50)     0           ['add_15[0][0]']                 
                                                                                                  
 pointwise_expand_conv-16 (Conv  (None, 7, 1, 150)   7500        ['re_lu_51[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_52 (BatchN  (None, 7, 1, 150)   600         ['pointwise_expand_conv-16[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_52 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_52[0][0]'] 
                                                                                                  
 mtconv-16 (MultiScaleTemporalC  (None, 4, 1, 150)   1350        ['re_lu_52[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_53 (BatchN  (None, 4, 1, 150)   600         ['mtconv-16[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_53 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_53[0][0]'] 
                                                                                                  
 strided_residual-16 (Conv2D)   (None, 4, 1, 50)     2500        ['re_lu_51[0][0]']               
                                                                                                  
 pointwise_contract_conv-16 (Co  (None, 4, 1, 50)    7500        ['re_lu_53[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_55 (BatchN  (None, 4, 1, 50)    200         ['strided_residual-16[0][0]']    
 ormalization)                                                                                    
                                                                                                  
 batch_normalization_54 (BatchN  (None, 4, 1, 50)    200         ['pointwise_contract_conv-16[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 re_lu_54 (ReLU)                (None, 4, 1, 50)     0           ['batch_normalization_55[0][0]'] 
                                                                                                  
 add_16 (Add)                   (None, 4, 1, 50)     0           ['batch_normalization_54[0][0]', 
                                                                  're_lu_54[0][0]']               
                                                                                                  
 re_lu_55 (ReLU)                (None, 4, 1, 50)     0           ['add_16[0][0]']                 
                                                                                                  
 pointwise_expand_conv-17 (Conv  (None, 4, 1, 150)   7500        ['re_lu_55[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_56 (BatchN  (None, 4, 1, 150)   600         ['pointwise_expand_conv-17[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_56 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_56[0][0]'] 
                                                                                                  
 mtconv-17 (MultiScaleTemporalC  (None, 4, 1, 150)   1350        ['re_lu_56[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_57 (BatchN  (None, 4, 1, 150)   600         ['mtconv-17[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_57 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_57[0][0]'] 
                                                                                                  
 pointwise_contract_conv-17 (Co  (None, 4, 1, 50)    7500        ['re_lu_57[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_58 (BatchN  (None, 4, 1, 50)    200         ['pointwise_contract_conv-17[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_17 (Add)                   (None, 4, 1, 50)     0           ['batch_normalization_58[0][0]', 
                                                                  're_lu_55[0][0]']               
                                                                                                  
 re_lu_58 (ReLU)                (None, 4, 1, 50)     0           ['add_17[0][0]']                 
                                                                                                  
 pointwise_expand_conv-18 (Conv  (None, 4, 1, 150)   7500        ['re_lu_58[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_59 (BatchN  (None, 4, 1, 150)   600         ['pointwise_expand_conv-18[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_59 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_59[0][0]'] 
                                                                                                  
 mtconv-18 (MultiScaleTemporalC  (None, 4, 1, 150)   1350        ['re_lu_59[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_60 (BatchN  (None, 4, 1, 150)   600         ['mtconv-18[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_60 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_60[0][0]'] 
                                                                                                  
 pointwise_contract_conv-18 (Co  (None, 4, 1, 50)    7500        ['re_lu_60[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_61 (BatchN  (None, 4, 1, 50)    200         ['pointwise_contract_conv-18[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_18 (Add)                   (None, 4, 1, 50)     0           ['batch_normalization_61[0][0]', 
                                                                  're_lu_58[0][0]']               
                                                                                                  
 re_lu_61 (ReLU)                (None, 4, 1, 50)     0           ['add_18[0][0]']                 
                                                                                                  
 pointwise_expand_conv-19 (Conv  (None, 4, 1, 150)   7500        ['re_lu_61[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_62 (BatchN  (None, 4, 1, 150)   600         ['pointwise_expand_conv-19[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_62 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_62[0][0]'] 
                                                                                                  
 mtconv-19 (MultiScaleTemporalC  (None, 4, 1, 150)   1350        ['re_lu_62[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_63 (BatchN  (None, 4, 1, 150)   600         ['mtconv-19[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_63 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_63[0][0]'] 
                                                                                                  
 pointwise_contract_conv-19 (Co  (None, 4, 1, 50)    7500        ['re_lu_63[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_64 (BatchN  (None, 4, 1, 50)    200         ['pointwise_contract_conv-19[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_19 (Add)                   (None, 4, 1, 50)     0           ['batch_normalization_64[0][0]', 
                                                                  're_lu_61[0][0]']               
                                                                                                  
 re_lu_64 (ReLU)                (None, 4, 1, 50)     0           ['add_19[0][0]']                 
                                                                                                  
 average_pooling2d (AveragePool  (None, 1, 1, 50)    0           ['re_lu_64[0][0]']               
 ing2D)                                                                                           
                                                                                                  
 flatten (Flatten)              (None, 50)           0           ['average_pooling2d[0][0]']      
                                                                                                  
 dropout (Dropout)              (None, 50)           0           ['flatten[0][0]']                
                                                                                                  
 dense (Dense)                  (None, 3)            153         ['dropout[0][0]']                
                                                                                                  
==================================================================================================
Total params: 384,303
Trainable params: 369,803
Non-trainable params: 14,500
__________________________________________________________________________________________________

Total MACs: 8.359 M
Total OPs: 17.055 M
Name: keyword_spotting_on_off_v3
Version: 1
Description: Keyword spotting classifier to detect: on, off
Classes: on, off, _unknown_
fe.sample_rate_hz: 16000
fe.fft_length: 512
fe.sample_length_ms: 1000
fe.window_size_ms: 30
fe.window_step_ms: 10
fe.filterbank_n_channels: 104
fe.filterbank_upper_band_limit: 7500.0
fe.filterbank_lower_band_limit: 125.0
fe.noise_reduction_enable: True
fe.noise_reduction_smoothing_bits: 10
fe.noise_reduction_even_smoothing: 0.025
fe.noise_reduction_odd_smoothing: 0.06
fe.noise_reduction_min_signal_remaining: 0.4
fe.pcan_enable: False
fe.pcan_strength: 0.95
fe.pcan_offset: 80.0
fe.pcan_gain_bits: 21
fe.log_scale_enable: True
fe.log_scale_shift: 6
fe.activity_detection_enable: False
fe.activity_detection_alpha_a: 0.5
fe.activity_detection_alpha_b: 0.8
fe.activity_detection_arm_threshold: 0.75
fe.activity_detection_trip_threshold: 0.8
fe.dc_notch_filter_enable: True
fe.dc_notch_filter_coefficient: 0.95
fe.quantize_dynamic_scale_enable: True
fe.quantize_dynamic_scale_range_db: 40.0
average_window_duration_ms: 300
detection_threshold_list: [242, 242, 255]
suppression_ms: 700
minimum_count: 2
volume_gain: 0.0
latency_ms: 10
verbose_model_output_logs: False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Summarize the TF-Lite Model</span>
<span class="c1"># This is the quantized model that eventually goes on the embedded device</span>
<span class="o">!</span>mltk<span class="w"> </span>summarize<span class="w"> </span>keyword_spotting_on_off_v3<span class="w"> </span>--tflite<span class="w"> </span>--build
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+-------------------+-----------------+-----------------+------------------------------------------------------+
| Index | OpCode            | Input(s)        | Output(s)       | Config                                               |
+-------+-------------------+-----------------+-----------------+------------------------------------------------------+
| 0     | conv_2d           | 98x1x104 (int8) | 98x1x50 (int8)  | Padding:Same stride:1x1 activation:None              |
|       |                   | 3x1x104 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 1     | conv_2d           | 98x1x50 (int8)  | 98x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 2     | depthwise_conv_2d | 98x1x150 (int8) | 49x1x150 (int8) | Multiplier:1 padding:Same stride:2x2 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 3     | conv_2d           | 49x1x150 (int8) | 49x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 4     | conv_2d           | 98x1x50 (int8)  | 49x1x50 (int8)  | Padding:Same stride:2x2 activation:Relu              |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 5     | add               | 49x1x50 (int8)  | 49x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 49x1x50 (int8)  |                 |                                                      |
| 6     | conv_2d           | 49x1x50 (int8)  | 49x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 7     | depthwise_conv_2d | 49x1x150 (int8) | 49x1x150 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 8     | conv_2d           | 49x1x150 (int8) | 49x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 9     | add               | 49x1x50 (int8)  | 49x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 49x1x50 (int8)  |                 |                                                      |
| 10    | conv_2d           | 49x1x50 (int8)  | 49x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 11    | depthwise_conv_2d | 49x1x150 (int8) | 49x1x150 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 12    | conv_2d           | 49x1x150 (int8) | 49x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 13    | add               | 49x1x50 (int8)  | 49x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 49x1x50 (int8)  |                 |                                                      |
| 14    | conv_2d           | 49x1x50 (int8)  | 49x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 15    | depthwise_conv_2d | 49x1x150 (int8) | 49x1x150 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 16    | conv_2d           | 49x1x150 (int8) | 49x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 17    | add               | 49x1x50 (int8)  | 49x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 49x1x50 (int8)  |                 |                                                      |
| 18    | conv_2d           | 49x1x50 (int8)  | 49x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 19    | depthwise_conv_2d | 49x1x150 (int8) | 25x1x150 (int8) | Multiplier:1 padding:Same stride:2x2 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 20    | conv_2d           | 25x1x150 (int8) | 25x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 21    | conv_2d           | 49x1x50 (int8)  | 25x1x50 (int8)  | Padding:Same stride:2x2 activation:Relu              |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 22    | add               | 25x1x50 (int8)  | 25x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 25x1x50 (int8)  |                 |                                                      |
| 23    | conv_2d           | 25x1x50 (int8)  | 25x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 24    | depthwise_conv_2d | 25x1x150 (int8) | 25x1x150 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 25    | conv_2d           | 25x1x150 (int8) | 25x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 26    | add               | 25x1x50 (int8)  | 25x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 25x1x50 (int8)  |                 |                                                      |
| 27    | conv_2d           | 25x1x50 (int8)  | 25x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 28    | depthwise_conv_2d | 25x1x150 (int8) | 25x1x150 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 29    | conv_2d           | 25x1x150 (int8) | 25x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 30    | add               | 25x1x50 (int8)  | 25x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 25x1x50 (int8)  |                 |                                                      |
| 31    | conv_2d           | 25x1x50 (int8)  | 25x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 32    | depthwise_conv_2d | 25x1x150 (int8) | 25x1x150 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 33    | conv_2d           | 25x1x150 (int8) | 25x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 34    | add               | 25x1x50 (int8)  | 25x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 25x1x50 (int8)  |                 |                                                      |
| 35    | conv_2d           | 25x1x50 (int8)  | 25x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 36    | depthwise_conv_2d | 25x1x150 (int8) | 13x1x150 (int8) | Multiplier:1 padding:Same stride:2x2 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 37    | conv_2d           | 13x1x150 (int8) | 13x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 38    | conv_2d           | 25x1x50 (int8)  | 13x1x50 (int8)  | Padding:Same stride:2x2 activation:Relu              |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 39    | add               | 13x1x50 (int8)  | 13x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 13x1x50 (int8)  |                 |                                                      |
| 40    | conv_2d           | 13x1x50 (int8)  | 13x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 41    | depthwise_conv_2d | 13x1x150 (int8) | 13x1x150 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 42    | conv_2d           | 13x1x150 (int8) | 13x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 43    | add               | 13x1x50 (int8)  | 13x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 13x1x50 (int8)  |                 |                                                      |
| 44    | conv_2d           | 13x1x50 (int8)  | 13x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 45    | depthwise_conv_2d | 13x1x150 (int8) | 13x1x150 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 46    | conv_2d           | 13x1x150 (int8) | 13x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 47    | add               | 13x1x50 (int8)  | 13x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 13x1x50 (int8)  |                 |                                                      |
| 48    | conv_2d           | 13x1x50 (int8)  | 13x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 49    | depthwise_conv_2d | 13x1x150 (int8) | 13x1x150 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 50    | conv_2d           | 13x1x150 (int8) | 13x1x50 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 51    | add               | 13x1x50 (int8)  | 13x1x50 (int8)  | Activation:Relu                                      |
|       |                   | 13x1x50 (int8)  |                 |                                                      |
| 52    | conv_2d           | 13x1x50 (int8)  | 13x1x150 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 53    | depthwise_conv_2d | 13x1x150 (int8) | 7x1x150 (int8)  | Multiplier:1 padding:Same stride:2x2 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 54    | conv_2d           | 7x1x150 (int8)  | 7x1x50 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 55    | conv_2d           | 13x1x50 (int8)  | 7x1x50 (int8)   | Padding:Same stride:2x2 activation:Relu              |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 56    | add               | 7x1x50 (int8)   | 7x1x50 (int8)   | Activation:Relu                                      |
|       |                   | 7x1x50 (int8)   |                 |                                                      |
| 57    | conv_2d           | 7x1x50 (int8)   | 7x1x150 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 58    | depthwise_conv_2d | 7x1x150 (int8)  | 7x1x150 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 59    | conv_2d           | 7x1x150 (int8)  | 7x1x50 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 60    | add               | 7x1x50 (int8)   | 7x1x50 (int8)   | Activation:Relu                                      |
|       |                   | 7x1x50 (int8)   |                 |                                                      |
| 61    | conv_2d           | 7x1x50 (int8)   | 7x1x150 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 62    | depthwise_conv_2d | 7x1x150 (int8)  | 7x1x150 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 63    | conv_2d           | 7x1x150 (int8)  | 7x1x50 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 64    | add               | 7x1x50 (int8)   | 7x1x50 (int8)   | Activation:Relu                                      |
|       |                   | 7x1x50 (int8)   |                 |                                                      |
| 65    | conv_2d           | 7x1x50 (int8)   | 7x1x150 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 66    | depthwise_conv_2d | 7x1x150 (int8)  | 7x1x150 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 67    | conv_2d           | 7x1x150 (int8)  | 7x1x50 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 68    | add               | 7x1x50 (int8)   | 7x1x50 (int8)   | Activation:Relu                                      |
|       |                   | 7x1x50 (int8)   |                 |                                                      |
| 69    | conv_2d           | 7x1x50 (int8)   | 7x1x150 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 70    | depthwise_conv_2d | 7x1x150 (int8)  | 4x1x150 (int8)  | Multiplier:1 padding:Same stride:2x2 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 71    | conv_2d           | 4x1x150 (int8)  | 4x1x50 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 72    | conv_2d           | 7x1x50 (int8)   | 4x1x50 (int8)   | Padding:Same stride:2x2 activation:Relu              |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 73    | add               | 4x1x50 (int8)   | 4x1x50 (int8)   | Activation:Relu                                      |
|       |                   | 4x1x50 (int8)   |                 |                                                      |
| 74    | conv_2d           | 4x1x50 (int8)   | 4x1x150 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 75    | depthwise_conv_2d | 4x1x150 (int8)  | 4x1x150 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 76    | conv_2d           | 4x1x150 (int8)  | 4x1x50 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 77    | add               | 4x1x50 (int8)   | 4x1x50 (int8)   | Activation:Relu                                      |
|       |                   | 4x1x50 (int8)   |                 |                                                      |
| 78    | conv_2d           | 4x1x50 (int8)   | 4x1x150 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 79    | depthwise_conv_2d | 4x1x150 (int8)  | 4x1x150 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 80    | conv_2d           | 4x1x150 (int8)  | 4x1x50 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 81    | add               | 4x1x50 (int8)   | 4x1x50 (int8)   | Activation:Relu                                      |
|       |                   | 4x1x50 (int8)   |                 |                                                      |
| 82    | conv_2d           | 4x1x50 (int8)   | 4x1x150 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x50 (int8)   |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 83    | depthwise_conv_2d | 4x1x150 (int8)  | 4x1x150 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x150 (int8)  |                 |                                                      |
|       |                   | 150 (int32)     |                 |                                                      |
| 84    | conv_2d           | 4x1x150 (int8)  | 4x1x50 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x150 (int8)  |                 |                                                      |
|       |                   | 50 (int32)      |                 |                                                      |
| 85    | add               | 4x1x50 (int8)   | 4x1x50 (int8)   | Activation:Relu                                      |
|       |                   | 4x1x50 (int8)   |                 |                                                      |
| 86    | average_pool_2d   | 4x1x50 (int8)   | 1x1x50 (int8)   | Padding:Valid stride:1x4 filter:1x4 activation:None  |
| 87    | reshape           | 1x1x50 (int8)   | 50 (int8)       | Type=none                                            |
|       |                   | 2 (int32)       |                 |                                                      |
| 88    | fully_connected   | 50 (int8)       | 3 (int8)        | Activation:None                                      |
|       |                   | 50 (int8)       |                 |                                                      |
|       |                   | 3 (int32)       |                 |                                                      |
| 89    | softmax           | 3 (int8)        | 3 (int8)        | Type=softmaxoptions                                  |
+-------+-------------------+-----------------+-----------------+------------------------------------------------------+
Total MACs: 8.888 M
Total OPs: 17.957 M
Name: keyword_spotting_on_off_v3
Version: 1
Description: Keyword spotting classifier to detect: on, off
Classes: on, off, _unknown_
Runtime memory size (RAM): 104.120 k
hash: ff35e03b5bd73d1e70c4fb37444e1eb2
date: 2023-06-15T22:31:22.758Z
fe.sample_rate_hz: 16000
fe.fft_length: 512
fe.sample_length_ms: 1000
fe.window_size_ms: 30
fe.window_step_ms: 10
fe.filterbank_n_channels: 104
fe.filterbank_upper_band_limit: 7500.0
fe.filterbank_lower_band_limit: 125.0
fe.noise_reduction_enable: True
fe.noise_reduction_smoothing_bits: 10
fe.noise_reduction_even_smoothing: 0.02500000037252903
fe.noise_reduction_odd_smoothing: 0.05999999865889549
fe.noise_reduction_min_signal_remaining: 0.4000000059604645
fe.pcan_enable: False
fe.pcan_strength: 0.949999988079071
fe.pcan_offset: 80.0
fe.pcan_gain_bits: 21
fe.log_scale_enable: True
fe.log_scale_shift: 6
fe.activity_detection_enable: False
fe.activity_detection_alpha_a: 0.5
fe.activity_detection_alpha_b: 0.800000011920929
fe.activity_detection_arm_threshold: 0.75
fe.activity_detection_trip_threshold: 0.800000011920929
fe.dc_notch_filter_enable: True
fe.dc_notch_filter_coefficient: 0.949999988079071
fe.quantize_dynamic_scale_enable: True
fe.quantize_dynamic_scale_range_db: 40.0
average_window_duration_ms: 300
detection_threshold_list: [242, 242, 255]
suppression_ms: 700
minimum_count: 2
volume_gain: 0.0
latency_ms: 10
verbose_model_output_logs: False
.tflite file size: 608.2kB
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-visualization">
<h2 id="model-visualization">Model Visualization<a class="headerlink" href="#model-visualization" title="Permalink to this heading">¶</a></h2>
<p>The MLTK also allows for visualizing the model in an interactive webpage.</p>
<p>This is done using the <code class="docutils literal notranslate"><span class="pre">view</span></code> command.
Refer to the <a class="reference internal" href="../../docs/guides/model_visualizer.html"><span class="doc std std-doc">Model Visualization Guide</span></a> for more details on how this works.</p>
<p><strong>NOTES:</strong></p>
<ul class="simple">
<li><p>This will open a new tab to your web-browser</p></li>
<li><p>You must click the opened webpage’s ‘Accept’ button the first time it runs (and possibly re-run the command)</p></li>
<li><p>Since we have not trained our model yet, we must add the <code class="docutils literal notranslate"><span class="pre">--build</span></code> option to the command. This is not required once the model is trained.</p></li>
<li><p>This command must run locally, it will not work from a remote terminal/notebook</p></li>
</ul>
<section id="visualize-keras-model">
<h3 id="visualize-keras-model">Visualize Keras model<a class="headerlink" href="#visualize-keras-model" title="Permalink to this heading">¶</a></h3>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">view</span></code> command will visualize the <a class="reference internal" href="../../docs/python_api/keras_model.html"><span class="doc std std-doc">KerasModel</span></a>, the model used for training (file extension <code class="docutils literal notranslate"><span class="pre">.h5</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will open a new tab in your web browser</span>
<span class="c1"># Be sure the click the 'Accept' button in the opened webpage</span>
<span class="c1"># (you may need to re-run this command after doing so)</span>
<span class="o">!</span>mltk<span class="w"> </span>view<span class="w"> </span>keyword_spotting_on_off_v3<span class="w"> </span>--build
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-tf-lite-model">
<h3 id="visualize-tf-lite-model">Visualize TF-Lite model<a class="headerlink" href="#visualize-tf-lite-model" title="Permalink to this heading">¶</a></h3>
<p>Alternatively, the <code class="docutils literal notranslate"><span class="pre">--tflite</span></code> flag can be used to view the <a class="reference internal" href="../../docs/python_api/tflite_model/index.html"><span class="doc std std-doc">TfliteModel</span></a>, the quantized model that is programmed to the embedded device (file extension <code class="docutils literal notranslate"><span class="pre">.tflite</span></code>).</p>
<p>Note that the structure of the Keras and TfLite models are similar, but the TfLite model is a bit more simple. This is because the <a class="reference external" href="https://www.tensorflow.org/lite/convert">TF-Lite Converter</a> optimized the model by merging/fusing as many layers as possible.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will open a new tab in your web browser</span>
<span class="c1"># Be sure the click the 'Accept' button in the opened webpage</span>
<span class="c1"># (you may need to re-run this command after doing so)</span>
<span class="o">!</span>mltk<span class="w"> </span>view<span class="w"> </span>keyword_spotting_on_off_v3<span class="w"> </span>--tflite<span class="w"> </span>--build
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="model-profiler">
<h2 id="model-profiler">Model Profiler<a class="headerlink" href="#model-profiler" title="Permalink to this heading">¶</a></h2>
<p>Before spending the time and energy to train the model, it may be useful to profile the model to determine how efficiently it may run on the embedded device.
If it’s determined that the model does not fit within the time or memory constraints, then the model layout should be adjusted, the model input size should be reduced, and/or a different model should be selected.</p>
<p>For this reason, th MLTK features a model profiler. Refer to the <a class="reference internal" href="../../docs/guides/model_profiler.html"><span class="doc std std-doc">Model Profiler Guide</span></a> for more details.</p>
<p><strong>NOTE:</strong> The following examples use the <code class="docutils literal notranslate"><span class="pre">--build</span></code> flag since the model has not been trained yet. Once the model is trained this flag is no longer needed.</p>
<section id="profile-in-simulator">
<h3 id="profile-in-simulator">Profile in simulator<a class="headerlink" href="#profile-in-simulator" title="Permalink to this heading">¶</a></h3>
<p>The following command will profile our model in the MVP hardware simulator and return estimates about the time and energy the model might require on the embedded device.</p>
<p><strong>NOTES:</strong></p>
<ul class="simple">
<li><p>An embedded device does not needed to be locally connected to run this command.</p></li>
<li><p>Remove the <code class="docutils literal notranslate"><span class="pre">--accelerator</span> <span class="pre">MVP</span></code> option if you are targeting a device that does not have an MVP hardware accelerator.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mltk<span class="w"> </span>profile<span class="w"> </span>keyword_spotting_on_off_v3<span class="w"> </span>--accelerator<span class="w"> </span>MVP<span class="w"> </span>--build
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HINT: Add the --estimates option to generate energy and CPU cycle estimates
Profiling model in simulator ...

Profiling Summary
Name: keyword_spotting_on_off_v3
Accelerator: MVP
Input Shape: 1x98x1x104
Input Data Type: int8
Output Shape: 1x3
Output Data Type: int8
Flash, Model File Size (bytes): 608.2k
RAM, Runtime Memory Size (bytes): 86.6k
Operation Count: 18.2M
Multiply-Accumulate Count: 8.9M
Layer Count: 90
Unsupported Layer Count: 0
Accelerator Cycle Count: 5.5M

Model Layers
+-------+-------------------+--------+--------+------------+--------------------------+--------------+------------------------------------------------------+
| Index | OpCode            | # Ops  | # MACs | Acc Cycles | Input Shape              | Output Shape | Options                                              |
+-------+-------------------+--------+--------+------------+--------------------------+--------------+------------------------------------------------------+
| 0     | conv_2d           | 3.1M   | 1.5M   | 784.0k     | 1x98x1x104,50x3x1x104,50 | 1x98x1x50    | Padding:Same stride:1x1 activation:None              |
| 1     | conv_2d           | 1.5M   | 735.0k | 428.9k     | 1x98x1x50,150x1x1x50,150 | 1x98x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 2     | depthwise_conv_2d | 154.3k | 66.2k  | 108.0k     | 1x98x1x150,1x9x1x150,150 | 1x49x1x150   | Multiplier:1 padding:Same stride:2x2 activation:Relu |
| 3     | conv_2d           | 737.5k | 367.5k | 197.3k     | 1x49x1x150,50x1x1x150,50 | 1x49x1x50    | Padding:Valid stride:1x1 activation:None             |
| 4     | conv_2d           | 252.3k | 122.5k | 73.6k      | 1x98x1x50,50x1x1x50,50   | 1x49x1x50    | Padding:Same stride:2x2 activation:Relu              |
| 5     | add               | 2.5k   | 0      | 6.1k       | 1x49x1x50,1x49x1x50      | 1x49x1x50    | Activation:Relu                                      |
| 6     | conv_2d           | 757.0k | 367.5k | 214.5k     | 1x49x1x50,150x1x1x50,150 | 1x49x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 7     | depthwise_conv_2d | 154.3k | 66.2k  | 105.8k     | 1x49x1x150,1x9x1x150,150 | 1x49x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 8     | conv_2d           | 737.5k | 367.5k | 197.3k     | 1x49x1x150,50x1x1x150,50 | 1x49x1x50    | Padding:Valid stride:1x1 activation:None             |
| 9     | add               | 2.5k   | 0      | 6.1k       | 1x49x1x50,1x49x1x50      | 1x49x1x50    | Activation:Relu                                      |
| 10    | conv_2d           | 757.0k | 367.5k | 214.5k     | 1x49x1x50,150x1x1x50,150 | 1x49x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 11    | depthwise_conv_2d | 154.3k | 66.2k  | 105.8k     | 1x49x1x150,1x9x1x150,150 | 1x49x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 12    | conv_2d           | 737.5k | 367.5k | 197.3k     | 1x49x1x150,50x1x1x150,50 | 1x49x1x50    | Padding:Valid stride:1x1 activation:None             |
| 13    | add               | 2.5k   | 0      | 6.1k       | 1x49x1x50,1x49x1x50      | 1x49x1x50    | Activation:Relu                                      |
| 14    | conv_2d           | 757.0k | 367.5k | 214.5k     | 1x49x1x50,150x1x1x50,150 | 1x49x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 15    | depthwise_conv_2d | 154.3k | 66.2k  | 105.8k     | 1x49x1x150,1x9x1x150,150 | 1x49x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 16    | conv_2d           | 737.5k | 367.5k | 197.3k     | 1x49x1x150,50x1x1x150,50 | 1x49x1x50    | Padding:Valid stride:1x1 activation:None             |
| 17    | add               | 2.5k   | 0      | 6.1k       | 1x49x1x50,1x49x1x50      | 1x49x1x50    | Activation:Relu                                      |
| 18    | conv_2d           | 757.0k | 367.5k | 214.5k     | 1x49x1x50,150x1x1x50,150 | 1x49x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 19    | depthwise_conv_2d | 78.8k  | 33.8k  | 53.5k      | 1x49x1x150,1x9x1x150,150 | 1x25x1x150   | Multiplier:1 padding:Same stride:2x2 activation:Relu |
| 20    | conv_2d           | 376.2k | 187.5k | 100.7k     | 1x25x1x150,50x1x1x150,50 | 1x25x1x50    | Padding:Valid stride:1x1 activation:None             |
| 21    | conv_2d           | 128.8k | 62.5k  | 37.5k      | 1x49x1x50,50x1x1x50,50   | 1x25x1x50    | Padding:Same stride:2x2 activation:Relu              |
| 22    | add               | 1.2k   | 0      | 3.1k       | 1x25x1x50,1x25x1x50      | 1x25x1x50    | Activation:Relu                                      |
| 23    | conv_2d           | 386.2k | 187.5k | 109.5k     | 1x25x1x50,150x1x1x50,150 | 1x25x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 24    | depthwise_conv_2d | 78.8k  | 33.8k  | 51.8k      | 1x25x1x150,1x9x1x150,150 | 1x25x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 25    | conv_2d           | 376.2k | 187.5k | 100.7k     | 1x25x1x150,50x1x1x150,50 | 1x25x1x50    | Padding:Valid stride:1x1 activation:None             |
| 26    | add               | 1.2k   | 0      | 3.1k       | 1x25x1x50,1x25x1x50      | 1x25x1x50    | Activation:Relu                                      |
| 27    | conv_2d           | 386.2k | 187.5k | 109.5k     | 1x25x1x50,150x1x1x50,150 | 1x25x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 28    | depthwise_conv_2d | 78.8k  | 33.8k  | 51.8k      | 1x25x1x150,1x9x1x150,150 | 1x25x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 29    | conv_2d           | 376.2k | 187.5k | 100.7k     | 1x25x1x150,50x1x1x150,50 | 1x25x1x50    | Padding:Valid stride:1x1 activation:None             |
| 30    | add               | 1.2k   | 0      | 3.1k       | 1x25x1x50,1x25x1x50      | 1x25x1x50    | Activation:Relu                                      |
| 31    | conv_2d           | 386.2k | 187.5k | 109.5k     | 1x25x1x50,150x1x1x50,150 | 1x25x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 32    | depthwise_conv_2d | 78.8k  | 33.8k  | 51.8k      | 1x25x1x150,1x9x1x150,150 | 1x25x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 33    | conv_2d           | 376.2k | 187.5k | 100.7k     | 1x25x1x150,50x1x1x150,50 | 1x25x1x50    | Padding:Valid stride:1x1 activation:None             |
| 34    | add               | 1.2k   | 0      | 3.1k       | 1x25x1x50,1x25x1x50      | 1x25x1x50    | Activation:Relu                                      |
| 35    | conv_2d           | 386.2k | 187.5k | 109.5k     | 1x25x1x50,150x1x1x50,150 | 1x25x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 36    | depthwise_conv_2d | 41.0k  | 17.6k  | 26.6k      | 1x25x1x150,1x9x1x150,150 | 1x13x1x150   | Multiplier:1 padding:Same stride:2x2 activation:Relu |
| 37    | conv_2d           | 195.7k | 97.5k  | 52.4k      | 1x13x1x150,50x1x1x150,50 | 1x13x1x50    | Padding:Valid stride:1x1 activation:None             |
| 38    | conv_2d           | 67.0k  | 32.5k  | 19.5k      | 1x25x1x50,50x1x1x50,50   | 1x13x1x50    | Padding:Same stride:2x2 activation:Relu              |
| 39    | add               | 650.0  | 0      | 1.6k       | 1x13x1x50,1x13x1x50      | 1x13x1x50    | Activation:Relu                                      |
| 40    | conv_2d           | 200.8k | 97.5k  | 57.0k      | 1x13x1x50,150x1x1x50,150 | 1x13x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 41    | depthwise_conv_2d | 41.0k  | 17.6k  | 24.8k      | 1x13x1x150,1x9x1x150,150 | 1x13x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 42    | conv_2d           | 195.7k | 97.5k  | 52.4k      | 1x13x1x150,50x1x1x150,50 | 1x13x1x50    | Padding:Valid stride:1x1 activation:None             |
| 43    | add               | 650.0  | 0      | 1.6k       | 1x13x1x50,1x13x1x50      | 1x13x1x50    | Activation:Relu                                      |
| 44    | conv_2d           | 200.8k | 97.5k  | 57.0k      | 1x13x1x50,150x1x1x50,150 | 1x13x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 45    | depthwise_conv_2d | 41.0k  | 17.6k  | 24.8k      | 1x13x1x150,1x9x1x150,150 | 1x13x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 46    | conv_2d           | 195.7k | 97.5k  | 52.4k      | 1x13x1x150,50x1x1x150,50 | 1x13x1x50    | Padding:Valid stride:1x1 activation:None             |
| 47    | add               | 650.0  | 0      | 1.6k       | 1x13x1x50,1x13x1x50      | 1x13x1x50    | Activation:Relu                                      |
| 48    | conv_2d           | 200.8k | 97.5k  | 57.0k      | 1x13x1x50,150x1x1x50,150 | 1x13x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 49    | depthwise_conv_2d | 41.0k  | 17.6k  | 24.8k      | 1x13x1x150,1x9x1x150,150 | 1x13x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 50    | conv_2d           | 195.7k | 97.5k  | 52.4k      | 1x13x1x150,50x1x1x150,50 | 1x13x1x50    | Padding:Valid stride:1x1 activation:None             |
| 51    | add               | 650.0  | 0      | 1.6k       | 1x13x1x50,1x13x1x50      | 1x13x1x50    | Activation:Relu                                      |
| 52    | conv_2d           | 200.8k | 97.5k  | 57.0k      | 1x13x1x50,150x1x1x50,150 | 1x13x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 53    | depthwise_conv_2d | 22.1k  | 9.4k   | 13.1k      | 1x13x1x150,1x9x1x150,150 | 1x7x1x150    | Multiplier:1 padding:Same stride:2x2 activation:Relu |
| 54    | conv_2d           | 105.3k | 52.5k  | 28.2k      | 1x7x1x150,50x1x1x150,50  | 1x7x1x50     | Padding:Valid stride:1x1 activation:None             |
| 55    | conv_2d           | 36.0k  | 17.5k  | 10.5k      | 1x13x1x50,50x1x1x50,50   | 1x7x1x50     | Padding:Same stride:2x2 activation:Relu              |
| 56    | add               | 350.0  | 0      | 875.0      | 1x7x1x50,1x7x1x50        | 1x7x1x50     | Activation:Relu                                      |
| 57    | conv_2d           | 108.2k | 52.5k  | 30.8k      | 1x7x1x50,150x1x1x50,150  | 1x7x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 58    | depthwise_conv_2d | 22.1k  | 9.4k   | 11.2k      | 1x7x1x150,1x9x1x150,150  | 1x7x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 59    | conv_2d           | 105.3k | 52.5k  | 28.2k      | 1x7x1x150,50x1x1x150,50  | 1x7x1x50     | Padding:Valid stride:1x1 activation:None             |
| 60    | add               | 350.0  | 0      | 875.0      | 1x7x1x50,1x7x1x50        | 1x7x1x50     | Activation:Relu                                      |
| 61    | conv_2d           | 108.2k | 52.5k  | 30.8k      | 1x7x1x50,150x1x1x50,150  | 1x7x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 62    | depthwise_conv_2d | 22.1k  | 9.4k   | 11.2k      | 1x7x1x150,1x9x1x150,150  | 1x7x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 63    | conv_2d           | 105.3k | 52.5k  | 28.2k      | 1x7x1x150,50x1x1x150,50  | 1x7x1x50     | Padding:Valid stride:1x1 activation:None             |
| 64    | add               | 350.0  | 0      | 875.0      | 1x7x1x50,1x7x1x50        | 1x7x1x50     | Activation:Relu                                      |
| 65    | conv_2d           | 108.2k | 52.5k  | 30.8k      | 1x7x1x50,150x1x1x50,150  | 1x7x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 66    | depthwise_conv_2d | 22.1k  | 9.4k   | 11.2k      | 1x7x1x150,1x9x1x150,150  | 1x7x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 67    | conv_2d           | 105.3k | 52.5k  | 28.2k      | 1x7x1x150,50x1x1x150,50  | 1x7x1x50     | Padding:Valid stride:1x1 activation:None             |
| 68    | add               | 350.0  | 0      | 875.0      | 1x7x1x50,1x7x1x50        | 1x7x1x50     | Activation:Relu                                      |
| 69    | conv_2d           | 108.2k | 52.5k  | 30.8k      | 1x7x1x50,150x1x1x50,150  | 1x7x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 70    | depthwise_conv_2d | 12.6k  | 5.4k   | 6.3k       | 1x7x1x150,1x9x1x150,150  | 1x4x1x150    | Multiplier:1 padding:Same stride:2x2 activation:Relu |
| 71    | conv_2d           | 60.2k  | 30.0k  | 16.1k      | 1x4x1x150,50x1x1x150,50  | 1x4x1x50     | Padding:Valid stride:1x1 activation:None             |
| 72    | conv_2d           | 20.6k  | 10.0k  | 6.0k       | 1x7x1x50,50x1x1x50,50    | 1x4x1x50     | Padding:Same stride:2x2 activation:Relu              |
| 73    | add               | 200.0  | 0      | 500.0      | 1x4x1x50,1x4x1x50        | 1x4x1x50     | Activation:Relu                                      |
| 74    | conv_2d           | 61.8k  | 30.0k  | 17.6k      | 1x4x1x50,150x1x1x50,150  | 1x4x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 75    | depthwise_conv_2d | 12.6k  | 5.4k   | 4.5k       | 1x4x1x150,1x9x1x150,150  | 1x4x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 76    | conv_2d           | 60.2k  | 30.0k  | 16.1k      | 1x4x1x150,50x1x1x150,50  | 1x4x1x50     | Padding:Valid stride:1x1 activation:None             |
| 77    | add               | 200.0  | 0      | 500.0      | 1x4x1x50,1x4x1x50        | 1x4x1x50     | Activation:Relu                                      |
| 78    | conv_2d           | 61.8k  | 30.0k  | 17.6k      | 1x4x1x50,150x1x1x50,150  | 1x4x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 79    | depthwise_conv_2d | 12.6k  | 5.4k   | 4.5k       | 1x4x1x150,1x9x1x150,150  | 1x4x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 80    | conv_2d           | 60.2k  | 30.0k  | 16.1k      | 1x4x1x150,50x1x1x150,50  | 1x4x1x50     | Padding:Valid stride:1x1 activation:None             |
| 81    | add               | 200.0  | 0      | 500.0      | 1x4x1x50,1x4x1x50        | 1x4x1x50     | Activation:Relu                                      |
| 82    | conv_2d           | 61.8k  | 30.0k  | 17.6k      | 1x4x1x50,150x1x1x50,150  | 1x4x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 83    | depthwise_conv_2d | 12.6k  | 5.4k   | 4.5k       | 1x4x1x150,1x9x1x150,150  | 1x4x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 84    | conv_2d           | 60.2k  | 30.0k  | 16.1k      | 1x4x1x150,50x1x1x150,50  | 1x4x1x50     | Padding:Valid stride:1x1 activation:None             |
| 85    | add               | 200.0  | 0      | 500.0      | 1x4x1x50,1x4x1x50        | 1x4x1x50     | Activation:Relu                                      |
| 86    | average_pool_2d   | 250.0  | 0      | 175.0      | 1x4x1x50                 | 1x1x1x50     | Padding:Valid stride:1x4 filter:1x4 activation:None  |
| 87    | reshape           | 0      | 0      | 0          | 1x1x1x50,2               | 1x50         | Type=none                                            |
| 88    | fully_connected   | 303.0  | 150.0  | 237.0      | 1x50,3x50,3              | 1x3          | Activation:None                                      |
| 89    | softmax           | 15.0   | 0      | 0          | 1x3                      | 1x3          | Type=softmaxoptions                                  |
+-------+-------------------+--------+--------+------------+--------------------------+--------------+------------------------------------------------------+
Profiling time: 0.583819 seconds
</pre></div>
</div>
</div>
</div>
</section>
<section id="profile-on-physical-device">
<h3 id="profile-on-physical-device">Profile on physical device<a class="headerlink" href="#profile-on-physical-device" title="Permalink to this heading">¶</a></h3>
<p>Alternatively, if we have a device locally connected, we can directly profile on that instead. This is useful as the returned profiling numbers are “real”, they are not estimated as they would be in the simulator case.</p>
<p>To profile on a physical device, simply added the <code class="docutils literal notranslate"><span class="pre">--device</span></code> command flag.</p>
<p><strong>NOTES:</strong></p>
<ul class="simple">
<li><p>An embedded device must be locally connected to run this command.</p></li>
<li><p>Remove the <code class="docutils literal notranslate"><span class="pre">--accelerator</span> <span class="pre">MVP</span></code> option if you are targeting a device that does not have an MVP hardware accelerator.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mltk<span class="w"> </span>profile<span class="w"> </span>keyword_spotting_on_off_v3<span class="w">  </span>--device<span class="w"> </span>--accelerator<span class="w"> </span>MVP<span class="w"> </span>--build
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Programming ML model to device ...

Initializing  0% |            | ?B/s
Comparing:  23% | ██▎        | 128kB/s
Comparing:  45% | ████▌      | 115kB/s
Comparing:  68% | ██████▊    | 112kB/s
Comparing:  90% | █████████  | 110kB/s
Comparing: 100% | █████████▉ | 87.4kB/s
Comparing: 100% | ██████████ | 71.1kB/s
Comparing: 100% | ██████████ | 48.5kB/s

Initializing  0% |            | ?B/s
Comparing:  21% | ██▏        | 136kB/s
Comparing:  43% | ████▎      | 117kB/s
Comparing:  64% | ██████▍    | 113kB/s
Comparing:  85% | ████████▌  | 111kB/s
Comparing: 100% | █████████▉ | 97.6kB/s
Comparing: 100% | ██████████ | 71.8kB/s
Comparing: 100% | ██████████ | 49.1kB/s
Profiling ML model on device ...

Profiling Summary
Name: keyword_spotting_on_off_v3
Accelerator: MVP
Input Shape: 1x98x1x104
Input Data Type: int8
Output Shape: 1x3
Output Data Type: int8
Flash, Model File Size (bytes): 608.2k
RAM, Runtime Memory Size (bytes): 84.5k
Operation Count: 18.2M
Multiply-Accumulate Count: 8.9M
Layer Count: 90
Unsupported Layer Count: 0
Accelerator Cycle Count: 7.6M
CPU Cycle Count: 955.5k
CPU Utilization (%): 11.9
Clock Rate (hz): 78.0M
Time (s): 102.9m
Ops/s: 177.2M
MACs/s: 86.3M
Inference/s: 9.7

Model Layers
+-------+-------------------+--------+--------+------------+------------+----------+--------------------------+--------------+------------------------------------------------------+
| Index | OpCode            | # Ops  | # MACs | Acc Cycles | CPU Cycles | Time (s) | Input Shape              | Output Shape | Options                                              |
+-------+-------------------+--------+--------+------------+------------+----------+--------------------------+--------------+------------------------------------------------------+
| 0     | conv_2d           | 3.1M   | 1.5M   | 1.1M       | 11.3k      | 14.7m    | 1x98x1x104,50x3x1x104,50 | 1x98x1x50    | Padding:Same stride:1x1 activation:None              |
| 1     | conv_2d           | 1.5M   | 735.0k | 602.1k     | 5.3k       | 7.6m     | 1x98x1x50,150x1x1x50,150 | 1x98x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 2     | depthwise_conv_2d | 154.3k | 66.2k  | 119.5k     | 78.7k      | 1.9m     | 1x98x1x150,1x9x1x150,150 | 1x49x1x150   | Multiplier:1 padding:Same stride:2x2 activation:Relu |
| 3     | conv_2d           | 737.5k | 367.5k | 288.1k     | 5.3k       | 3.7m     | 1x49x1x150,50x1x1x150,50 | 1x49x1x50    | Padding:Valid stride:1x1 activation:None             |
| 4     | conv_2d           | 252.3k | 122.5k | 102.3k     | 5.2k       | 1.4m     | 1x98x1x50,50x1x1x50,50   | 1x49x1x50    | Padding:Same stride:2x2 activation:Relu              |
| 5     | add               | 2.5k   | 0      | 8.6k       | 3.6k       | 150.0u   | 1x49x1x50,1x49x1x50      | 1x49x1x50    | Activation:Relu                                      |
| 6     | conv_2d           | 757.0k | 367.5k | 301.0k     | 5.3k       | 3.8m     | 1x49x1x50,150x1x1x50,150 | 1x49x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 7     | depthwise_conv_2d | 154.3k | 66.2k  | 117.2k     | 78.5k      | 1.9m     | 1x49x1x150,1x9x1x150,150 | 1x49x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 8     | conv_2d           | 737.5k | 367.5k | 288.1k     | 5.3k       | 3.7m     | 1x49x1x150,50x1x1x150,50 | 1x49x1x50    | Padding:Valid stride:1x1 activation:None             |
| 9     | add               | 2.5k   | 0      | 8.6k       | 3.5k       | 150.0u   | 1x49x1x50,1x49x1x50      | 1x49x1x50    | Activation:Relu                                      |
| 10    | conv_2d           | 757.0k | 367.5k | 301.0k     | 5.3k       | 3.8m     | 1x49x1x50,150x1x1x50,150 | 1x49x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 11    | depthwise_conv_2d | 154.3k | 66.2k  | 117.2k     | 78.5k      | 1.9m     | 1x49x1x150,1x9x1x150,150 | 1x49x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 12    | conv_2d           | 737.5k | 367.5k | 288.1k     | 5.3k       | 3.7m     | 1x49x1x150,50x1x1x150,50 | 1x49x1x50    | Padding:Valid stride:1x1 activation:None             |
| 13    | add               | 2.5k   | 0      | 8.6k       | 3.5k       | 150.0u   | 1x49x1x50,1x49x1x50      | 1x49x1x50    | Activation:Relu                                      |
| 14    | conv_2d           | 757.0k | 367.5k | 301.0k     | 5.3k       | 3.9m     | 1x49x1x50,150x1x1x50,150 | 1x49x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 15    | depthwise_conv_2d | 154.3k | 66.2k  | 117.2k     | 78.5k      | 1.9m     | 1x49x1x150,1x9x1x150,150 | 1x49x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 16    | conv_2d           | 737.5k | 367.5k | 288.1k     | 5.3k       | 3.7m     | 1x49x1x150,50x1x1x150,50 | 1x49x1x50    | Padding:Valid stride:1x1 activation:None             |
| 17    | add               | 2.5k   | 0      | 8.6k       | 3.5k       | 180.0u   | 1x49x1x50,1x49x1x50      | 1x49x1x50    | Activation:Relu                                      |
| 18    | conv_2d           | 757.0k | 367.5k | 301.6k     | 5.3k       | 3.8m     | 1x49x1x50,150x1x1x50,150 | 1x49x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 19    | depthwise_conv_2d | 78.8k  | 33.8k  | 59.3k      | 40.6k      | 960.0u   | 1x49x1x150,1x9x1x150,150 | 1x25x1x150   | Multiplier:1 padding:Same stride:2x2 activation:Relu |
| 20    | conv_2d           | 376.2k | 187.5k | 147.2k     | 5.3k       | 1.9m     | 1x25x1x150,50x1x1x150,50 | 1x25x1x50    | Padding:Valid stride:1x1 activation:None             |
| 21    | conv_2d           | 128.8k | 62.5k  | 52.5k      | 5.2k       | 690.0u   | 1x49x1x50,50x1x1x50,50   | 1x25x1x50    | Padding:Same stride:2x2 activation:Relu              |
| 22    | add               | 1.2k   | 0      | 4.4k       | 2.6k       | 60.0u    | 1x25x1x50,1x25x1x50      | 1x25x1x50    | Activation:Relu                                      |
| 23    | conv_2d           | 386.2k | 187.5k | 153.9k     | 5.3k       | 2.0m     | 1x25x1x50,150x1x1x50,150 | 1x25x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 24    | depthwise_conv_2d | 78.8k  | 33.8k  | 57.5k      | 40.5k      | 960.0u   | 1x25x1x150,1x9x1x150,150 | 1x25x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 25    | conv_2d           | 376.2k | 187.5k | 147.2k     | 5.3k       | 1.9m     | 1x25x1x150,50x1x1x150,50 | 1x25x1x50    | Padding:Valid stride:1x1 activation:None             |
| 26    | add               | 1.2k   | 0      | 4.4k       | 2.6k       | 90.0u    | 1x25x1x50,1x25x1x50      | 1x25x1x50    | Activation:Relu                                      |
| 27    | conv_2d           | 386.2k | 187.5k | 153.9k     | 5.3k       | 2.0m     | 1x25x1x50,150x1x1x50,150 | 1x25x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 28    | depthwise_conv_2d | 78.8k  | 33.8k  | 57.5k      | 40.5k      | 930.0u   | 1x25x1x150,1x9x1x150,150 | 1x25x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 29    | conv_2d           | 376.2k | 187.5k | 147.2k     | 5.3k       | 1.9m     | 1x25x1x150,50x1x1x150,50 | 1x25x1x50    | Padding:Valid stride:1x1 activation:None             |
| 30    | add               | 1.2k   | 0      | 4.4k       | 2.6k       | 90.0u    | 1x25x1x50,1x25x1x50      | 1x25x1x50    | Activation:Relu                                      |
| 31    | conv_2d           | 386.2k | 187.5k | 153.9k     | 5.3k       | 2.0m     | 1x25x1x50,150x1x1x50,150 | 1x25x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 32    | depthwise_conv_2d | 78.8k  | 33.8k  | 57.5k      | 40.5k      | 930.0u   | 1x25x1x150,1x9x1x150,150 | 1x25x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 33    | conv_2d           | 376.2k | 187.5k | 147.2k     | 5.3k       | 1.9m     | 1x25x1x150,50x1x1x150,50 | 1x25x1x50    | Padding:Valid stride:1x1 activation:None             |
| 34    | add               | 1.2k   | 0      | 4.4k       | 2.6k       | 90.0u    | 1x25x1x50,1x25x1x50      | 1x25x1x50    | Activation:Relu                                      |
| 35    | conv_2d           | 386.2k | 187.5k | 153.9k     | 5.3k       | 2.0m     | 1x25x1x50,150x1x1x50,150 | 1x25x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 36    | depthwise_conv_2d | 41.0k  | 17.6k  | 29.5k      | 21.6k      | 510.0u   | 1x25x1x150,1x9x1x150,150 | 1x13x1x150   | Multiplier:1 padding:Same stride:2x2 activation:Relu |
| 37    | conv_2d           | 195.7k | 97.5k  | 76.4k      | 5.3k       | 1.0m     | 1x13x1x150,50x1x1x150,50 | 1x13x1x50    | Padding:Valid stride:1x1 activation:None             |
| 38    | conv_2d           | 67.0k  | 32.5k  | 27.2k      | 5.2k       | 390.0u   | 1x25x1x50,50x1x1x50,50   | 1x13x1x50    | Padding:Same stride:2x2 activation:Relu              |
| 39    | add               | 650.0  | 0      | 2.3k       | 2.6k       | 60.0u    | 1x13x1x50,1x13x1x50      | 1x13x1x50    | Activation:Relu                                      |
| 40    | conv_2d           | 200.8k | 97.5k  | 80.0k      | 5.3k       | 1.1m     | 1x13x1x50,150x1x1x50,150 | 1x13x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 41    | depthwise_conv_2d | 41.0k  | 17.6k  | 27.7k      | 21.6k      | 480.0u   | 1x13x1x150,1x9x1x150,150 | 1x13x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 42    | conv_2d           | 195.7k | 97.5k  | 76.4k      | 5.3k       | 1.0m     | 1x13x1x150,50x1x1x150,50 | 1x13x1x50    | Padding:Valid stride:1x1 activation:None             |
| 43    | add               | 650.0  | 0      | 2.3k       | 2.6k       | 60.0u    | 1x13x1x50,1x13x1x50      | 1x13x1x50    | Activation:Relu                                      |
| 44    | conv_2d           | 200.8k | 97.5k  | 80.0k      | 5.3k       | 1.1m     | 1x13x1x50,150x1x1x50,150 | 1x13x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 45    | depthwise_conv_2d | 41.0k  | 17.6k  | 27.7k      | 21.6k      | 480.0u   | 1x13x1x150,1x9x1x150,150 | 1x13x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 46    | conv_2d           | 195.7k | 97.5k  | 76.4k      | 5.3k       | 1.0m     | 1x13x1x150,50x1x1x150,50 | 1x13x1x50    | Padding:Valid stride:1x1 activation:None             |
| 47    | add               | 650.0  | 0      | 2.3k       | 2.6k       | 60.0u    | 1x13x1x50,1x13x1x50      | 1x13x1x50    | Activation:Relu                                      |
| 48    | conv_2d           | 200.8k | 97.5k  | 80.0k      | 5.3k       | 1.1m     | 1x13x1x50,150x1x1x50,150 | 1x13x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 49    | depthwise_conv_2d | 41.0k  | 17.6k  | 27.7k      | 21.6k      | 480.0u   | 1x13x1x150,1x9x1x150,150 | 1x13x1x150   | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 50    | conv_2d           | 195.7k | 97.5k  | 76.4k      | 5.3k       | 1.0m     | 1x13x1x150,50x1x1x150,50 | 1x13x1x50    | Padding:Valid stride:1x1 activation:None             |
| 51    | add               | 650.0  | 0      | 2.3k       | 2.6k       | 60.0u    | 1x13x1x50,1x13x1x50      | 1x13x1x50    | Activation:Relu                                      |
| 52    | conv_2d           | 200.8k | 97.5k  | 80.0k      | 5.3k       | 1.1m     | 1x13x1x50,150x1x1x50,150 | 1x13x1x150   | Padding:Valid stride:1x1 activation:Relu             |
| 53    | depthwise_conv_2d | 22.1k  | 9.4k   | 14.6k      | 12.1k      | 270.0u   | 1x13x1x150,1x9x1x150,150 | 1x7x1x150    | Multiplier:1 padding:Same stride:2x2 activation:Relu |
| 54    | conv_2d           | 105.3k | 52.5k  | 41.3k      | 5.3k       | 570.0u   | 1x7x1x150,50x1x1x150,50  | 1x7x1x50     | Padding:Valid stride:1x1 activation:None             |
| 55    | conv_2d           | 36.0k  | 17.5k  | 14.7k      | 5.2k       | 270.0u   | 1x13x1x50,50x1x1x50,50   | 1x7x1x50     | Padding:Same stride:2x2 activation:Relu              |
| 56    | add               | 350.0  | 0      | 1.2k       | 2.6k       | 30.0u    | 1x7x1x50,1x7x1x50        | 1x7x1x50     | Activation:Relu                                      |
| 57    | conv_2d           | 108.2k | 52.5k  | 43.1k      | 5.3k       | 600.0u   | 1x7x1x50,150x1x1x50,150  | 1x7x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 58    | depthwise_conv_2d | 22.1k  | 9.4k   | 12.8k      | 12.1k      | 240.0u   | 1x7x1x150,1x9x1x150,150  | 1x7x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 59    | conv_2d           | 105.3k | 52.5k  | 41.3k      | 5.3k       | 570.0u   | 1x7x1x150,50x1x1x150,50  | 1x7x1x50     | Padding:Valid stride:1x1 activation:None             |
| 60    | add               | 350.0  | 0      | 1.2k       | 2.6k       | 60.0u    | 1x7x1x50,1x7x1x50        | 1x7x1x50     | Activation:Relu                                      |
| 61    | conv_2d           | 108.2k | 52.5k  | 43.1k      | 5.3k       | 600.0u   | 1x7x1x50,150x1x1x50,150  | 1x7x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 62    | depthwise_conv_2d | 22.1k  | 9.4k   | 12.8k      | 12.1k      | 270.0u   | 1x7x1x150,1x9x1x150,150  | 1x7x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 63    | conv_2d           | 105.3k | 52.5k  | 41.3k      | 5.3k       | 570.0u   | 1x7x1x150,50x1x1x150,50  | 1x7x1x50     | Padding:Valid stride:1x1 activation:None             |
| 64    | add               | 350.0  | 0      | 1.2k       | 2.6k       | 60.0u    | 1x7x1x50,1x7x1x50        | 1x7x1x50     | Activation:Relu                                      |
| 65    | conv_2d           | 108.2k | 52.5k  | 43.1k      | 5.3k       | 600.0u   | 1x7x1x50,150x1x1x50,150  | 1x7x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 66    | depthwise_conv_2d | 22.1k  | 9.4k   | 12.8k      | 12.1k      | 240.0u   | 1x7x1x150,1x9x1x150,150  | 1x7x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 67    | conv_2d           | 105.3k | 52.5k  | 41.3k      | 5.3k       | 570.0u   | 1x7x1x150,50x1x1x150,50  | 1x7x1x50     | Padding:Valid stride:1x1 activation:None             |
| 68    | add               | 350.0  | 0      | 1.2k       | 2.6k       | 30.0u    | 1x7x1x50,1x7x1x50        | 1x7x1x50     | Activation:Relu                                      |
| 69    | conv_2d           | 108.2k | 52.5k  | 43.2k      | 5.3k       | 630.0u   | 1x7x1x50,150x1x1x50,150  | 1x7x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 70    | depthwise_conv_2d | 12.6k  | 5.4k   | 7.2k       | 7.4k       | 150.0u   | 1x7x1x150,1x9x1x150,150  | 1x4x1x150    | Multiplier:1 padding:Same stride:2x2 activation:Relu |
| 71    | conv_2d           | 60.2k  | 30.0k  | 23.7k      | 5.3k       | 360.0u   | 1x4x1x150,50x1x1x150,50  | 1x4x1x50     | Padding:Valid stride:1x1 activation:None             |
| 72    | conv_2d           | 20.6k  | 10.0k  | 8.5k       | 5.2k       | 150.0u   | 1x7x1x50,50x1x1x50,50    | 1x4x1x50     | Padding:Same stride:2x2 activation:Relu              |
| 73    | add               | 200.0  | 0      | 712.0      | 2.6k       | 60.0u    | 1x4x1x50,1x4x1x50        | 1x4x1x50     | Activation:Relu                                      |
| 74    | conv_2d           | 61.8k  | 30.0k  | 24.8k      | 5.3k       | 390.0u   | 1x4x1x50,150x1x1x50,150  | 1x4x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 75    | depthwise_conv_2d | 12.6k  | 5.4k   | 5.3k       | 7.3k       | 120.0u   | 1x4x1x150,1x9x1x150,150  | 1x4x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 76    | conv_2d           | 60.2k  | 30.0k  | 23.7k      | 5.3k       | 360.0u   | 1x4x1x150,50x1x1x150,50  | 1x4x1x50     | Padding:Valid stride:1x1 activation:None             |
| 77    | add               | 200.0  | 0      | 712.0      | 2.6k       | 30.0u    | 1x4x1x50,1x4x1x50        | 1x4x1x50     | Activation:Relu                                      |
| 78    | conv_2d           | 61.8k  | 30.0k  | 24.8k      | 5.3k       | 390.0u   | 1x4x1x50,150x1x1x50,150  | 1x4x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 79    | depthwise_conv_2d | 12.6k  | 5.4k   | 5.3k       | 7.3k       | 120.0u   | 1x4x1x150,1x9x1x150,150  | 1x4x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 80    | conv_2d           | 60.2k  | 30.0k  | 23.7k      | 5.3k       | 360.0u   | 1x4x1x150,50x1x1x150,50  | 1x4x1x50     | Padding:Valid stride:1x1 activation:None             |
| 81    | add               | 200.0  | 0      | 712.0      | 2.6k       | 60.0u    | 1x4x1x50,1x4x1x50        | 1x4x1x50     | Activation:Relu                                      |
| 82    | conv_2d           | 61.8k  | 30.0k  | 24.8k      | 5.3k       | 360.0u   | 1x4x1x50,150x1x1x50,150  | 1x4x1x150    | Padding:Valid stride:1x1 activation:Relu             |
| 83    | depthwise_conv_2d | 12.6k  | 5.4k   | 5.3k       | 7.3k       | 120.0u   | 1x4x1x150,1x9x1x150,150  | 1x4x1x150    | Multiplier:1 padding:Same stride:1x1 activation:Relu |
| 84    | conv_2d           | 60.2k  | 30.0k  | 23.7k      | 5.3k       | 360.0u   | 1x4x1x150,50x1x1x150,50  | 1x4x1x50     | Padding:Valid stride:1x1 activation:None             |
| 85    | add               | 200.0  | 0      | 712.0      | 2.6k       | 30.0u    | 1x4x1x50,1x4x1x50        | 1x4x1x50     | Activation:Relu                                      |
| 86    | average_pool_2d   | 250.0  | 0      | 189.0      | 3.8k       | 60.0u    | 1x4x1x50                 | 1x1x1x50     | Padding:Valid stride:1x4 filter:1x4 activation:None  |
| 87    | reshape           | 0      | 0      | 0          | 690.0      | 0        | 1x1x1x50,2               | 1x50         | Type=none                                            |
| 88    | fully_connected   | 303.0  | 150.0  | 259.0      | 2.1k       | 30.0u    | 1x50,3x50,3              | 1x3          | Activation:None                                      |
| 89    | softmax           | 15.0   | 0      | 0          | 3.0k       | 30.0u    | 1x3                      | 1x3          | Type=softmaxoptions                                  |
+-------+-------------------+--------+--------+------------+------------+----------+--------------------------+--------------+------------------------------------------------------+
Profiling time: 30.643935 seconds
</pre></div>
</div>
</div>
</div>
</section>
<section id="note-about-cpu-utilization">
<h3 id="note-about-cpu-utilization">Note about CPU utilization<a class="headerlink" href="#note-about-cpu-utilization" title="Permalink to this heading">¶</a></h3>
<p>An important metric the model profiler provides when using the MVP hardware accelerator is <code class="docutils literal notranslate"><span class="pre">CPU</span> <span class="pre">Utilization</span></code>.
This gives an indication of how much CPU is required to run the machine learning model.</p>
<p>If no hardware accelerator is used, then the CPU utilization is 100% as 100% of the machine learning model’s calculations are executed on the CPU.
With the hardware accelerator, many of the model’s calculations can be offloaded to the accelerator freeing the CPU to do other tasks.</p>
<p>The additional CPU cycles the hardware accelerator provides can be a major benefit, especially when other tasks such as real-time audio processing are required.</p>
</section>
</section>
<section id="model-training">
<h2 id="model-training">Model Training<a class="headerlink" href="#model-training" title="Permalink to this heading">¶</a></h2>
<p>Now that we have our model fully specified and it fits within the constraints of the embedded device, we can train the model.</p>
<p>The basic flow for model training is:</p>
<ol class="arabic simple">
<li><p>Invoke the <code class="docutils literal notranslate"><span class="pre">train</span></code> command</p></li>
<li><p>Tensorflow trains the model</p></li>
<li><p>A <a class="reference internal" href="../../docs/guides/model_archive.html"><span class="doc std std-doc">Model Archive</span></a> containing the trained model is generated in the same directory as the model specification script</p></li>
</ol>
<p>Refer to the <a class="reference internal" href="../../docs/guides/model_training.html"><span class="doc std std-doc">Model Training Guide</span></a> for more details about this process.</p>
<section id="train-as-a-dry-run">
<h3 id="train-as-a-dry-run">Train as a “dry run”<a class="headerlink" href="#train-as-a-dry-run" title="Permalink to this heading">¶</a></h3>
<p>Before fully training the model, sometimes it is useful to train the model as a “dry run” to ensure the end-to-end training process works. Here, the model is trained for a few epochs on a subset of the dataset.</p>
<p>To train as a dry run, append <code class="docutils literal notranslate"><span class="pre">-test</span></code> to the model name.<br/>
At the end of training, a <a class="reference internal" href="../../docs/guides/model_archive.html"><span class="doc std std-doc">Model Archive</span></a> with <code class="docutils literal notranslate"><span class="pre">-test</span></code> appended to the archive name is generated in the same directory as the model specification script.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Train as a dry run by appending "-test" to the model name</span>
<span class="o">!</span>mltk<span class="w"> </span>train<span class="w"> </span>keyword_spotting_on_off_v3-test
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Enabling test mode



*******************************************************************************
WARNING: Failed to load GPU driver

This could mean that the driver or CUDA libraries are not properly installed,
or that your installed GPU driver does not match the Tensorflow version.

Refer to the Tensorflow GPU installation guide here:
https://www.tensorflow.org/install/gpu
https://www.tensorflow.org/install/source#gpu

Alternatively, you can disable the GPU by defining the environment variable: CUDA_VISIBLE_DEVICES=-1
.e.g.:
set CUDA_VISIBLE_DEVICES=-1

*******************************************************************************

WARNING:tensorflow:From C:\Users\dried\silabs\mltk\.venv\lib\site-packages\tensorflow\python\autograph\pyct\static_analysis\liveness.py:83: Analyzer.lamba_check (from tensorflow.python.autograph.pyct.static_analysis.liveness) is deprecated and will be removed after 2023-09-23.
Instructions for updating:
Lambda fuctions will be no more assumed to be used in the statement where they are used, or at least in the same block. https://github.com/tensorflow/tensorflow/issues/56089
training is using 8 subprocesses
validation is using 8 subprocesses
Model: "TENet"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 input_1 (InputLayer)           [(None, 98, 1, 104)  0           []                               
                                ]                                                                 
                                                                                                  
 conv2d (Conv2D)                (None, 98, 1, 50)    15650       ['input_1[0][0]']                
                                                                                                  
 pointwise_expand_conv-0 (Conv2  (None, 98, 1, 150)  7500        ['conv2d[0][0]']                 
 D)                                                                                               
                                                                                                  
 batch_normalization (BatchNorm  (None, 98, 1, 150)  600         ['pointwise_expand_conv-0[0][0]']
 alization)                                                                                       
                                                                                                  
 re_lu (ReLU)                   (None, 98, 1, 150)   0           ['batch_normalization[0][0]']    
                                                                                                  
 mtconv-0 (MultiScaleTemporalCo  (None, 49, 1, 150)  1350        ['re_lu[0][0]']                  
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_1 (BatchNo  (None, 49, 1, 150)  600         ['mtconv-0[0][0]']               
 rmalization)                                                                                     
                                                                                                  
 re_lu_1 (ReLU)                 (None, 49, 1, 150)   0           ['batch_normalization_1[0][0]']  
                                                                                                  
 strided_residual-0 (Conv2D)    (None, 49, 1, 50)    2500        ['conv2d[0][0]']                 
                                                                                                  
 pointwise_contract_conv-0 (Con  (None, 49, 1, 50)   7500        ['re_lu_1[0][0]']                
 v2D)                                                                                             
                                                                                                  
 batch_normalization_3 (BatchNo  (None, 49, 1, 50)   200         ['strided_residual-0[0][0]']     
 rmalization)                                                                                     
                                                                                                  
 batch_normalization_2 (BatchNo  (None, 49, 1, 50)   200         ['pointwise_contract_conv-0[0][0]
 rmalization)                                                    ']                               
                                                                                                  
 re_lu_2 (ReLU)                 (None, 49, 1, 50)    0           ['batch_normalization_3[0][0]']  
                                                                                                  
 add (Add)                      (None, 49, 1, 50)    0           ['batch_normalization_2[0][0]',  
                                                                  're_lu_2[0][0]']                
                                                                                                  
 re_lu_3 (ReLU)                 (None, 49, 1, 50)    0           ['add[0][0]']                    
                                                                                                  
 pointwise_expand_conv-1 (Conv2  (None, 49, 1, 150)  7500        ['re_lu_3[0][0]']                
 D)                                                                                               
                                                                                                  
 batch_normalization_4 (BatchNo  (None, 49, 1, 150)  600         ['pointwise_expand_conv-1[0][0]']
 rmalization)                                                                                     
                                                                                                  
 re_lu_4 (ReLU)                 (None, 49, 1, 150)   0           ['batch_normalization_4[0][0]']  
                                                                                                  
 mtconv-1 (MultiScaleTemporalCo  (None, 49, 1, 150)  1350        ['re_lu_4[0][0]']                
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_5 (BatchNo  (None, 49, 1, 150)  600         ['mtconv-1[0][0]']               
 rmalization)                                                                                     
                                                                                                  
 re_lu_5 (ReLU)                 (None, 49, 1, 150)   0           ['batch_normalization_5[0][0]']  
                                                                                                  
 pointwise_contract_conv-1 (Con  (None, 49, 1, 50)   7500        ['re_lu_5[0][0]']                
 v2D)                                                                                             
                                                                                                  
 batch_normalization_6 (BatchNo  (None, 49, 1, 50)   200         ['pointwise_contract_conv-1[0][0]
 rmalization)                                                    ']                               
                                                                                                  
 add_1 (Add)                    (None, 49, 1, 50)    0           ['batch_normalization_6[0][0]',  
                                                                  're_lu_3[0][0]']                
                                                                                                  
 re_lu_6 (ReLU)                 (None, 49, 1, 50)    0           ['add_1[0][0]']                  
                                                                                                  
 pointwise_expand_conv-2 (Conv2  (None, 49, 1, 150)  7500        ['re_lu_6[0][0]']                
 D)                                                                                               
                                                                                                  
 batch_normalization_7 (BatchNo  (None, 49, 1, 150)  600         ['pointwise_expand_conv-2[0][0]']
 rmalization)                                                                                     
                                                                                                  
 re_lu_7 (ReLU)                 (None, 49, 1, 150)   0           ['batch_normalization_7[0][0]']  
                                                                                                  
 mtconv-2 (MultiScaleTemporalCo  (None, 49, 1, 150)  1350        ['re_lu_7[0][0]']                
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_8 (BatchNo  (None, 49, 1, 150)  600         ['mtconv-2[0][0]']               
 rmalization)                                                                                     
                                                                                                  
 re_lu_8 (ReLU)                 (None, 49, 1, 150)   0           ['batch_normalization_8[0][0]']  
                                                                                                  
 pointwise_contract_conv-2 (Con  (None, 49, 1, 50)   7500        ['re_lu_8[0][0]']                
 v2D)                                                                                             
                                                                                                  
 batch_normalization_9 (BatchNo  (None, 49, 1, 50)   200         ['pointwise_contract_conv-2[0][0]
 rmalization)                                                    ']                               
                                                                                                  
 add_2 (Add)                    (None, 49, 1, 50)    0           ['batch_normalization_9[0][0]',  
                                                                  're_lu_6[0][0]']                
                                                                                                  
 re_lu_9 (ReLU)                 (None, 49, 1, 50)    0           ['add_2[0][0]']                  
                                                                                                  
 pointwise_expand_conv-3 (Conv2  (None, 49, 1, 150)  7500        ['re_lu_9[0][0]']                
 D)                                                                                               
                                                                                                  
 batch_normalization_10 (BatchN  (None, 49, 1, 150)  600         ['pointwise_expand_conv-3[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_10 (ReLU)                (None, 49, 1, 150)   0           ['batch_normalization_10[0][0]'] 
                                                                                                  
 mtconv-3 (MultiScaleTemporalCo  (None, 49, 1, 150)  1350        ['re_lu_10[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_11 (BatchN  (None, 49, 1, 150)  600         ['mtconv-3[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_11 (ReLU)                (None, 49, 1, 150)   0           ['batch_normalization_11[0][0]'] 
                                                                                                  
 pointwise_contract_conv-3 (Con  (None, 49, 1, 50)   7500        ['re_lu_11[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_12 (BatchN  (None, 49, 1, 50)   200         ['pointwise_contract_conv-3[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 add_3 (Add)                    (None, 49, 1, 50)    0           ['batch_normalization_12[0][0]', 
                                                                  're_lu_9[0][0]']                
                                                                                                  
 re_lu_12 (ReLU)                (None, 49, 1, 50)    0           ['add_3[0][0]']                  
                                                                                                  
 pointwise_expand_conv-4 (Conv2  (None, 49, 1, 150)  7500        ['re_lu_12[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_13 (BatchN  (None, 49, 1, 150)  600         ['pointwise_expand_conv-4[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_13 (ReLU)                (None, 49, 1, 150)   0           ['batch_normalization_13[0][0]'] 
                                                                                                  
 mtconv-4 (MultiScaleTemporalCo  (None, 25, 1, 150)  1350        ['re_lu_13[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_14 (BatchN  (None, 25, 1, 150)  600         ['mtconv-4[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_14 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_14[0][0]'] 
                                                                                                  
 strided_residual-4 (Conv2D)    (None, 25, 1, 50)    2500        ['re_lu_12[0][0]']               
                                                                                                  
 pointwise_contract_conv-4 (Con  (None, 25, 1, 50)   7500        ['re_lu_14[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_16 (BatchN  (None, 25, 1, 50)   200         ['strided_residual-4[0][0]']     
 ormalization)                                                                                    
                                                                                                  
 batch_normalization_15 (BatchN  (None, 25, 1, 50)   200         ['pointwise_contract_conv-4[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 re_lu_15 (ReLU)                (None, 25, 1, 50)    0           ['batch_normalization_16[0][0]'] 
                                                                                                  
 add_4 (Add)                    (None, 25, 1, 50)    0           ['batch_normalization_15[0][0]', 
                                                                  're_lu_15[0][0]']               
                                                                                                  
 re_lu_16 (ReLU)                (None, 25, 1, 50)    0           ['add_4[0][0]']                  
                                                                                                  
 pointwise_expand_conv-5 (Conv2  (None, 25, 1, 150)  7500        ['re_lu_16[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_17 (BatchN  (None, 25, 1, 150)  600         ['pointwise_expand_conv-5[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_17 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_17[0][0]'] 
                                                                                                  
 mtconv-5 (MultiScaleTemporalCo  (None, 25, 1, 150)  1350        ['re_lu_17[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_18 (BatchN  (None, 25, 1, 150)  600         ['mtconv-5[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_18 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_18[0][0]'] 
                                                                                                  
 pointwise_contract_conv-5 (Con  (None, 25, 1, 50)   7500        ['re_lu_18[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_19 (BatchN  (None, 25, 1, 50)   200         ['pointwise_contract_conv-5[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 add_5 (Add)                    (None, 25, 1, 50)    0           ['batch_normalization_19[0][0]', 
                                                                  're_lu_16[0][0]']               
                                                                                                  
 re_lu_19 (ReLU)                (None, 25, 1, 50)    0           ['add_5[0][0]']                  
                                                                                                  
 pointwise_expand_conv-6 (Conv2  (None, 25, 1, 150)  7500        ['re_lu_19[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_20 (BatchN  (None, 25, 1, 150)  600         ['pointwise_expand_conv-6[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_20 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_20[0][0]'] 
                                                                                                  
 mtconv-6 (MultiScaleTemporalCo  (None, 25, 1, 150)  1350        ['re_lu_20[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_21 (BatchN  (None, 25, 1, 150)  600         ['mtconv-6[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_21 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_21[0][0]'] 
                                                                                                  
 pointwise_contract_conv-6 (Con  (None, 25, 1, 50)   7500        ['re_lu_21[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_22 (BatchN  (None, 25, 1, 50)   200         ['pointwise_contract_conv-6[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 add_6 (Add)                    (None, 25, 1, 50)    0           ['batch_normalization_22[0][0]', 
                                                                  're_lu_19[0][0]']               
                                                                                                  
 re_lu_22 (ReLU)                (None, 25, 1, 50)    0           ['add_6[0][0]']                  
                                                                                                  
 pointwise_expand_conv-7 (Conv2  (None, 25, 1, 150)  7500        ['re_lu_22[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_23 (BatchN  (None, 25, 1, 150)  600         ['pointwise_expand_conv-7[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_23 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_23[0][0]'] 
                                                                                                  
 mtconv-7 (MultiScaleTemporalCo  (None, 25, 1, 150)  1350        ['re_lu_23[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_24 (BatchN  (None, 25, 1, 150)  600         ['mtconv-7[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_24 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_24[0][0]'] 
                                                                                                  
 pointwise_contract_conv-7 (Con  (None, 25, 1, 50)   7500        ['re_lu_24[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_25 (BatchN  (None, 25, 1, 50)   200         ['pointwise_contract_conv-7[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 add_7 (Add)                    (None, 25, 1, 50)    0           ['batch_normalization_25[0][0]', 
                                                                  're_lu_22[0][0]']               
                                                                                                  
 re_lu_25 (ReLU)                (None, 25, 1, 50)    0           ['add_7[0][0]']                  
                                                                                                  
 pointwise_expand_conv-8 (Conv2  (None, 25, 1, 150)  7500        ['re_lu_25[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_26 (BatchN  (None, 25, 1, 150)  600         ['pointwise_expand_conv-8[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_26 (ReLU)                (None, 25, 1, 150)   0           ['batch_normalization_26[0][0]'] 
                                                                                                  
 mtconv-8 (MultiScaleTemporalCo  (None, 13, 1, 150)  1350        ['re_lu_26[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_27 (BatchN  (None, 13, 1, 150)  600         ['mtconv-8[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_27 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_27[0][0]'] 
                                                                                                  
 strided_residual-8 (Conv2D)    (None, 13, 1, 50)    2500        ['re_lu_25[0][0]']               
                                                                                                  
 pointwise_contract_conv-8 (Con  (None, 13, 1, 50)   7500        ['re_lu_27[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_29 (BatchN  (None, 13, 1, 50)   200         ['strided_residual-8[0][0]']     
 ormalization)                                                                                    
                                                                                                  
 batch_normalization_28 (BatchN  (None, 13, 1, 50)   200         ['pointwise_contract_conv-8[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 re_lu_28 (ReLU)                (None, 13, 1, 50)    0           ['batch_normalization_29[0][0]'] 
                                                                                                  
 add_8 (Add)                    (None, 13, 1, 50)    0           ['batch_normalization_28[0][0]', 
                                                                  're_lu_28[0][0]']               
                                                                                                  
 re_lu_29 (ReLU)                (None, 13, 1, 50)    0           ['add_8[0][0]']                  
                                                                                                  
 pointwise_expand_conv-9 (Conv2  (None, 13, 1, 150)  7500        ['re_lu_29[0][0]']               
 D)                                                                                               
                                                                                                  
 batch_normalization_30 (BatchN  (None, 13, 1, 150)  600         ['pointwise_expand_conv-9[0][0]']
 ormalization)                                                                                    
                                                                                                  
 re_lu_30 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_30[0][0]'] 
                                                                                                  
 mtconv-9 (MultiScaleTemporalCo  (None, 13, 1, 150)  1350        ['re_lu_30[0][0]']               
 nvolution)                                                                                       
                                                                                                  
 batch_normalization_31 (BatchN  (None, 13, 1, 150)  600         ['mtconv-9[0][0]']               
 ormalization)                                                                                    
                                                                                                  
 re_lu_31 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_31[0][0]'] 
                                                                                                  
 pointwise_contract_conv-9 (Con  (None, 13, 1, 50)   7500        ['re_lu_31[0][0]']               
 v2D)                                                                                             
                                                                                                  
 batch_normalization_32 (BatchN  (None, 13, 1, 50)   200         ['pointwise_contract_conv-9[0][0]
 ormalization)                                                   ']                               
                                                                                                  
 add_9 (Add)                    (None, 13, 1, 50)    0           ['batch_normalization_32[0][0]', 
                                                                  're_lu_29[0][0]']               
                                                                                                  
 re_lu_32 (ReLU)                (None, 13, 1, 50)    0           ['add_9[0][0]']                  
                                                                                                  
 pointwise_expand_conv-10 (Conv  (None, 13, 1, 150)  7500        ['re_lu_32[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_33 (BatchN  (None, 13, 1, 150)  600         ['pointwise_expand_conv-10[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_33 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_33[0][0]'] 
                                                                                                  
 mtconv-10 (MultiScaleTemporalC  (None, 13, 1, 150)  1350        ['re_lu_33[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_34 (BatchN  (None, 13, 1, 150)  600         ['mtconv-10[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_34 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_34[0][0]'] 
                                                                                                  
 pointwise_contract_conv-10 (Co  (None, 13, 1, 50)   7500        ['re_lu_34[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_35 (BatchN  (None, 13, 1, 50)   200         ['pointwise_contract_conv-10[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_10 (Add)                   (None, 13, 1, 50)    0           ['batch_normalization_35[0][0]', 
                                                                  're_lu_32[0][0]']               
                                                                                                  
 re_lu_35 (ReLU)                (None, 13, 1, 50)    0           ['add_10[0][0]']                 
                                                                                                  
 pointwise_expand_conv-11 (Conv  (None, 13, 1, 150)  7500        ['re_lu_35[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_36 (BatchN  (None, 13, 1, 150)  600         ['pointwise_expand_conv-11[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_36 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_36[0][0]'] 
                                                                                                  
 mtconv-11 (MultiScaleTemporalC  (None, 13, 1, 150)  1350        ['re_lu_36[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_37 (BatchN  (None, 13, 1, 150)  600         ['mtconv-11[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_37 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_37[0][0]'] 
                                                                                                  
 pointwise_contract_conv-11 (Co  (None, 13, 1, 50)   7500        ['re_lu_37[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_38 (BatchN  (None, 13, 1, 50)   200         ['pointwise_contract_conv-11[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_11 (Add)                   (None, 13, 1, 50)    0           ['batch_normalization_38[0][0]', 
                                                                  're_lu_35[0][0]']               
                                                                                                  
 re_lu_38 (ReLU)                (None, 13, 1, 50)    0           ['add_11[0][0]']                 
                                                                                                  
 pointwise_expand_conv-12 (Conv  (None, 13, 1, 150)  7500        ['re_lu_38[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_39 (BatchN  (None, 13, 1, 150)  600         ['pointwise_expand_conv-12[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_39 (ReLU)                (None, 13, 1, 150)   0           ['batch_normalization_39[0][0]'] 
                                                                                                  
 mtconv-12 (MultiScaleTemporalC  (None, 7, 1, 150)   1350        ['re_lu_39[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_40 (BatchN  (None, 7, 1, 150)   600         ['mtconv-12[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_40 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_40[0][0]'] 
                                                                                                  
 strided_residual-12 (Conv2D)   (None, 7, 1, 50)     2500        ['re_lu_38[0][0]']               
                                                                                                  
 pointwise_contract_conv-12 (Co  (None, 7, 1, 50)    7500        ['re_lu_40[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_42 (BatchN  (None, 7, 1, 50)    200         ['strided_residual-12[0][0]']    
 ormalization)                                                                                    
                                                                                                  
 batch_normalization_41 (BatchN  (None, 7, 1, 50)    200         ['pointwise_contract_conv-12[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 re_lu_41 (ReLU)                (None, 7, 1, 50)     0           ['batch_normalization_42[0][0]'] 
                                                                                                  
 add_12 (Add)                   (None, 7, 1, 50)     0           ['batch_normalization_41[0][0]', 
                                                                  're_lu_41[0][0]']               
                                                                                                  
 re_lu_42 (ReLU)                (None, 7, 1, 50)     0           ['add_12[0][0]']                 
                                                                                                  
 pointwise_expand_conv-13 (Conv  (None, 7, 1, 150)   7500        ['re_lu_42[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_43 (BatchN  (None, 7, 1, 150)   600         ['pointwise_expand_conv-13[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_43 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_43[0][0]'] 
                                                                                                  
 mtconv-13 (MultiScaleTemporalC  (None, 7, 1, 150)   1350        ['re_lu_43[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_44 (BatchN  (None, 7, 1, 150)   600         ['mtconv-13[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_44 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_44[0][0]'] 
                                                                                                  
 pointwise_contract_conv-13 (Co  (None, 7, 1, 50)    7500        ['re_lu_44[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_45 (BatchN  (None, 7, 1, 50)    200         ['pointwise_contract_conv-13[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_13 (Add)                   (None, 7, 1, 50)     0           ['batch_normalization_45[0][0]', 
                                                                  're_lu_42[0][0]']               
                                                                                                  
 re_lu_45 (ReLU)                (None, 7, 1, 50)     0           ['add_13[0][0]']                 
                                                                                                  
 pointwise_expand_conv-14 (Conv  (None, 7, 1, 150)   7500        ['re_lu_45[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_46 (BatchN  (None, 7, 1, 150)   600         ['pointwise_expand_conv-14[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_46 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_46[0][0]'] 
                                                                                                  
 mtconv-14 (MultiScaleTemporalC  (None, 7, 1, 150)   1350        ['re_lu_46[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_47 (BatchN  (None, 7, 1, 150)   600         ['mtconv-14[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_47 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_47[0][0]'] 
                                                                                                  
 pointwise_contract_conv-14 (Co  (None, 7, 1, 50)    7500        ['re_lu_47[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_48 (BatchN  (None, 7, 1, 50)    200         ['pointwise_contract_conv-14[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_14 (Add)                   (None, 7, 1, 50)     0           ['batch_normalization_48[0][0]', 
                                                                  're_lu_45[0][0]']               
                                                                                                  
 re_lu_48 (ReLU)                (None, 7, 1, 50)     0           ['add_14[0][0]']                 
                                                                                                  
 pointwise_expand_conv-15 (Conv  (None, 7, 1, 150)   7500        ['re_lu_48[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_49 (BatchN  (None, 7, 1, 150)   600         ['pointwise_expand_conv-15[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_49 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_49[0][0]'] 
                                                                                                  
 mtconv-15 (MultiScaleTemporalC  (None, 7, 1, 150)   1350        ['re_lu_49[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_50 (BatchN  (None, 7, 1, 150)   600         ['mtconv-15[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_50 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_50[0][0]'] 
                                                                                                  
 pointwise_contract_conv-15 (Co  (None, 7, 1, 50)    7500        ['re_lu_50[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_51 (BatchN  (None, 7, 1, 50)    200         ['pointwise_contract_conv-15[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_15 (Add)                   (None, 7, 1, 50)     0           ['batch_normalization_51[0][0]', 
                                                                  're_lu_48[0][0]']               
                                                                                                  
 re_lu_51 (ReLU)                (None, 7, 1, 50)     0           ['add_15[0][0]']                 
                                                                                                  
 pointwise_expand_conv-16 (Conv  (None, 7, 1, 150)   7500        ['re_lu_51[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_52 (BatchN  (None, 7, 1, 150)   600         ['pointwise_expand_conv-16[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_52 (ReLU)                (None, 7, 1, 150)    0           ['batch_normalization_52[0][0]'] 
                                                                                                  
 mtconv-16 (MultiScaleTemporalC  (None, 4, 1, 150)   1350        ['re_lu_52[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_53 (BatchN  (None, 4, 1, 150)   600         ['mtconv-16[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_53 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_53[0][0]'] 
                                                                                                  
 strided_residual-16 (Conv2D)   (None, 4, 1, 50)     2500        ['re_lu_51[0][0]']               
                                                                                                  
 pointwise_contract_conv-16 (Co  (None, 4, 1, 50)    7500        ['re_lu_53[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_55 (BatchN  (None, 4, 1, 50)    200         ['strided_residual-16[0][0]']    
 ormalization)                                                                                    
                                                                                                  
 batch_normalization_54 (BatchN  (None, 4, 1, 50)    200         ['pointwise_contract_conv-16[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 re_lu_54 (ReLU)                (None, 4, 1, 50)     0           ['batch_normalization_55[0][0]'] 
                                                                                                  
 add_16 (Add)                   (None, 4, 1, 50)     0           ['batch_normalization_54[0][0]', 
                                                                  're_lu_54[0][0]']               
                                                                                                  
 re_lu_55 (ReLU)                (None, 4, 1, 50)     0           ['add_16[0][0]']                 
                                                                                                  
 pointwise_expand_conv-17 (Conv  (None, 4, 1, 150)   7500        ['re_lu_55[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_56 (BatchN  (None, 4, 1, 150)   600         ['pointwise_expand_conv-17[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_56 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_56[0][0]'] 
                                                                                                  
 mtconv-17 (MultiScaleTemporalC  (None, 4, 1, 150)   1350        ['re_lu_56[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_57 (BatchN  (None, 4, 1, 150)   600         ['mtconv-17[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_57 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_57[0][0]'] 
                                                                                                  
 pointwise_contract_conv-17 (Co  (None, 4, 1, 50)    7500        ['re_lu_57[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_58 (BatchN  (None, 4, 1, 50)    200         ['pointwise_contract_conv-17[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_17 (Add)                   (None, 4, 1, 50)     0           ['batch_normalization_58[0][0]', 
                                                                  're_lu_55[0][0]']               
                                                                                                  
 re_lu_58 (ReLU)                (None, 4, 1, 50)     0           ['add_17[0][0]']                 
                                                                                                  
 pointwise_expand_conv-18 (Conv  (None, 4, 1, 150)   7500        ['re_lu_58[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_59 (BatchN  (None, 4, 1, 150)   600         ['pointwise_expand_conv-18[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_59 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_59[0][0]'] 
                                                                                                  
 mtconv-18 (MultiScaleTemporalC  (None, 4, 1, 150)   1350        ['re_lu_59[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_60 (BatchN  (None, 4, 1, 150)   600         ['mtconv-18[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_60 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_60[0][0]'] 
                                                                                                  
 pointwise_contract_conv-18 (Co  (None, 4, 1, 50)    7500        ['re_lu_60[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_61 (BatchN  (None, 4, 1, 50)    200         ['pointwise_contract_conv-18[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_18 (Add)                   (None, 4, 1, 50)     0           ['batch_normalization_61[0][0]', 
                                                                  're_lu_58[0][0]']               
                                                                                                  
 re_lu_61 (ReLU)                (None, 4, 1, 50)     0           ['add_18[0][0]']                 
                                                                                                  
 pointwise_expand_conv-19 (Conv  (None, 4, 1, 150)   7500        ['re_lu_61[0][0]']               
 2D)                                                                                              
                                                                                                  
 batch_normalization_62 (BatchN  (None, 4, 1, 150)   600         ['pointwise_expand_conv-19[0][0]'
 ormalization)                                                   ]                                
                                                                                                  
 re_lu_62 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_62[0][0]'] 
                                                                                                  
 mtconv-19 (MultiScaleTemporalC  (None, 4, 1, 150)   1350        ['re_lu_62[0][0]']               
 onvolution)                                                                                      
                                                                                                  
 batch_normalization_63 (BatchN  (None, 4, 1, 150)   600         ['mtconv-19[0][0]']              
 ormalization)                                                                                    
                                                                                                  
 re_lu_63 (ReLU)                (None, 4, 1, 150)    0           ['batch_normalization_63[0][0]'] 
                                                                                                  
 pointwise_contract_conv-19 (Co  (None, 4, 1, 50)    7500        ['re_lu_63[0][0]']               
 nv2D)                                                                                            
                                                                                                  
 batch_normalization_64 (BatchN  (None, 4, 1, 50)    200         ['pointwise_contract_conv-19[0][0
 ormalization)                                                   ]']                              
                                                                                                  
 add_19 (Add)                   (None, 4, 1, 50)     0           ['batch_normalization_64[0][0]', 
                                                                  're_lu_61[0][0]']               
                                                                                                  
 re_lu_64 (ReLU)                (None, 4, 1, 50)     0           ['add_19[0][0]']                 
                                                                                                  
 average_pooling2d (AveragePool  (None, 1, 1, 50)    0           ['re_lu_64[0][0]']               
 ing2D)                                                                                           
                                                                                                  
 flatten (Flatten)              (None, 50)           0           ['average_pooling2d[0][0]']      
                                                                                                  
 dropout (Dropout)              (None, 50)           0           ['flatten[0][0]']                
                                                                                                  
 dense (Dense)                  (None, 3)            153         ['dropout[0][0]']                
                                                                                                  
==================================================================================================
Total params: 384,303
Trainable params: 369,803
Non-trainable params: 14,500
__________________________________________________________________________________________________

Total MACs: 8.359 M
Total OPs: 17.055 M
Name: keyword_spotting_on_off_v3
Version: 1
Description: Keyword spotting classifier to detect: on, off
Classes: on, off, _unknown_
fe.sample_rate_hz: 16000
fe.fft_length: 512
fe.sample_length_ms: 1000
fe.window_size_ms: 30
fe.window_step_ms: 10
fe.filterbank_n_channels: 104
fe.filterbank_upper_band_limit: 7500.0
fe.filterbank_lower_band_limit: 125.0
fe.noise_reduction_enable: True
fe.noise_reduction_smoothing_bits: 10
fe.noise_reduction_even_smoothing: 0.025
fe.noise_reduction_odd_smoothing: 0.06
fe.noise_reduction_min_signal_remaining: 0.4
fe.pcan_enable: False
fe.pcan_strength: 0.95
fe.pcan_offset: 80.0
fe.pcan_gain_bits: 21
fe.log_scale_enable: True
fe.log_scale_shift: 6
fe.activity_detection_enable: False
fe.activity_detection_alpha_a: 0.5
fe.activity_detection_alpha_b: 0.8
fe.activity_detection_arm_threshold: 0.75
fe.activity_detection_trip_threshold: 0.8
fe.dc_notch_filter_enable: True
fe.dc_notch_filter_coefficient: 0.95
fe.quantize_dynamic_scale_enable: True
fe.quantize_dynamic_scale_range_db: 40.0
average_window_duration_ms: 300
detection_threshold_list: [242, 242, 255]
suppression_ms: 700
minimum_count: 2
volume_gain: 0.0
latency_ms: 10
verbose_model_output_logs: False
Dataset subset: training, found 300 samples:
         on: 100
        off: 100
  _unknown_: 100
Dataset subset: validation, found 300 samples:
         on: 100
        off: 100
  _unknown_: 100

Forcing epochs=3 since test=true
Class weights:
       on = 1.00
      off = 1.00
_unknown_ = 1.00
Starting model training ...
Epoch 1/3
Learn rate schedule:
  Less than step:
  100 --&gt; 0.001
  200 --&gt; 0.002
  300 --&gt; 0.003
  400 --&gt; 0.004
  10400 --&gt; 0.005
  20400 --&gt; 0.002
  25400 --&gt; 0.0005
  30400 --&gt; 1e-05
  35400 --&gt; 1e-06
  40400 --&gt; 1e-07


Step 1, updating learn rate: 0.001

      1/Unknown - 12s 12s/step - loss: 1.5629 - accuracy: 0.3200 - lr: 0.0010
      2/Unknown - 13s 183ms/step - loss: 1.5616 - accuracy: 0.3350 - lr: 0.0010
      3/Unknown - 13s 184ms/step - loss: 1.5739 - accuracy: 0.3433 - lr: 0.0010
3/3 [==============================] - 15s 1s/step - loss: 1.5739 - accuracy: 0.3433 - lr: 0.0010 - val_loss: 1.7347 - val_accuracy: 0.3333
Epoch 2/3

1/3 [=========&gt;....................] - ETA: 1s - loss: 1.6279 - accuracy: 0.2800 - lr: 0.0010
2/3 [===================&gt;..........] - ETA: 0s - loss: 1.5664 - accuracy: 0.2900 - lr: 0.0010
3/3 [==============================] - ETA: 0s - loss: 1.5099 - accuracy: 0.3300 - lr: 0.0010
3/3 [==============================] - 2s 582ms/step - loss: 1.5099 - accuracy: 0.3300 - lr: 0.0010 - val_loss: 1.3087 - val_accuracy: 0.3067
Epoch 3/3

1/3 [=========&gt;....................] - ETA: 1s - loss: 1.5246 - accuracy: 0.3000 - lr: 0.0010
2/3 [===================&gt;..........] - ETA: 0s - loss: 1.4343 - accuracy: 0.3350 - lr: 0.0010
3/3 [==============================] - ETA: 0s - loss: 1.4006 - accuracy: 0.3533 - lr: 0.0010
3/3 [==============================] - 2s 648ms/step - loss: 1.4006 - accuracy: 0.3533 - lr: 0.0010 - val_loss: 1.2055 - val_accuracy: 0.3567
Generating C:/Users/dried/.mltk/models/keyword_spotting_on_off_v3-test/keyword_spotting_on_off_v3.test.h5


*** Best training val_accuracy = 0.357


Creating c:/users/dried/silabs/mltk/mltk/models/siliconlabs/keyword_spotting_on_off_v3-test.mltk.zip
Generating C:/Users/dried/.mltk/models/keyword_spotting_on_off_v3-test/keyword_spotting_on_off_v3.float32.test.tflite
validation is using 8 subprocesses
Generating C:/Users/dried/.mltk/models/keyword_spotting_on_off_v3-test/keyword_spotting_on_off_v3.test.tflite
Updating c:/users/dried/silabs/mltk/mltk/models/siliconlabs/keyword_spotting_on_off_v3-test.mltk.zip
Training complete
Training logs here: C:/Users/dried/.mltk/models/keyword_spotting_on_off_v3-test
Trained model files here: c:/users/dried/silabs/mltk/mltk/models/siliconlabs/keyword_spotting_on_off_v3-test.mltk.zip


--------------------------------------------------------------------------------
Evaluating the .h5 model ...

Evaluating:   0%|          | 0/300 [00:00&lt;?, ?prediction/s]
Evaluating:  33%|███▎      | 100/300 [00:06&lt;00:12, 16.63prediction/s]
Evaluating:  67%|██████▋   | 200/300 [00:06&lt;00:02, 39.21prediction/s]
Evaluating: 100%|██████████| 300/300 [00:06&lt;00:00, 69.37prediction/s]
Evaluating: 100%|██████████| 300/300 [00:06&lt;00:00, 47.88prediction/s]
Name: keyword_spotting_on_off_v3
Model Type: classification
Overall accuracy: 35.333%
Class accuracies:
- off = 93.000%
- _unknown_ = 13.000%
- on = 0.000%
Average ROC AUC: 45.358%
Class ROC AUC:
- _unknown_ = 47.007%
- on = 46.163%
- off = 42.902%

Evaluating the .tflite model ...

Evaluating:   0%|          | 0/300 [00:00&lt;?, ?prediction/s]
Evaluating:  33%|███▎      | 100/300 [00:06&lt;00:12, 15.45prediction/s]
Evaluating: 100%|██████████| 300/300 [00:06&lt;00:00, 45.95prediction/s]
Name: keyword_spotting_on_off_v3
Model Type: classification
Overall accuracy: 34.000%
Class accuracies:
- off = 93.000%
- _unknown_ = 9.000%
- on = 0.000%
Average ROC AUC: 45.464%
Class ROC AUC:
- _unknown_ = 45.770%
- on = 45.505%
- off = 45.117%
</pre></div>
</div>
</div>
</div>
</section>
<section id="training-locally">
<h3 id="training-locally">Training locally<a class="headerlink" href="#training-locally" title="Permalink to this heading">¶</a></h3>
<p>One option for training your model is to run the <code class="docutils literal notranslate"><span class="pre">train</span></code> command in your local terminal.<br/>
Most of the models used by embedded devices are small enough that this is a feasible option.<br/>
Never the less, this is a very CPU intensive operation. Many times it’s best to issue the <code class="docutils literal notranslate"><span class="pre">train</span></code> command and let it run over night.</p>
<p>See the <a class="reference internal" href="#note-about-training-time"><span class="std std-doc">Note about training time</span></a> section below for more details.</p>
<p><strong>NOTE:</strong> Training a model from scratch can be very time-consuming. See the <a class="reference internal" href="keyword_spotting_with_transfer_learning.html"><span class="doc std std-doc">Transfer Learning Tutorial</span></a> for how to speed this process up.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Be sure to replace "keyword_spotting_on_off_v3"</span>
<span class="c1"># with the name of your model</span>
<span class="c1"># WARNING: This command may take several hours</span>
<span class="o">!</span>mltk<span class="w"> </span>train<span class="w"> </span>keyword_spotting_on_off_v3
</pre></div>
</div>
</div>
</div>
</section>
<section id="train-in-cloud">
<h3 id="train-in-cloud">Train in cloud<a class="headerlink" href="#train-in-cloud" title="Permalink to this heading">¶</a></h3>
<p>Alternatively, you can <em>vastly</em> improve the model training time by training this model in the “cloud”.<br/>
See the tutorial: <a class="reference internal" href="cloud_training_with_vast_ai.html"><span class="doc std std-doc">Cloud Training with vast.ai</span></a> for more details.</p>
</section>
<section id="note-about-training-time">
<h3 id="note-about-training-time">Note about training time<a class="headerlink" href="#note-about-training-time" title="Permalink to this heading">¶</a></h3>
<p><strong>TL;DR:</strong> Improve training time by using a PC/cloud VM with lots of CPU cores (4-16)</p>
<p>Models intended for embedded devices are typically “small”. Thus, while one or more powerful GPUs will certainly improve training times, there is an upper limit to their benefit. Many times, the bottleneck during training comes from the data preprocessing which is usually done on the CPU. i.e. The GPU(s) train the model faster than the CPU(s) can generate the next round of training data.</p>
<p>For this reason, it is usually beneficial to use a PC/cloud VM with multiple cores. This way, multiple CPUs can generate training data in parallel while the GPU is always fed with more training data.</p>
<p>The MLTK comes with the <a class="reference external" href="../../docs/python_api/data_preprocessing/tf_dataset.html#mltk.core.preprocess.utils.tf_dataset.parallel_process">mltk.core.preprocess.utils.tf_dataset.parallel_process()</a> API,  that generates training data by spawning multiple <a class="reference external" href="https://docs.python.org/3.7/library/multiprocessing.html">processes</a>. This allows for multiple cores to generate training data simultaneously.</p>
</section>
</section>
<section id="model-evaluation">
<h2 id="model-evaluation">Model Evaluation<a class="headerlink" href="#model-evaluation" title="Permalink to this heading">¶</a></h2>
<p>With our model trained, we can now evaluate it to see how accurate it is.</p>
<p>The basic idea behind model evaluation is to send test samples (i.e. new, unknown samples the model was <em>not</em> trained with) through the model, and compare the model’s predictions versus the expected values. If all the model predictions match the expected values then the model is 100% accurate, and every wrong prediction decreases the model accuracy, e.g.:</p>
<p><img alt="Model Accuracy" src="https://bit.ly/3w9xQXV"/></p>
<p>Assuming the test samples are <em>representative</em> then the model accuracy should indicate how well it will perform in the real-world.</p>
<p>Model evaluation is done using the <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> MLTK command. Along with accuracy, the <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> command generates other statistics such as <a class="reference external" href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">ROC-AUC</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Precision_and_recall">Precision &amp; Recall</a>.<br/>
Refer to the <a class="reference internal" href="../../docs/guides/model_evaluation.html"><span class="doc std std-doc">Model Evaluation Guide</span></a> for more details about using the MLTK for model evaluation.</p>
<section id="command">
<h3 id="command">Command<a class="headerlink" href="#command" title="Permalink to this heading">¶</a></h3>
<p>To evaluate the newly trained model, issue the following command:</p>
<p><strong>NOTE:</strong> Be sure to replace <code class="docutils literal notranslate"><span class="pre">keyword_spotting_on_off_v3</span></code> with the name of your model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the model evaluation command</span>
<span class="o">!</span>mltk<span class="w"> </span>evaluate<span class="w"> </span>keyword_spotting_on_off_v3<span class="w"> </span>--tflite<span class="w"> </span>--show
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For documentation purposes, we use the evaluate_model Python API so</span>
<span class="c1"># the evaluation plots are generated inline with the docs</span>
<span class="kn">from</span> <span class="nn">mltk.core</span> <span class="kn">import</span> <span class="n">evaluate_model</span> 
<span class="n">evaluation_results</span> <span class="o">=</span> <span class="n">evaluate_model</span><span class="p">(</span><span class="s1">'keyword_spotting_on_off_v3'</span><span class="p">,</span> <span class="n">tflite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">evaluation_results</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:tensorflow:From c:\Users\dried\silabs\mltk\.venv\lib\site-packages\tensorflow\python\autograph\pyct\static_analysis\liveness.py:83: Analyzer.lamba_check (from tensorflow.python.autograph.pyct.static_analysis.liveness) is deprecated and will be removed after 2023-09-23.
Instructions for updating:
Lambda fuctions will be no more assumed to be used in the statement where they are used, or at least in the same block. https://github.com/tensorflow/tensorflow/issues/56089
validation is using 8 subprocesses
+-------+-------------------+-----------------+-----------------+------------------------------------------------------+
| Index | OpCode            | Input(s)        | Output(s)       | Config                                               |
+-------+-------------------+-----------------+-----------------+------------------------------------------------------+
| 0     | conv_2d           | 98x1x104 (int8) | 98x1x40 (int8)  | Padding:Same stride:1x1 activation:None              |
|       |                   | 3x1x104 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 1     | conv_2d           | 98x1x40 (int8)  | 98x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 2     | depthwise_conv_2d | 98x1x120 (int8) | 49x1x120 (int8) | Multiplier:1 padding:Same stride:2x2 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 3     | conv_2d           | 49x1x120 (int8) | 49x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 4     | conv_2d           | 98x1x40 (int8)  | 49x1x40 (int8)  | Padding:Same stride:2x2 activation:Relu              |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 5     | add               | 49x1x40 (int8)  | 49x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 49x1x40 (int8)  |                 |                                                      |
| 6     | conv_2d           | 49x1x40 (int8)  | 49x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 7     | depthwise_conv_2d | 49x1x120 (int8) | 49x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 8     | conv_2d           | 49x1x120 (int8) | 49x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 9     | add               | 49x1x40 (int8)  | 49x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 49x1x40 (int8)  |                 |                                                      |
| 10    | conv_2d           | 49x1x40 (int8)  | 49x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 11    | depthwise_conv_2d | 49x1x120 (int8) | 49x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 12    | conv_2d           | 49x1x120 (int8) | 49x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 13    | add               | 49x1x40 (int8)  | 49x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 49x1x40 (int8)  |                 |                                                      |
| 14    | conv_2d           | 49x1x40 (int8)  | 49x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 15    | depthwise_conv_2d | 49x1x120 (int8) | 49x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 16    | conv_2d           | 49x1x120 (int8) | 49x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 17    | add               | 49x1x40 (int8)  | 49x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 49x1x40 (int8)  |                 |                                                      |
| 18    | conv_2d           | 49x1x40 (int8)  | 49x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 19    | depthwise_conv_2d | 49x1x120 (int8) | 25x1x120 (int8) | Multiplier:1 padding:Same stride:2x2 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 20    | conv_2d           | 25x1x120 (int8) | 25x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 21    | conv_2d           | 49x1x40 (int8)  | 25x1x40 (int8)  | Padding:Same stride:2x2 activation:Relu              |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 22    | add               | 25x1x40 (int8)  | 25x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 25x1x40 (int8)  |                 |                                                      |
| 23    | conv_2d           | 25x1x40 (int8)  | 25x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 24    | depthwise_conv_2d | 25x1x120 (int8) | 25x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 25    | conv_2d           | 25x1x120 (int8) | 25x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 26    | add               | 25x1x40 (int8)  | 25x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 25x1x40 (int8)  |                 |                                                      |
| 27    | conv_2d           | 25x1x40 (int8)  | 25x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 28    | depthwise_conv_2d | 25x1x120 (int8) | 25x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 29    | conv_2d           | 25x1x120 (int8) | 25x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 30    | add               | 25x1x40 (int8)  | 25x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 25x1x40 (int8)  |                 |                                                      |
| 31    | conv_2d           | 25x1x40 (int8)  | 25x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 32    | depthwise_conv_2d | 25x1x120 (int8) | 25x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 33    | conv_2d           | 25x1x120 (int8) | 25x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 34    | add               | 25x1x40 (int8)  | 25x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 25x1x40 (int8)  |                 |                                                      |
| 35    | conv_2d           | 25x1x40 (int8)  | 25x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 36    | depthwise_conv_2d | 25x1x120 (int8) | 13x1x120 (int8) | Multiplier:1 padding:Same stride:2x2 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 37    | conv_2d           | 13x1x120 (int8) | 13x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 38    | conv_2d           | 25x1x40 (int8)  | 13x1x40 (int8)  | Padding:Same stride:2x2 activation:Relu              |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 39    | add               | 13x1x40 (int8)  | 13x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 13x1x40 (int8)  |                 |                                                      |
| 40    | conv_2d           | 13x1x40 (int8)  | 13x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 41    | depthwise_conv_2d | 13x1x120 (int8) | 13x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 42    | conv_2d           | 13x1x120 (int8) | 13x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 43    | add               | 13x1x40 (int8)  | 13x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 13x1x40 (int8)  |                 |                                                      |
| 44    | conv_2d           | 13x1x40 (int8)  | 13x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 45    | depthwise_conv_2d | 13x1x120 (int8) | 13x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 46    | conv_2d           | 13x1x120 (int8) | 13x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 47    | add               | 13x1x40 (int8)  | 13x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 13x1x40 (int8)  |                 |                                                      |
| 48    | conv_2d           | 13x1x40 (int8)  | 13x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 49    | depthwise_conv_2d | 13x1x120 (int8) | 13x1x120 (int8) | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 50    | conv_2d           | 13x1x120 (int8) | 13x1x40 (int8)  | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 51    | add               | 13x1x40 (int8)  | 13x1x40 (int8)  | Activation:Relu                                      |
|       |                   | 13x1x40 (int8)  |                 |                                                      |
| 52    | conv_2d           | 13x1x40 (int8)  | 13x1x120 (int8) | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 53    | depthwise_conv_2d | 13x1x120 (int8) | 7x1x120 (int8)  | Multiplier:1 padding:Same stride:2x2 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 54    | conv_2d           | 7x1x120 (int8)  | 7x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 55    | conv_2d           | 13x1x40 (int8)  | 7x1x40 (int8)   | Padding:Same stride:2x2 activation:Relu              |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 56    | add               | 7x1x40 (int8)   | 7x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 7x1x40 (int8)   |                 |                                                      |
| 57    | conv_2d           | 7x1x40 (int8)   | 7x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 58    | depthwise_conv_2d | 7x1x120 (int8)  | 7x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 59    | conv_2d           | 7x1x120 (int8)  | 7x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 60    | add               | 7x1x40 (int8)   | 7x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 7x1x40 (int8)   |                 |                                                      |
| 61    | conv_2d           | 7x1x40 (int8)   | 7x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 62    | depthwise_conv_2d | 7x1x120 (int8)  | 7x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 63    | conv_2d           | 7x1x120 (int8)  | 7x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 64    | add               | 7x1x40 (int8)   | 7x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 7x1x40 (int8)   |                 |                                                      |
| 65    | conv_2d           | 7x1x40 (int8)   | 7x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 66    | depthwise_conv_2d | 7x1x120 (int8)  | 7x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 67    | conv_2d           | 7x1x120 (int8)  | 7x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 68    | add               | 7x1x40 (int8)   | 7x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 7x1x40 (int8)   |                 |                                                      |
| 69    | conv_2d           | 7x1x40 (int8)   | 7x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 70    | depthwise_conv_2d | 7x1x120 (int8)  | 4x1x120 (int8)  | Multiplier:1 padding:Same stride:2x2 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 71    | conv_2d           | 4x1x120 (int8)  | 4x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 72    | conv_2d           | 7x1x40 (int8)   | 4x1x40 (int8)   | Padding:Same stride:2x2 activation:Relu              |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 73    | add               | 4x1x40 (int8)   | 4x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 4x1x40 (int8)   |                 |                                                      |
| 74    | conv_2d           | 4x1x40 (int8)   | 4x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 75    | depthwise_conv_2d | 4x1x120 (int8)  | 4x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 76    | conv_2d           | 4x1x120 (int8)  | 4x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 77    | add               | 4x1x40 (int8)   | 4x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 4x1x40 (int8)   |                 |                                                      |
| 78    | conv_2d           | 4x1x40 (int8)   | 4x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 79    | depthwise_conv_2d | 4x1x120 (int8)  | 4x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 80    | conv_2d           | 4x1x120 (int8)  | 4x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 81    | add               | 4x1x40 (int8)   | 4x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 4x1x40 (int8)   |                 |                                                      |
| 82    | conv_2d           | 4x1x40 (int8)   | 4x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 83    | depthwise_conv_2d | 4x1x120 (int8)  | 4x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 84    | conv_2d           | 4x1x120 (int8)  | 4x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 85    | add               | 4x1x40 (int8)   | 4x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 4x1x40 (int8)   |                 |                                                      |
| 86    | conv_2d           | 4x1x40 (int8)   | 4x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 87    | depthwise_conv_2d | 4x1x120 (int8)  | 2x1x120 (int8)  | Multiplier:1 padding:Same stride:2x2 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 88    | conv_2d           | 2x1x120 (int8)  | 2x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 89    | conv_2d           | 4x1x40 (int8)   | 2x1x40 (int8)   | Padding:Same stride:2x2 activation:Relu              |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 90    | add               | 2x1x40 (int8)   | 2x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 2x1x40 (int8)   |                 |                                                      |
| 91    | conv_2d           | 2x1x40 (int8)   | 2x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 92    | depthwise_conv_2d | 2x1x120 (int8)  | 2x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 93    | conv_2d           | 2x1x120 (int8)  | 2x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 94    | add               | 2x1x40 (int8)   | 2x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 2x1x40 (int8)   |                 |                                                      |
| 95    | conv_2d           | 2x1x40 (int8)   | 2x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 96    | depthwise_conv_2d | 2x1x120 (int8)  | 2x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 97    | conv_2d           | 2x1x120 (int8)  | 2x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 98    | add               | 2x1x40 (int8)   | 2x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 2x1x40 (int8)   |                 |                                                      |
| 99    | conv_2d           | 2x1x40 (int8)   | 2x1x120 (int8)  | Padding:Valid stride:1x1 activation:Relu             |
|       |                   | 1x1x40 (int8)   |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 100   | depthwise_conv_2d | 2x1x120 (int8)  | 2x1x120 (int8)  | Multiplier:1 padding:Same stride:1x1 activation:Relu |
|       |                   | 9x1x120 (int8)  |                 |                                                      |
|       |                   | 120 (int32)     |                 |                                                      |
| 101   | conv_2d           | 2x1x120 (int8)  | 2x1x40 (int8)   | Padding:Valid stride:1x1 activation:None             |
|       |                   | 1x1x120 (int8)  |                 |                                                      |
|       |                   | 40 (int32)      |                 |                                                      |
| 102   | add               | 2x1x40 (int8)   | 2x1x40 (int8)   | Activation:Relu                                      |
|       |                   | 2x1x40 (int8)   |                 |                                                      |
| 103   | average_pool_2d   | 2x1x40 (int8)   | 1x1x40 (int8)   | Padding:Valid stride:1x2 filter:1x2 activation:None  |
| 104   | reshape           | 1x1x40 (int8)   | 40 (int8)       | Type=none                                            |
|       |                   | 2 (int32)       |                 |                                                      |
| 105   | fully_connected   | 40 (int8)       | 3 (int8)        | Activation:None                                      |
|       |                   | 40 (int8)       |                 |                                                      |
|       |                   | 3 (int32)       |                 |                                                      |
| 106   | softmax           | 3 (int8)        | 3 (int8)        | Type=softmaxoptions                                  |
+-------+-------------------+-----------------+-----------------+------------------------------------------------------+
Total MACs: 6.116 M
Total OPs: 12.380 M
Name: keyword_spotting_on_off_v3
Version: 2
Description: Keyword spotting classifier to detect: on, off
Classes: on, off, _unknown_
Runtime memory size (RAM): 97.312 k
hash: ec453c2e09670f7971bb728f4de7d122
date: 2023-06-19T21:46:38.660Z
fe.sample_rate_hz: 16000
fe.fft_length: 512
fe.sample_length_ms: 1000
fe.window_size_ms: 30
fe.window_step_ms: 10
fe.filterbank_n_channels: 104
fe.filterbank_upper_band_limit: 7500.0
fe.filterbank_lower_band_limit: 125.0
fe.noise_reduction_enable: True
fe.noise_reduction_smoothing_bits: 10
fe.noise_reduction_even_smoothing: 0.02500000037252903
fe.noise_reduction_odd_smoothing: 0.05999999865889549
fe.noise_reduction_min_signal_remaining: 0.4000000059604645
fe.pcan_enable: False
fe.pcan_strength: 0.949999988079071
fe.pcan_offset: 80.0
fe.pcan_gain_bits: 21
fe.log_scale_enable: True
fe.log_scale_shift: 6
fe.activity_detection_enable: False
fe.activity_detection_alpha_a: 0.5
fe.activity_detection_alpha_b: 0.800000011920929
fe.activity_detection_arm_threshold: 0.75
fe.activity_detection_trip_threshold: 0.800000011920929
fe.dc_notch_filter_enable: True
fe.dc_notch_filter_coefficient: 0.949999988079071
fe.quantize_dynamic_scale_enable: True
fe.quantize_dynamic_scale_range_db: 40.0
average_window_duration_ms: 300
detection_threshold_list: [242, 242, 255]
suppression_ms: 700
minimum_count: 2
volume_gain: 0.0
latency_ms: 10
verbose_model_output_logs: False
.tflite file size: 533.3kB
Dataset subset: validation, found 5135 samples:
         on: 1595
        off: 1590
  _unknown_: 1950




*******************************************************************************
WARNING: Failed to load GPU driver

This could mean that the driver or CUDA libraries are not properly installed,
or that your installed GPU driver does not match the Tensorflow version.

Refer to the Tensorflow GPU installation guide here:
https://www.tensorflow.org/install/gpu
https://www.tensorflow.org/install/source#gpu

Alternatively, you can disable the GPU by defining the environment variable: CUDA_VISIBLE_DEVICES=-1
.e.g.:
set CUDA_VISIBLE_DEVICES=-1

*******************************************************************************
</pre></div>
</div>
<img alt="../../_images/bb8c5f9883e3059074ab786d1b9db7c699d4d2129c27a602b08b4bbd6dd36a2f.png" src="../../_images/bb8c5f9883e3059074ab786d1b9db7c699d4d2129c27a602b08b4bbd6dd36a2f.png"/>
<img alt="../../_images/8294d1c7b1014bc84972dc55aafd5868e382acfe3ce3eb09eee4ce92fa8cc520.png" src="../../_images/8294d1c7b1014bc84972dc55aafd5868e382acfe3ce3eb09eee4ce92fa8cc520.png"/>
<img alt="../../_images/145b1d78c97aed7c0bce2ad32feb8996824f4f92efcc58413b1acc44b796d301.png" src="../../_images/145b1d78c97aed7c0bce2ad32feb8996824f4f92efcc58413b1acc44b796d301.png"/>
<img alt="../../_images/6bffa7ebffa4e935fa8278a90681bad96c5785967c3a617468d9f697c6a04722.png" src="../../_images/6bffa7ebffa4e935fa8278a90681bad96c5785967c3a617468d9f697c6a04722.png"/>
<img alt="../../_images/3a8dc106ea9cb3be83a9438a20dbf2c5ad232aca1f6b6a4f969fb1ff6ce83d0e.png" src="../../_images/3a8dc106ea9cb3be83a9438a20dbf2c5ad232aca1f6b6a4f969fb1ff6ce83d0e.png"/>
<img alt="../../_images/85b7608a5de4d9a2eeb9f0b7b04634cf2eb66dab40257ee5d2e17dcd9a6b5f5e.png" src="../../_images/85b7608a5de4d9a2eeb9f0b7b04634cf2eb66dab40257ee5d2e17dcd9a6b5f5e.png"/>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Updating c:/users/dried/silabs/mltk/mltk/models/siliconlabs/keyword_spotting_on_off_v3.mltk.zip
Name: keyword_spotting_on_off_v3
Model Type: classification
Overall accuracy: 91.627%
Class accuracies:
- _unknown_ = 97.010%
- off = 90.102%
- on = 86.553%
Average ROC AUC: 97.024%
Class ROC AUC:
- _unknown_ = 99.043%
- off = 96.468%
- on = 95.561%
</pre></div>
</div>
</div>
</div>
<p>So in this case, our model has a 91.6% overall accuracy.</p>
<p>Once again, please refer to the <a class="reference internal" href="../../docs/guides/model_evaluation.html"><span class="doc std std-doc">Model Evaluation Guide</span></a> for more details about the various metrics generated by this command.</p>
</section>
<section id="note-about-model-accuracy">
<h3 id="note-about-model-accuracy">Note about model accuracy<a class="headerlink" href="#note-about-model-accuracy" title="Permalink to this heading">¶</a></h3>
<p>While model accuracy is highly application-specific, an 92% accuracy of a two-keyword classification model is considered good, not great.
Typically, model accuracy should be in the 95%-97+% range for it to perform well in the field.</p>
<p>The following are things to keep in mind to improve the model accuracy:</p>
<ul class="simple">
<li><p><strong>Verify the dataset</strong> - Ensure all the samples are properly labeled and in a consistent format</p></li>
<li><p><strong>Improve the feature engineering</strong> - Give the model the best chance to learn the patterns within the data by “amplifying” the signal (e.g. Improve the spectrogram quality)</p></li>
<li><p><strong>Increase the model size</strong> - Increase the model size by adding more or wider layers (e.g. add more Conv2D filers)</p></li>
</ul>
</section>
</section>
<section id="model-testing">
<h2 id="model-testing">Model Testing<a class="headerlink" href="#model-testing" title="Permalink to this heading">¶</a></h2>
<p><strong>NOTE:</strong> This section is <strong>experimental</strong> and is optional for the rest of this tutorial.
You may safely skip to the next section.</p>
<p>During model evaluation, static audio samples are sent through the model to make predictions and determine its accuracy. While this is useful to obtain a consistent, baseline metric of model performance, this setup does not reflect the real-world application of the model.<br/>
In most real world applications, real-time audio is constantly streaming into the model. In this case, the same audio sample will pass multiple times through the model shifted in time each pass (see the <a class="reference internal" href="#machine-learning-and-keyword-spotting-overview"><span class="std std-doc">Keyword Spotting Overview</span></a> section above for more details.)</p>
<p>To help evaluate this scenario, the MLTK offers the command: <code class="docutils literal notranslate"><span class="pre">classify_audio</span></code>. With this command, the trained model can be used to classify keywords detected in streaming audio from a microphone. The <code class="docutils literal notranslate"><span class="pre">classify_audio</span></code> command features:</p>
<ul class="simple">
<li><p>Support for executing a model on PC or embedded device</p></li>
<li><p>Support for dumping the spectrograms generated by the <a class="reference internal" href="../../docs/python_api/data_preprocessing/audio_feature_generator.html"><span class="doc std std-doc">AudioFeatureGenerator</span></a></p></li>
<li><p>Support for recording audio</p></li>
<li><p>Support for adjusting the detection threshold</p></li>
<li><p>Support for viewing the model prediction results in real-time</p></li>
</ul>
<p><strong>NOTE:</strong> The <code class="docutils literal notranslate"><span class="pre">classify_audio</span></code> command must run locally. It will not work remotely (e.g. on Colab or remote SSH)</p>
<p>See the output of the command help for more details:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mltk<span class="w"> </span>classify_audio<span class="w"> </span>--help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                               
 Usage: mltk classify_audio [OPTIONS] &lt;model&gt;                                  
                                                                               
 Classify keywords/events detected in a microphone's streaming audio           
 NOTE: This command is experimental. Use at your own risk!                     
 This command runs an audio classification application on either the local PC  
 OR                                                                            
 on an embedded target. The audio classification application loads the given   
 audio classification ML model (e.g. Keyword Spotting) and streams real-time   
 audio                                                                         
 from the local PC's/embedded target's microphone into the ML model.           
                                                                               
 System Dataflow:                                                              
 Microphone -&gt; AudioFeatureGenerator -&gt; ML Model -&gt; Command Recognizer -&gt;      
 Local Terminal                                                                
                                                                               
 Refer to the mltk.models.tflite_micro.tflite_micro_speech model for a         
 reference on how to train                                                     
 an ML model that works the audio classification application.                  
                                                                               
 For more details see:                                                         
 https://siliconlabs.github.io/mltk/docs/audio/audio_utilities                 
                                                                               
 ----------                                                                    
  Examples                                                                     
 ----------                                                                    
                                                                               
 # Classify audio on local PC using tflite_micro_speech model                  
 # Simulate the audio loop latency to be 200ms                                 
 # i.e. If the app was running on an embedded target, it would take 200ms per  
 audio loop                                                                    
 # Also enable verbose logs                                                    
 mltk classify_audio tflite_micro_speech --latency 200 --verbose               
                                                                               
 # Classify audio on an embedded target using model:                           
 ~/workspace/my_model.tflite                                                   
 # and the following classifier settings:                                      
 # - Set the averaging window to 1200ms (i.e. drop samples older than &lt;now&gt;    
 minus window)                                                                 
 # - Set the minimum sample count to 3 (i.e. must have at last 3 samples       
 before classifying)                                                           
 # - Set the threshold to 175 (i.e. the average of the inference results       
 within the averaging window must be at least 175 of 255)                      
 # - Set the suppression to 750ms (i.e. Once a keyword is detected, wait 750ms 
 before detecting more keywords)                                               
 # i.e. If the app was running on an embedded target, it would take 200ms per  
 audio loop                                                                    
 mltk classify_audio /home/john/my_model.tflite --device --window 1200ms       
 --count 3 --threshold 175 --suppression 750                                   
                                                                               
 # Classify audio and also dump the captured raw audio and spectrograms        
 mltk classify_audio tflite_micro_speech --dump-audio --dump-spectrograms      
                                                                               
┌─ Arguments ─────────────────────────────────────────────────────────────────┐
│ *    model      &lt;model&gt;  On of the following:                               │
│                          - MLTK model name                                  │
│                          - Path to .tflite file                             │
│                          - Path to model archive file (.mltk.zip)           │
│                          NOTE: The model must have been previously trained  │
│                          for keyword spotting                               │
│                          [default: None]                                    │
│                          [required]                                         │
└─────────────────────────────────────────────────────────────────────────────┘
┌─ Options ───────────────────────────────────────────────────────────────────┐
│ --accelerator            -a      &lt;name&gt;            Name of accelerator to   │
│                                                    use while executing the  │
│                                                    audio classification ML  │
│                                                    model.                   │
│                                                    If omitted, then use the │
│                                                    reference kernels        │
│                                                    NOTE: It is recommended  │
│                                                    to NOT use an            │
│                                                    accelerator if running   │
│                                                    on the PC since the HW   │
│                                                    simulator can be slow.   │
│                                                    [default: None]          │
│ --device                 -d                        If provided, then run    │
│                                                    the keyword spotting     │
│                                                    model on an embedded     │
│                                                    device, otherwise use    │
│                                                    the PC's local           │
│                                                    microphone.              │
│                                                    If this option is        │
│                                                    provided, then the       │
│                                                    device must be locally   │
│                                                    connected                │
│ --port                           &lt;port&gt;            Serial COM port of a     │
│                                                    locally connected        │
│                                                    embedded device.         │
│                                                    This is only used with   │
│                                                    the --device option.     │
│                                                    'If omitted, then        │
│                                                    attempt to automatically │
│                                                    determine the serial COM │
│                                                    port                     │
│                                                    [default: None]          │
│ --verbose                -v                        Enable verbose console   │
│                                                    logs                     │
│ --window_duration        -w      &lt;duration ms&gt;     Controls the smoothing.  │
│                                                    Drop all inference       │
│                                                    results that are older   │
│                                                    than &lt;now&gt; minus         │
│                                                    window_duration.         │
│                                                    Longer durations (in     │
│                                                    milliseconds) will give  │
│                                                    a higher confidence that │
│                                                    the results are correct, │
│                                                    but may miss some        │
│                                                    commands                 │
│                                                    [default: None]          │
│ --count                  -c      &lt;count&gt;           The *minimum* number of  │
│                                                    inference results to     │
│                                                    average when calculating │
│                                                    the detection value. Set │
│                                                    to 0 to disable          │
│                                                    averaging                │
│                                                    [default: None]          │
│ --threshold              -t      &lt;threshold&gt;       Minimum averaged model   │
│                                                    output threshold for a   │
│                                                    class to be considered   │
│                                                    detected, 0-255. Higher  │
│                                                    values increase          │
│                                                    precision at the cost of │
│                                                    recall                   │
│                                                    [default: None]          │
│ --suppression            -s      &lt;suppression ms&gt;  Amount of milliseconds   │
│                                                    to wait after a keyword  │
│                                                    is detected before       │
│                                                    detecting new keywords   │
│                                                    [default: None]          │
│ --latency                -l      &lt;latency ms&gt;      This the amount of time  │
│                                                    in milliseconds between  │
│                                                    processing loops         │
│                                                    [default: None]          │
│ --microphone             -m      &lt;name&gt;            For non-embedded, this   │
│                                                    specifies the name of    │
│                                                    the PC microphone to use │
│                                                    [default: None]          │
│ --volume                 -u      &lt;volume gain&gt;     Set the volume gain      │
│                                                    scaler (i.e. amplitude)  │
│                                                    to apply to the          │
│                                                    microphone data. If 0 or │
│                                                    omitted, no scaler is    │
│                                                    applied                  │
│                                                    [default: None]          │
│ --dump-audio             -x                        Dump the raw microphone  │
│                                                    and generate a           │
│                                                    corresponding .wav file  │
│ --dump-raw-spectrograms  -w                        Dump the raw (i.e.       │
│                                                    unquantized) generated   │
│                                                    spectrograms to .jpg     │
│                                                    images and .mp4 video    │
│ --dump-spectrograms      -z                        Dump the quantized       │
│                                                    generated spectrograms   │
│                                                    to .jpg images and .mp4  │
│                                                    video                    │
│ --sensitivity            -i      FLOAT             Sensitivity of the       │
│                                                    activity indicator LED.  │
│                                                    Much less than 1.0 has   │
│                                                    higher sensitivity       │
│                                                    [default: None]          │
│ --app                            &lt;path&gt;            By default, the          │
│                                                    audio_classifier app is  │
│                                                    automatically            │
│                                                    downloaded.              │
│                                                    This option allows for   │
│                                                    overriding with a custom │
│                                                    built app.               │
│                                                    Alternatively, if using  │
│                                                    the --device option, set │
│                                                    this option to "none" to │
│                                                    NOT program the          │
│                                                    audio_classifier app to  │
│                                                    the device.              │
│                                                    In this case, ONLY the   │
│                                                    .tflite will be          │
│                                                    programmed and the       │
│                                                    existing                 │
│                                                    audio_classifier app     │
│                                                    will be re-used.         │
│                                                    [default: None]          │
│ --test                                             Run as a unit test       │
│ --help                                             Show this message and    │
│                                                    exit.                    │
└─────────────────────────────────────────────────────────────────────────────┘
</pre></div>
</div>
</div>
</div>
<section id="classify-audio-on-pc">
<h3 id="classify-audio-on-pc">Classify audio on PC<a class="headerlink" href="#classify-audio-on-pc" title="Permalink to this heading">¶</a></h3>
<p>Issue the following command to use your local PC’s microphone to stream real-time audio in our trained model:</p>
<p><strong>NOTE:</strong> Be sure to replace <code class="docutils literal notranslate"><span class="pre">keyword_spotting_on_off</span></code> with your <strong>trained</strong> model’s name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the audio classification application</span>
<span class="c1"># Saying the keywords "on" or "off" into your PC's microphone should cause the model to detect them.</span>
<span class="c1"># HINT: Add the --verbose flag to view more info from the classification app</span>
<span class="c1"># NOTE: This command must be run from a local terminal</span>
<span class="o">!</span>mltk<span class="w"> </span>classify_audio<span class="w"> </span>keyword_spotting_on_off_v3
</pre></div>
</div>
</div>
</div>
</section>
<section id="classify-audio-on-device">
<h3 id="classify-audio-on-device">Classify audio on device<a class="headerlink" href="#classify-audio-on-device" title="Permalink to this heading">¶</a></h3>
<p>Alternatively, we can run the audio classification application + model on a supported embedded device.<br/>
In this case, we use the embedded device’s microphone and the trained model executes on the embedded device.</p>
<p>To run on an embedded device, add the <code class="docutils literal notranslate"><span class="pre">--device</span></code> flag.
When a keyword is detected an LED will turn on and a log will be printed to the console.</p>
<p><strong>NOTE:</strong> A supported embedded device must be locally connected to run the command.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the audio classification application with MVP acceleration</span>
<span class="c1"># Remove the "--accelerator MVP" if your device does not support the MVP.</span>
<span class="c1"># Saying the keywords "on" or "off" into device's microphone should cause the model to detect them</span>
<span class="c1"># which will cause the LED to turn on and a message to be printed to the console.</span>
<span class="c1"># HINT: Add the --verbose flag to view more info from the classification app</span>
<span class="c1"># NOTE: This command must run from a local terminal</span>
<span class="c1"># NOTE: Your mouth must be ~2 inches from the board's microphone</span>
<span class="o">!</span>mltk<span class="w"> </span>classify_audio<span class="w"> </span>keyword_spotting_on_off_v3<span class="w"> </span>--device<span class="w"> </span>--accelerator<span class="w"> </span>MVP
</pre></div>
</div>
</div>
</div>
</section>
<section id="record-audio-and-spectrograms-from-device">
<h3 id="record-audio-and-spectrograms-from-device">Record audio and spectrograms from device<a class="headerlink" href="#record-audio-and-spectrograms-from-device" title="Permalink to this heading">¶</a></h3>
<p>Another useful feature of the <code class="docutils literal notranslate"><span class="pre">classify_audio</span></code> command is the ability to record audio and spectrograms from the embedded device.<br/>
This is done by adding the <code class="docutils literal notranslate"><span class="pre">--dump-audio</span></code> or <code class="docutils literal notranslate"><span class="pre">--dump-spectrograms</span></code> flags to the command.<br/>
When the command completes, a log directory will contain the dumped audio sound file (.wav) or dumped spectrogram images (.jpg)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dump audio from an embedded device's microphone</span>
<span class="c1"># The dumped audio will be found in the log directory:</span>
<span class="c1"># ~/.mltk/audio_classify_recordings/&lt;platform&gt;/audio</span>
<span class="c1"># NOTE: This command must run from a local terminal</span>
<span class="o">!</span>mltk<span class="w"> </span>classify_audio<span class="w"> </span>keyword_spotting_on_off_v3<span class="w"> </span>--device<span class="w"> </span>--dump-audio
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dump audio from an embedded device's microphone</span>
<span class="c1"># The dumped audio will be found in the log directory:</span>
<span class="c1"># ~/.mltk/audio_classify_recordings/&lt;platform&gt;/spectrograms</span>
<span class="c1"># NOTE: This command must run from a local terminal</span>
<span class="o">!</span>mltk<span class="w"> </span>classify_audio<span class="w"> </span>keyword_spotting_on_off_v3<span class="w"> </span>--device<span class="w"> </span>--dump-spectrograms
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="deploying-the-model">
<h2 id="deploying-the-model">Deploying the Model<a class="headerlink" href="#deploying-the-model" title="Permalink to this heading">¶</a></h2>
<p>Now that we have a trained model, it is time to run it in on an embedded device.</p>
<p>There are several different ways this can be done:</p>
<section id="using-simplicity-studio">
<h3 id="using-simplicity-studio">Using Simplicity Studio<a class="headerlink" href="#using-simplicity-studio" title="Permalink to this heading">¶</a></h3>
<p>The standard Gecko SDK also features an <a class="reference external" href="https://github.com/SiliconLabs/gecko_sdk/tree/gsdk_4.0/app/common/example/audio_classifier">audio_classifier</a> application.</p>
<p>The basic sequence for updating the app with a new model is:</p>
<ol class="arabic simple">
<li><p>Using <a class="reference external" href="https://www.silabs.com/developers/simplicity-studio">Simplicity Studio</a> create a new “Audio Classifier” project</p></li>
<li><p>Extract the <code class="docutils literal notranslate"><span class="pre">.tflite</span></code> model file from the MLTK <a class="reference internal" href="../../docs/guides/model_archive.html"><span class="doc std std-doc">Model Archive</span></a></p></li>
<li><p>Copy the <code class="docutils literal notranslate"><span class="pre">.tflite</span></code> model file to a Gecko SDK project in Simplicity Studio, more details <a class="reference external" href="https://docs.silabs.com/gecko-platform/latest/machine-learning/tensorflow/getting-started">here</a></p></li>
<li><p>Build the Gecko SDK project via Simplicity Studio</p></li>
<li><p>Program the built firmware image to the embedded device</p></li>
<li><p>Run the firmware image with trained model on the embedded device</p></li>
</ol>
<p>When Simplicity Studio builds the project, it finds the <code class="docutils literal notranslate"><span class="pre">.tflite</span></code> model file and generates a C header file which contains a C <code class="docutils literal notranslate"><span class="pre">uint8_t</span></code> array of the binary data in the <code class="docutils literal notranslate"><span class="pre">.tflite</span></code>. The firmware then references the C array and loads it into the <a class="reference external" href="https://github.com/tensorflow/tflite-micro">Tensorflow-Lite Micro Interpreter</a>.</p>
<p>See the <a class="reference external" href="https://docs.silabs.com/gecko-platform/latest/machine-learning/tensorflow/getting-started">Getting Started with Machine Learning</a> Gecko SDK guide for more details.</p>
</section>
<section id="using-the-mltk">
<h3 id="using-the-mltk">Using the MLTK<a class="headerlink" href="#using-the-mltk" title="Permalink to this heading">¶</a></h3>
<p>The MLTK supports building <a class="reference internal" href="../../docs/cpp_development/index.html"><span class="doc std std-doc">C++ Applications</span></a>.</p>
<p>It also features an <a class="reference internal" href="../../docs/cpp_development/examples/audio_classifier.html"><span class="doc std std-doc">audio_classifier</span></a> C++ application
which can be built using:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../docs/cpp_development/vscode.html"><span class="doc std std-doc">Visual Studio Code</span></a></p></li>
<li><p><a class="reference internal" href="../../docs/cpp_development/simplicity_studio.html"><span class="doc std std-doc">Simplicity Studio</span></a></p></li>
<li><p><a class="reference internal" href="../../docs/cpp_development/command_line.html"><span class="doc std std-doc">Command Line</span></a></p></li>
</ul>
<p>Refer to the <a class="reference internal" href="../../docs/cpp_development/examples/audio_classifier.html"><span class="doc std std-doc">audio_classifier</span></a> application’s documentation
for how include your model into the built application.</p>
</section>
</section>
</section>


          </article>
        </div>
      </div>
      <a href="#" class="go-top"><i class="md-icon">arrow_upward</i>Back to Top</a>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="../../docs/tutorials.html" title="Tutorials"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Tutorials </span>
              </div>
            </a>
          
          
            <a href="keyword_spotting_pacman.html" title="Keyword Spotting - Pac-Man"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Keyword Spotting - Pac-Man </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2023, Silicon Labs.
              
          </div>
            Last updated on
              Sep 12, 2023.
            <br/>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
        <button id="survey-link" class="feedback-button">Feedback</button>
      </div>
    </div>
  </footer>
  <div class="privacy-banner">
    <div class="privacy-banner-wrapper">
      <p>
        <b>Important:</b> We use cookies only for functional and traffic analytics. <br />
        We DO NOT use cookies for any marketing purposes. By using our site you acknowledge you have read and understood our <a class="privacy-policy" href="https://www.silabs.com/about-us/legal/cookie-policy" target="_blank">Cookie Policy</a>.
      </p>
      <a class="privacy-banner-accept" href="#">Got it</a>
    </div>
</div>
  
<div class="survey-container" id="dlg-survey"> 
    <div class="close" id="dlg-survey-close"><i class="md-icon">close</i></div>
    <div class="msg">Please click the <b>submit</b> button at the end even if you do not answer all of the questions</div>
    <iframe id="iframe-survey" style="width: 100%; height: 100%;"></iframe>
</div>
  
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>